<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Java-Collection笔记 - KKKPJSKEY&#39;s-Case-Archives</title><meta name="description" content="记录Java-Collection笔记"><meta property="og:title" content="Java-Collection笔记" />
<meta property="og:description" content="记录Java-Collection笔记" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kkkpjskey.github.io/java-collection-note/" /><meta property="og:image" content="https://kkkpjskey.github.io/java-collection-note/featured-image.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-15T15:04:57+08:00" />
<meta property="article:modified_time" content="2022-10-03T10:36:36+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://kkkpjskey.github.io/java-collection-note/featured-image.jpg"/>
<meta name="twitter:title" content="Java-Collection笔记"/>
<meta name="twitter:description" content="记录Java-Collection笔记"/>
<meta name="application-name" content="KKKPJSKEY&#39;s-Case-Archives">
<meta name="apple-mobile-web-app-title" content="KKKPJSKEY&#39;s-Case-Archives"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://kkkpjskey.github.io/java-collection-note/" /><link rel="prev" href="https://kkkpjskey.github.io/java-integer-equal-note/" /><link rel="next" href="https://kkkpjskey.github.io/docker-edit-start-error/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.c7b8c5b85fd75a61ccb5e4d67876bcea7a86730af33a2c32f518a595ee670885455e303041833dfdf22b05a4eed86b37.css" integrity="sha384-x7jFuF/XWmHMteTWeHa86nqGcwrzOiwy9Rille5nCIVFXjAwQYM9/fIrBaTu2Gs3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Java-Collection笔记",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/kkkpjskey.github.io\/java-collection-note\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/kkkpjskey.github.io\/java-collection-note\/featured-image.jpg",
                            "width":  721 ,
                            "height":  330 
                        }],"genre": "posts","keywords": "Java, Collection, JavaNote","wordcount":  52438 ,
        "url": "https:\/\/kkkpjskey.github.io\/java-collection-note\/","datePublished": "2021-10-15T15:04:57+08:00","dateModified": "2022-10-03T10:36:36+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/kkkpjskey.github.io\/images\/avatar.png",
                    "width":  528 ,
                    "height":  560 
                }},"author": {
                "@type": "Person",
                "name": "KKKPSJKEY"
            },"description": "记录Java-Collection笔记"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="KKKPJSKEY&#39;s-Case-Archives"><span class="header-title-pre"><i class='fas fa-laptop-code fa-fw'></i></span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/note/"> 笔记 </a><a class="menu-item" href="/categories/documentation/"> 文档 </a><a class="menu-item" href="/about/"> 关于 </a><a class="menu-item" href="https://github.com/KKKPJSKEY" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item language" title="选择语言">简体中文<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/java-collection-note/" selected>简体中文</option></select>
                    </a><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="KKKPJSKEY&#39;s-Case-Archives"><span class="header-title-pre"><i class='fas fa-laptop-code fa-fw'></i></span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/note/" title="">笔记</a><a class="menu-item" href="/categories/documentation/" title="">文档</a><a class="menu-item" href="/about/" title="">关于</a><a class="menu-item" href="https://github.com/KKKPJSKEY" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="选择语言">简体中文<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/java-collection-note/" selected>简体中文</option></select>
                </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Java-Collection笔记</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/KKKPJSKEY" title="Author" target="_blank" rel="noopener noreferrer author" class="author"><i class="fas fa-user-circle fa-fw"></i>KKKPSJKEY</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/back/"><i class="far fa-folder fa-fw"></i>Back</a>&nbsp;<a href="/categories/note/"><i class="far fa-folder fa-fw"></i>笔记</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-10-15">2021-10-15</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 52438 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 105 分钟&nbsp;<span id="/java-collection-note/" class="leancloud_visitors" data-flag-title="Java-Collection笔记">
                        <i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
                    </span>&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/java-collection-note/featured-image.jpg"
        data-srcset="/java-collection-note/featured-image.jpg, /java-collection-note/featured-image.jpg 1.5x, /java-collection-note/featured-image.jpg 2x"
        data-sizes="auto"
        alt="/java-collection-note/featured-image.jpg"
        title="记录Java-Collection笔记" /></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#list">List</a>
      <ul>
        <li><a href="#arraylist初始化的4种方法">ArrayList初始化的4种方法</a></li>
        <li><a href="#list数据去重的五种方法">List数据去重的五种方法</a>
          <ul>
            <li><a href="#方案一借助set的特性进行去重">方案一:借助Set的特性进行去重</a></li>
            <li><a href="#方案二--利用set集合特性保持顺序一致去重">方案二 : 利用set集合特性保持顺序一致去重</a></li>
            <li><a href="#方案三--使用list自身方法remove不推荐">方案三 : 使用list自身方法remove()–&gt;不推荐</a></li>
            <li><a href="#方案四--遍历list集合将元素添加到另一个list集合中">方案四 : 遍历List集合,将元素添加到另一个List集合中</a></li>
            <li><a href="#方案5--使用java8特性去重-推荐">方案5 : 使用Java8特性去重-&gt;推荐</a></li>
          </ul>
        </li>
        <li><a href="#list的复制-浅拷贝与深拷贝">List的复制 （浅拷贝与深拷贝）</a>
          <ul>
            <li><a href="#浅拷贝">浅拷贝</a>
              <ul>
                <li><a href="#1遍历循环复制">1、遍历循环复制</a></li>
                <li><a href="#2使用list实现类的构造方法">2、使用List实现类的构造方法</a></li>
                <li><a href="#3使用listaddall方法">3、使用list.addAll()方法</a></li>
                <li><a href="#4使用systemarraycopy方法">4、使用System.arraycopy()方法</a></li>
                <li><a href="#测试及结果">测试及结果</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#list-深拷贝">List 深拷贝</a>
          <ul>
            <li><a href="#测试结果">测试结果</a></li>
            <li><a href="#小结">小结</a></li>
            <li><a href="#对象列表的深度复制">对象列表的深度复制</a></li>
            <li><a href="#结果">　　结果</a></li>
          </ul>
        </li>
        <li><a href="#list根据下标修改">List根据下标修改</a></li>
        <li><a href="#list转map的三种方法">List转Map的三种方法</a></li>
        <li><a href="#java两个list的交集并集">Java两个List的交集，并集</a></li>
        <li><a href="#在arraylist的循环中删除元素会不会出现问题">在ArrayList的循环中删除元素，会不会出现问题？</a></li>
        <li><a href="#javalist-与-数组-相互转换">JAVA：List 与 数组 相互转换</a>
          <ul>
            <li><a href="#一-list-转化成-数组">一、 List 转化成 数组</a></li>
            <li><a href="#二数组-转换成-list">二、数组 转换成 list</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#map">Map</a>
      <ul>
        <li><a href="#特点">特点</a></li>
        <li><a href="#修改">修改</a></li>
        <li><a href="#遍历map的几种方法">遍历Map的几种方法</a>
          <ul>
            <li><a href="#keyset-values">keySet values</a></li>
            <li><a href="#keyset-getkey">keySet get(key)</a></li>
            <li><a href="#entryset">entrySet</a></li>
            <li><a href="#iterator">Iterator</a></li>
            <li><a href="#lambda">Lambda</a></li>
            <li><a href="#简单性能测试">简单性能测试</a></li>
            <li><a href="#总结">总结</a></li>
            <li><a href="#分析">分析</a></li>
            <li><a href="#扩容机制">扩容机制</a>
              <ul>
                <li><a href="#hashmap设计时就是没有保证线程安全的-所以在多线程环境请使用concurrenthashmap">HashMap设计时就是没有保证线程安全的, 所以在多线程环境请使用ConcurrentHashMap;</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#hashmap-的-7-种遍历方式与性能分析">HashMap 的 7 种遍历方式与性能分析</a>
          <ul>
            <li><a href="#hashmap-遍历">HashMap 遍历</a>
              <ul>
                <li><a href="#1迭代器-entryset">1.迭代器 EntrySet</a></li>
                <li><a href="#2迭代器-keyset">2.迭代器 KeySet</a></li>
                <li><a href="#3foreach-entryset">3.ForEach EntrySet</a></li>
                <li><a href="#4foreach-keyset">4.ForEach KeySet</a></li>
                <li><a href="#5lambda">5.Lambda</a></li>
                <li><a href="#6streams-api-单线程">6.Streams API 单线程</a></li>
                <li><a href="#7streams-api-多线程">7.Streams API 多线程</a></li>
              </ul>
            </li>
            <li><a href="#性能测试">性能测试</a>
              <ul>
                <li><a href="#结论">结论</a></li>
              </ul>
            </li>
            <li><a href="#字节码分析">字节码分析</a></li>
            <li><a href="#性能分析">性能分析</a></li>
            <li><a href="#安全性测试">安全性测试</a>
              <ul>
                <li><a href="#1迭代器方式">1.迭代器方式</a></li>
                <li><a href="#2for-循环方式">2.For 循环方式</a></li>
                <li><a href="#3lambda-方式">3.Lambda 方式</a></li>
                <li><a href="#4stream-方式">4.Stream 方式</a></li>
                <li><a href="#小结-1">小结</a></li>
              </ul>
            </li>
            <li><a href="#总结-1">总结</a></li>
          </ul>
        </li>
        <li><a href="#java-hashmap的死循环">Java HashMap的死循环</a>
          <ul>
            <li><a href="#问题的症状">问题的症状</a></li>
            <li><a href="#hash表数据结构">Hash表数据结构</a></li>
            <li><a href="#hashmap的rehash源代码">HashMap的rehash源代码</a></li>
            <li><a href="#正常的rehash的过程">正常的ReHash的过程</a></li>
            <li><a href="#并发下的rehash">并发下的Rehash</a></li>
            <li><a href="#问题答疑">问题答疑</a></li>
            <li><a href="#其它">其它</a></li>
            <li><a href="#修复">修复</a></li>
          </ul>
        </li>
        <li><a href="#java-集合---tablesizefor">Java 集合 &ndash;tableSizeFor</a></li>
      </ul>
    </li>
    <li><a href="#java-collectors常用的20个方法">Java-Collectors常用的20个方法</a></li>
    <li><a href="#java8-stream集合操作">Java8-Stream集合操作</a>
      <ul>
        <li><a href="#stream简介">Stream简介</a></li>
        <li><a href="#为什么要使用stream">为什么要使用Stream</a></li>
        <li><a href="#实例数据源">实例数据源</a></li>
        <li><a href="#filter">Filter</a></li>
        <li><a href="#flatmap">FlatMap</a></li>
        <li><a href="#reduce">Reduce</a></li>
        <li><a href="#collect">Collect</a></li>
        <li><a href="#optional">Optional</a>
          <ul>
            <li><a href="#java8用optional处理-null">Java8用Optional处理 null</a>
              <ul>
                <li><a href="#ofnullable">ofNullable</a></li>
                <li><a href="#ifpresent">ifPresent()</a></li>
                <li><a href="#filter-1">filter()</a></li>
                <li><a href="#map-1">map()</a></li>
                <li><a href="#flatmap-1">flatMap()</a></li>
                <li><a href="#orelse">orElse()</a></li>
                <li><a href="#orelseget">orElseGet()</a></li>
                <li><a href="#orelsethrow">orElseThrow()</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#并发">并发</a></li>
        <li><a href="#调试">调试</a></li>
      </ul>
    </li>
    <li><a href="#java8-streammapcollect用法">Java8 stream().map().collect()用法</a>
      <ul>
        <li><a href="#集合">集合</a></li>
        <li><a href="#stream优点">stream()优点</a></li>
        <li><a href="#其他例子">其他例子</a></li>
      </ul>
    </li>
    <li><a href="#为什么在java-8中stringchars是一个整数流">为什么在Java 8中String.chars（）是一个整数流？</a></li>
    <li><a href="#深入理解java双冒号运算符的使用">深入理解Java双冒号(::)运算符的使用</a>
      <ul>
        <li><a href="#双冒号">双冒号（::）</a></li>
        <li><a href="#自定义接口的几种调用方法">自定义接口的几种调用方法</a></li>
      </ul>
    </li>
    <li><a href="#java双端队列deque使用详解">Java双端队列Deque使用详解</a>
      <ul>
        <li><a href="#deque有三种用途">Deque有三种用途：</a></li>
      </ul>
    </li>
    <li><a href="#queue队列操作">Queue队列操作</a></li>
    <li><a href="#hashset-是否无序"><strong>HashSet 是否无序</strong></a>
      <ul>
        <li><a href="#一-问题起因"><strong>(一) 问题起因：</strong></a></li>
        <li><a href="#二-过程"><strong>(二) 过程</strong></a></li>
        <li><a href="#三-总结"><strong>(三) 总结</strong></a></li>
      </ul>
    </li>
    <li><a href="#java中list-integer-int的相互转换">Java中List, Integer[], int[]的相互转换</a></li>
    <li><a href="#数组操作">数组操作</a>
      <ul>
        <li><a href="#fill">fill</a></li>
        <li><a href="#arrayutils">ArrayUtils</a></li>
      </ul>
    </li>
    <li><a href="#字符串操作">字符串操作</a></li>
    <li><a href="#stringformat的详细用法">String.format()的详细用法</a>
      <ul>
        <li><a href="#问题">问题</a></li>
        <li><a href="#stringformat字符串常规类型格式化的两种重载方式">String.format()字符串常规类型格式化的两种重载方式</a></li>
        <li><a href="#上个栗子有用到了字符类型和整数类型的格式化-下面我把常用的类型例举出来">上个栗子有用到了字符类型和整数类型的格式化 下面我把常用的类型例举出来</a></li>
        <li><a href="#为了方便理解还是举个例子">为了方便理解还是举个例子</a></li>
        <li><a href="#特殊情况">特殊情况</a>
          <ul>
            <li><a href="#格式化变长度">格式化变长度</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#关于foreach循环不能修改变量的值问题">关于foreach循环不能修改变量的值问题</a>
      <ul>
        <li><a href="#一发现问题">一、发现问题</a></li>
        <li><a href="#二探究原因">二、探究原因</a></li>
        <li><a href="#三验证">三、验证</a></li>
        <li><a href="#四总结">四、总结</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="前言">前言</h2>
<p>java中的集合主要分为三种类型：</p>
<ul>
<li>Set（集）</li>
<li>List（列表）</li>
<li>Map（映射）</li>
</ul>
<h2 id="list">List</h2>
<p><strong>数组</strong>：几乎所有集合实现的底层都有数据的身影存在，因此我们首先需要了解一下数组。以下这段话摘自《Thinking In Algorithm》，感觉很不错现在拿出来跟大家分享。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./1.jpg"
        data-srcset="./1.jpg, ./1.jpg 1.5x, ./1.jpg 2x"
        data-sizes="auto"
        alt="./1.jpg"
        title="1" /></p>
<p>《Thinking In Algorithm》之数组</p>
<p><strong>集合</strong>：接下来是集合，同样我们摘自网络上的一段解释，很不错也通俗易懂，与大家分享：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./2.jpg"
        data-srcset="./2.jpg, ./2.jpg 1.5x, ./2.jpg 2x"
        data-sizes="auto"
        alt="./2.jpg"
        title="2" /></p>
<p>集合与数组</p>
<p><strong>总结一下上面两段话：</strong></p>
<p>数组的大小是固定不变的，并且同一个数组只能存储相同类型的数据，该数据类型可以是基本类型也可以是引用类型。Java中集合可以存储操作不同类型和大小不固定的数据，但是Java中集合只能存储引用类型，不能存储基本类型。</p>
<hr>
<h3 id="arraylist初始化的4种方法">ArrayList初始化的4种方法</h3>
<p><a href="https://beginnersbook.com/2013/12/how-to-initialize-an-arraylist/" target="_blank" rel="noopener noreferrer">参考</a></p>
<p>1、Arrays.asList</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Type</span><span class="o">&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Type</span><span class="o">&gt;(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">Object</span> <span class="n">o1</span><span class="o">,</span> <span class="n">Object</span> <span class="n">o2</span><span class="o">,</span> <span class="n">Object</span> <span class="n">o3</span><span class="o">,</span> <span class="o">....</span><span class="na">so</span> <span class="n">on</span><span class="o">));</span>
</code></pre></td></tr></table>
</div>
</div><p>2、生成匿名内部内进行初始化</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;()</span> <span class="o">{{</span>
    <span class="n">add</span><span class="o">(</span><span class="n">Object</span> <span class="n">o1</span><span class="o">);</span>
    <span class="n">add</span><span class="o">(</span><span class="n">Object</span> <span class="n">o2</span><span class="o">);</span>
    <span class="o">...</span>
    <span class="o">...</span>
<span class="o">}};</span>
</code></pre></td></tr></table>
</div>
</div><p>3、常规方式</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;();</span>
<span class="n">obj</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;o1&#34;</span><span class="o">);</span>
<span class="n">obj</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;o2&#34;</span><span class="o">);</span>
<span class="o">...</span>
<span class="o">...</span>
</code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;();</span>
<span class="n">List</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;o1&#34;</span><span class="o">,</span><span class="s">&#34;o2&#34;</span><span class="o">,...);</span>
<span class="n">obj</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>4、Collections.ncopies</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">Collections</span><span class="o">.</span><span class="na">nCopies</span><span class="o">(</span><span class="n">count</span><span class="o">,</span><span class="n">element</span><span class="o">));</span>
<span class="c1">//把element复制count次填入ArrayList中
</span></code></pre></td></tr></table>
</div>
</div><p>测试代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 交集
</span><span class="c1"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listA_01</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(){{</span>
    <span class="n">add</span><span class="o">(</span><span class="s">&#34;A&#34;</span><span class="o">);</span>
    <span class="n">add</span><span class="o">(</span><span class="s">&#34;B&#34;</span><span class="o">);</span>
<span class="o">}};</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listB_01</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(){{</span>
    <span class="n">add</span><span class="o">(</span><span class="s">&#34;B&#34;</span><span class="o">);</span>
    <span class="n">add</span><span class="o">(</span><span class="s">&#34;C&#34;</span><span class="o">);</span>
<span class="o">}};</span>
<span class="n">listA_01</span><span class="o">.</span><span class="na">retainAll</span><span class="o">(</span><span class="n">listB_01</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">listA_01</span><span class="o">);</span> <span class="c1">// 结果:[B]
</span><span class="c1"></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">listB_01</span><span class="o">);</span> <span class="c1">// 结果:[B, C]
</span><span class="c1"></span>
<span class="c1">// 差集
</span><span class="c1"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listA_02</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(){{</span>
    <span class="n">add</span><span class="o">(</span><span class="s">&#34;A&#34;</span><span class="o">);</span>
    <span class="n">add</span><span class="o">(</span><span class="s">&#34;B&#34;</span><span class="o">);</span>
<span class="o">}};</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listB_02</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(){{</span>
    <span class="n">add</span><span class="o">(</span><span class="s">&#34;B&#34;</span><span class="o">);</span>
    <span class="n">add</span><span class="o">(</span><span class="s">&#34;C&#34;</span><span class="o">);</span>
<span class="o">}};</span>
<span class="n">listA_02</span><span class="o">.</span><span class="na">removeAll</span><span class="o">(</span><span class="n">listB_02</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">listA_02</span><span class="o">);</span> <span class="c1">// 结果:[A]
</span><span class="c1"></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">listB_02</span><span class="o">);</span> <span class="c1">// 结果:[B, C]
</span><span class="c1"></span>
<span class="c1">// 并集
</span><span class="c1"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listA_03</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(){{</span>
    <span class="n">add</span><span class="o">(</span><span class="s">&#34;A&#34;</span><span class="o">);</span>
    <span class="n">add</span><span class="o">(</span><span class="s">&#34;B&#34;</span><span class="o">);</span>
<span class="o">}};</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listB_03</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(){{</span>
    <span class="n">add</span><span class="o">(</span><span class="s">&#34;B&#34;</span><span class="o">);</span>
    <span class="n">add</span><span class="o">(</span><span class="s">&#34;C&#34;</span><span class="o">);</span>
<span class="o">}};</span>
<span class="n">listA_03</span><span class="o">.</span><span class="na">removeAll</span><span class="o">(</span><span class="n">listB_03</span><span class="o">);</span>
<span class="n">listA_03</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">listB_03</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">listA_03</span><span class="o">);</span> <span class="c1">// 结果:[A, B, C]
</span><span class="c1"></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">listB_03</span><span class="o">);</span> <span class="c1">// 结果:[B, C]
</span></code></pre></td></tr></table>
</div>
</div><h3 id="list数据去重的五种方法">List数据去重的五种方法</h3>
<h4 id="方案一借助set的特性进行去重">方案一:借助Set的特性进行去重</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"> 	<span class="cm">/**
</span><span class="cm">     * 去除重复数据
</span><span class="cm">     * 由于Set的无序性，不会保持原来顺序
</span><span class="cm">     * @param list
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="nf">distinct</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">sta</span> <span class="o">=</span> <span class="kc">null</span> <span class="o">!=</span> <span class="n">list</span> <span class="o">&amp;&amp;</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">;</span>
        <span class="n">List</span> <span class="n">doubleList</span><span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">sta</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Set</span> <span class="n">set</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">();</span>
            <span class="n">set</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
            <span class="n">doubleList</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">doubleList</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="方案二--利用set集合特性保持顺序一致去重">方案二 : 利用set集合特性保持顺序一致去重</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// Set去重并保持原先顺序的两种方法
</span><span class="c1"></span>   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">delRepeat</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
   	   <span class="c1">//方法一
</span><span class="c1"></span>       <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listNew</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="k">new</span> <span class="n">TreeSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">list</span><span class="o">));</span>
       <span class="c1">//方法二
</span><span class="c1"></span>       <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listNew2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="k">new</span> <span class="n">LinkedHashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">list</span><span class="o">));</span>
   <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="方案三--使用list自身方法remove不推荐">方案三 : 使用list自身方法remove()–&gt;不推荐</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="cm">/**
</span><span class="cm">     * 去除重复数据(一般不推荐)
</span><span class="cm">     * 类似于冒泡排序思想
</span><span class="cm">     * @param list
</span><span class="cm">     */</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">distinct</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">list</span> <span class="o">&amp;&amp;</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//循环list集合
</span><span class="c1"></span>            <span class="k">for</span>  <span class="o">(</span> <span class="kt">int</span>  <span class="n">i</span>  <span class="o">=</span>   <span class="n">0</span> <span class="o">;</span> <span class="n">i</span>  <span class="o">&lt;</span>  <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span>  <span class="o">-</span>   <span class="n">1</span> <span class="o">;</span> <span class="n">i</span> <span class="o">++</span> <span class="o">)</span>  <span class="o">{</span>
                <span class="k">for</span>  <span class="o">(</span> <span class="kt">int</span>  <span class="n">j</span>  <span class="o">=</span>  <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span>  <span class="o">-</span>   <span class="n">1</span> <span class="o">;</span> <span class="n">j</span>  <span class="o">&gt;</span>  <span class="n">i</span><span class="o">;</span> <span class="n">j</span> <span class="o">--</span> <span class="o">)</span>  <span class="o">{</span>
                	<span class="c1">// 这里是对象的比较，如果去重条件不一样，在这里修改即可
</span><span class="c1"></span>                    <span class="k">if</span>  <span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">)))</span>  <span class="o">{</span>
                        <span class="n">list</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">//得到最新移除重复元素的list
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="方案四--遍历list集合将元素添加到另一个list集合中">方案四 : 遍历List集合,将元素添加到另一个List集合中</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 遍历后判断赋给另一个list集合，保持原来顺序
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">delRepeat</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
	  <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listNew</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
	  <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">str</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
	       <span class="k">if</span> <span class="o">(!</span><span class="n">listNew</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">str</span><span class="o">))</span> <span class="o">{</span>
	           <span class="n">listNew</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
	       <span class="o">}</span>
	   <span class="o">}</span>
	  <span class="k">return</span> <span class="n">listNew</span> <span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="方案5--使用java8特性去重-推荐">方案5 : 使用Java8特性去重-&gt;推荐</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">delRepeat</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
     <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">myList</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">distinct</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
	 <span class="k">return</span> <span class="n">myList</span> <span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="list的复制-浅拷贝与深拷贝">List的复制 （浅拷贝与深拷贝）</h3>
<p>开门见山的说，List的复制其实是很常见的，List其本质就是数组，而其存储的形式是地址</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./3.png"
        data-srcset="./3.png, ./3.png 1.5x, ./3.png 2x"
        data-sizes="auto"
        alt="./3.png"
        title="3" /></p>
<p>如图所示，将List A列表复制时，其实相当于A的内容复制给了B，java中相同内容的数组指向同一地址，即进行浅拷贝后A与B指向同一地址。</p>
<p>造成的后果就是，改变B的同时也会改变A，因为改变B就是改变B所指向地址的内容，由于A也指向同一地址，所以A与B一起改变。</p>
<p>这也就是List的浅拷贝，其常见的实现方式有如下几种：</p>
<h4 id="浅拷贝">浅拷贝</h4>
<h5 id="1遍历循环复制">1、遍历循环复制</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">destList</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;(</span><span class="n">srcList</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>  
<span class="k">for</span><span class="o">(</span><span class="n">Person</span> <span class="n">p</span> <span class="o">:</span> <span class="n">srcList</span><span class="o">){</span>  
    <span class="n">destList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>  
<span class="o">}</span>  
</code></pre></td></tr></table>
</div>
</div><h5 id="2使用list实现类的构造方法">2、使用List实现类的构造方法</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">destList</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;(</span><span class="n">srcList</span><span class="o">);</span>  
</code></pre></td></tr></table>
</div>
</div><h5 id="3使用listaddall方法">3、使用list.addAll()方法</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">destList</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;();</span>  
<span class="n">destList</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">srcList</span><span class="o">);</span>  
</code></pre></td></tr></table>
</div>
</div><h5 id="4使用systemarraycopy方法">4、使用System.arraycopy()方法</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Person</span><span class="o">[]</span> <span class="n">srcPersons</span><span class="o">=</span><span class="n">srcList</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="n">Person</span><span class="o">[</span><span class="n">0</span><span class="o">]);</span>  
<span class="n">Person</span><span class="o">[]</span> <span class="n">destPersons</span><span class="o">=</span><span class="k">new</span> <span class="n">Person</span><span class="o">[</span><span class="n">srcPersons</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>  
<span class="n">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">srcPersons</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">destPersons</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">srcPersons</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>  
</code></pre></td></tr></table>
</div>
</div><h5 id="测试及结果">测试及结果</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">printList<span class="o">(</span>destList<span class="o">)</span><span class="p">;</span> //打印未改变B之前的A 
srcList.get<span class="o">(</span>0<span class="o">)</span>.setAge<span class="o">(</span>100<span class="o">)</span><span class="p">;</span>//改变B  
printList<span class="o">(</span>destList<span class="o">)</span><span class="p">;</span> //打印改变B后的A
//打印结果
123--&gt;20  
ABC--&gt;21  
abc--&gt;22  
123--&gt;100  
ABC--&gt;21  
abc--&gt;22
</code></pre></td></tr></table>
</div>
</div><h3 id="list-深拷贝">List 深拷贝</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./4.png"
        data-srcset="./4.png, ./4.png 1.5x, ./4.png 2x"
        data-sizes="auto"
        alt="./4.png"
        title="4" /></p>
<p>如图，深拷贝就是将A复制给B的同时，给B创建新的地址，再将地址A的内容传递到地址B。ListA与ListB内容一致，但是由于所指向的地址不同，所以改变相互不受影响。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.apache.commons.collections.CollectionUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CopyTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">//list深度拷贝
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">newList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="n">CollectionUtils</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">newList</span><span class="o">,</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()]);</span>
        <span class="n">Collections</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">newList</span><span class="o">,</span> <span class="n">list</span><span class="o">);</span>
        <span class="n">newList</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">10</span><span class="o">);</span>
        
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;原list值：&#34;</span> <span class="o">+</span> <span class="n">list</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;新list值：&#34;</span> <span class="o">+</span> <span class="n">newList</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="测试结果">测试结果</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">原list值：<span class="o">[</span>0, 1, 2, 3, 4, 5, 6, 7, 8, 9<span class="o">]</span>
新list值：<span class="o">[</span>10, 1, 2, 3, 4, 5, 6, 7, 8, 9<span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="小结">小结</h4>
<p>Java对对象和基本的数据类型的处理是不一样的。在Java中用对象的作为入口参数的传递则缺省为”引用传递”，也就是说仅仅传递了对象的一个”引用”，这个”引用”的概念同C语言中的指针引用是一样的。当函数体内部对输入变量改变时，实质上就是在对这个对象的直接操作。 除了在函数传值的时候是”引用传递”，在任何用”＝”向对象变量赋值的时候都是”引用传递”。</p>
<p>在浅复制的情况下，源数据被修改破坏之后，使用相同引用指向该数据的目标集合中的对应元素也就发生了相同的变化。因此，在需求要求必须深复制的情况下，要是使用上面提到的方法，请确保List中的T类对象是不易被外部修改和破坏的。</p>
<h4 id="对象列表的深度复制">对象列表的深度复制</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span><span class="lnt">99
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">top.luxd.Test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.collections.CollectionUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CopyTest</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">//list深度拷贝
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">newList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="n">CollectionUtils</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">newList</span><span class="o">,</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()]);</span>
        <span class="n">Collections</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">newList</span><span class="o">,</span> <span class="n">list</span><span class="o">);</span>
        <span class="n">newList</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">10</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;原list值：&#34;</span> <span class="o">+</span> <span class="n">list</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;新list值：&#34;</span> <span class="o">+</span> <span class="n">newList</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ClassNotFoundException</span> <span class="o">{</span>
        <span class="n">UserTest</span> <span class="n">user1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UserTest</span><span class="o">(</span><span class="s">&#34;小明&#34;</span><span class="o">,</span> <span class="n">18</span><span class="o">);</span>
        <span class="n">UserTest</span> <span class="n">user2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UserTest</span><span class="o">(</span><span class="s">&#34;小红&#34;</span><span class="o">,</span> <span class="n">16</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">UserTest</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user1</span><span class="o">);</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user2</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;原List：&#34;</span> <span class="o">+</span> <span class="n">list</span><span class="o">);</span>

        <span class="c1">// 进行深度复制
</span><span class="c1">//        List&lt;UserTest&gt; listNew = new ArrayList&lt;&gt;();
</span><span class="c1">//        for (int i = 0; i &lt; list.size(); i += 1) {
</span><span class="c1">//            listNew.add((UserTest) list.get(i).clone());
</span><span class="c1">//        }
</span><span class="c1"></span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">UserTest</span><span class="o">&gt;</span> <span class="n">listNew</span> <span class="o">=</span> <span class="n">deepCopy</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;对新list进行操作&#34;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">UserTest</span> <span class="n">userTest</span> <span class="o">:</span> <span class="n">listNew</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">userTest</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="n">99</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;原list&#34;</span> <span class="o">+</span> <span class="n">list</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;新list&#34;</span> <span class="o">+</span> <span class="n">listNew</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">class</span> <span class="nc">UserTest</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
        
        <span class="kd">public</span> <span class="nf">UserTest</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nf">UserTest</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getAge</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">age</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">&#34;UserTest{&#34;</span> <span class="o">+</span>
                    <span class="s">&#34;id=&#39;&#34;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="sc">&#39;\&#39;&#39;</span> <span class="o">+</span>
                    <span class="s">&#34;, age=&#34;</span> <span class="o">+</span> <span class="n">age</span> <span class="o">+</span>
                    <span class="sc">&#39;}&#39;</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">//关键代码 运行序列化和反序列化  进行深度拷贝
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">deepCopy</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">src</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ClassNotFoundException</span> <span class="o">{</span>
        <span class="n">ByteArrayOutputStream</span> <span class="n">byteOut</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
        <span class="n">ObjectOutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectOutputStream</span><span class="o">(</span><span class="n">byteOut</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">src</span><span class="o">);</span>
        <span class="n">ByteArrayInputStream</span> <span class="n">byteIn</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayInputStream</span><span class="o">(</span><span class="n">byteOut</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
        <span class="n">ObjectInputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectInputStream</span><span class="o">(</span><span class="n">byteIn</span><span class="o">);</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;unchecked&#34;</span><span class="o">)</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">dest</span> <span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;)</span> <span class="n">in</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">dest</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="结果">　　结果</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">原List：<span class="o">[</span>UserTest<span class="o">{</span><span class="nv">id</span><span class="o">=</span><span class="s1">&#39;小明&#39;</span>, <span class="nv">age</span><span class="o">=</span>18<span class="o">}</span>, UserTest<span class="o">{</span><span class="nv">id</span><span class="o">=</span><span class="s1">&#39;小红&#39;</span>, <span class="nv">age</span><span class="o">=</span>16<span class="o">}]</span>
对新list进行操作
原list<span class="o">[</span>UserTest<span class="o">{</span><span class="nv">id</span><span class="o">=</span><span class="s1">&#39;小明&#39;</span>, <span class="nv">age</span><span class="o">=</span>18<span class="o">}</span>, UserTest<span class="o">{</span><span class="nv">id</span><span class="o">=</span><span class="s1">&#39;小红&#39;</span>, <span class="nv">age</span><span class="o">=</span>16<span class="o">}]</span>
新list<span class="o">[</span>UserTest<span class="o">{</span><span class="nv">id</span><span class="o">=</span><span class="s1">&#39;小明&#39;</span>, <span class="nv">age</span><span class="o">=</span>99<span class="o">}</span>, UserTest<span class="o">{</span><span class="nv">id</span><span class="o">=</span><span class="s1">&#39;小红&#39;</span>, <span class="nv">age</span><span class="o">=</span>99<span class="o">}]</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="list根据下标修改">List根据下标修改</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">//        1 List 是通过指针指向地址来查询和存储数据的。而如果直接将一个List赋值给另一个List。则会导致该两个List都指向同一个地址。而导致如果后一个List的元素值改变，前一个List的元素值也随之改变。这个要记住。
</span><span class="c1"></span>        <span class="n">List</span> <span class="n">list1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>
        <span class="n">list1</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;1&#34;</span><span class="o">);</span>
        <span class="n">list1</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;2&#34;</span><span class="o">);</span>
        <span class="n">list1</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;3&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;list1:&#34;</span> <span class="o">+</span> <span class="n">list1</span><span class="o">);</span>

        <span class="n">List</span> <span class="n">list2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>

        <span class="n">list2</span> <span class="o">=</span> <span class="n">list1</span><span class="o">;</span><span class="c1">//简单的直接赋值
</span><span class="c1"></span>        <span class="n">list2</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="s">&#34;12&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;list1:&#34;</span> <span class="o">+</span> <span class="n">list1</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;list2:&#34;</span> <span class="o">+</span> <span class="n">list2</span><span class="o">);</span>

<span class="c1">//        2 所以为了避免出现上述现象和后果。则通过将元素值赋值给list的方法。这样则不会导致上述现象。
</span><span class="c1"></span>        <span class="n">List</span> <span class="n">list3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>
        <span class="n">list3</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;1&#34;</span><span class="o">);</span>
        <span class="n">list3</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;2&#34;</span><span class="o">);</span>
        <span class="n">list3</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;3&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;list3:&#34;</span> <span class="o">+</span> <span class="n">list3</span><span class="o">);</span>

        <span class="n">List</span> <span class="n">list4</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">list3</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span><span class="c1">//通过循环来赋值给另一个List
</span><span class="c1"></span>            <span class="n">Object</span> <span class="n">object</span> <span class="o">=</span> <span class="n">list3</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="n">list4</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">list4</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="s">&#34;12&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;list3:&#34;</span> <span class="o">+</span> <span class="n">list3</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;list4:&#34;</span> <span class="o">+</span> <span class="n">list4</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="list转map的三种方法">List转Map的三种方法</h3>
<p>一、
<code>List</code>转<code>Map</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">User</span><span class="o">&gt;</span> <span class="n">maps</span> <span class="o">=</span> <span class="n">userList</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">User</span><span class="o">::</span><span class="n">getId</span><span class="o">,</span><span class="n">Function</span><span class="o">.</span><span class="na">identity</span><span class="o">()));</span>
</code></pre></td></tr></table>
</div>
</div><p>看来还是使用JDK 1.8方便一些。</p>
<p>二、
<strong>另外，转换成<code>Map</code>的时候，可能出现key一样的情况，如果不指定一个覆盖规则，上面的代码是会报错的。转成<code>Map</code>的时候，最好使用下面的方式：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">User</span><span class="o">&gt;</span> <span class="n">maps</span> <span class="o">=</span>  <span class="n">userList</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">User</span><span class="o">::</span><span class="n">getId</span><span class="o">,</span>  <span class="n">Function</span><span class="o">.</span><span class="na">identity</span><span class="o">(),</span> <span class="o">(</span><span class="n">key1</span><span class="o">,</span> <span class="n">key2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">key2</span><span class="o">));</span>
</code></pre></td></tr></table>
</div>
</div><p>三、
有时候，希望得到的<code>Map</code>的值不是对象，而是对象的某个属性，那么可以用下面的方式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Map</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">maps</span> <span class="o">=</span> <span class="n">userList</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">User</span><span class="o">::</span><span class="n">getId</span><span class="o">,</span> <span class="n">User</span><span class="o">::</span><span class="n">getAge</span><span class="o">,</span> <span class="o">(</span><span class="n">key1</span><span class="o">,</span> <span class="n">key2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">key2</span><span class="o">));</span>
</code></pre></td></tr></table>
</div>
</div><p>四、 <code>List</code> 以<code>ID</code><strong>分组</strong> <code>Map&lt;Integer,List&gt;</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">List</span><span class="o">&gt;</span> <span class="n">groupBy</span> <span class="o">=</span> <span class="n">appleList</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">groupingBy</span><span class="o">(</span><span class="n">Apple</span><span class="o">::</span><span class="n">getId</span><span class="o">));</span>

<span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="err">“</span><span class="n">groupBy</span><span class="o">:</span><span class="err">”</span><span class="o">+</span><span class="n">groupBy</span><span class="o">);</span>
 <span class="o">{</span><span class="n">1</span><span class="o">=[</span><span class="n">Apple</span><span class="o">{</span><span class="n">id</span><span class="o">=</span><span class="n">1</span><span class="o">,</span>  <span class="n">name</span><span class="o">=</span><span class="err">‘</span><span class="n">苹果1</span><span class="err">’</span><span class="o">,</span> <span class="n">money</span><span class="o">=</span><span class="n">3</span><span class="o">.</span><span class="na">25</span><span class="o">,</span> <span class="n">num</span><span class="o">=</span><span class="n">10</span><span class="o">},</span> <span class="n">Apple</span><span class="o">{</span><span class="n">id</span><span class="o">=</span><span class="n">1</span><span class="o">,</span> <span class="n">name</span><span class="o">=</span><span class="err">‘</span><span class="n">苹果2</span><span class="err">’</span><span class="o">,</span> <span class="n">money</span><span class="o">=</span><span class="n">1</span><span class="o">.</span><span class="na">35</span><span class="o">,</span>  <span class="n">num</span><span class="o">=</span><span class="n">20</span><span class="o">}],</span> <span class="n">2</span><span class="o">=[</span><span class="n">Apple</span><span class="o">{</span><span class="n">id</span><span class="o">=</span><span class="n">2</span><span class="o">,</span> <span class="n">name</span><span class="o">=</span><span class="err">‘</span><span class="n">香蕉</span><span class="err">’</span><span class="o">,</span> <span class="n">money</span><span class="o">=</span><span class="n">2</span><span class="o">.</span><span class="na">89</span><span class="o">,</span> <span class="n">num</span><span class="o">=</span><span class="n">30</span><span class="o">}],</span> <span class="n">3</span><span class="o">=[</span><span class="n">Apple</span><span class="o">{</span><span class="n">id</span><span class="o">=</span><span class="n">3</span><span class="o">,</span> <span class="n">name</span><span class="o">=</span><span class="err">‘</span><span class="n">荔枝</span><span class="err">’</span><span class="o">,</span> <span class="n">money</span><span class="o">=</span><span class="n">9</span><span class="o">.</span><span class="na">99</span><span class="o">,</span> <span class="n">num</span><span class="o">=</span><span class="n">40</span><span class="o">}]}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="java两个list的交集并集">Java两个List的交集，并集</h3>
<p>⽅法⼀:使⽤apache的CollectionUtils⼯具类(推荐)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">publicstaticvoidmain</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">arrayA</span> <span class="o">=</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;1&#34;</span><span class="o">,</span><span class="s">&#34;2&#34;</span><span class="o">,</span><span class="s">&#34;3&#34;</span><span class="o">,</span><span class="s">&#34;4&#34;</span><span class="o">};</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">arrayB</span> <span class="o">=</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;3&#34;</span><span class="o">,</span><span class="s">&#34;4&#34;</span><span class="o">,</span><span class="s">&#34;5&#34;</span><span class="o">,</span><span class="s">&#34;6&#34;</span><span class="o">};</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listA</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">arrayA</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listB</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">arrayB</span><span class="o">);</span>
    
<span class="c1">//1、并集 union
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">CollectionUtils</span><span class="o">.</span><span class="na">union</span><span class="o">(</span><span class="n">listA</span><span class="o">,</span> <span class="n">listB</span><span class="o">));</span>
<span class="c1">//输出: [1, 2, 3, 4, 5, 6]
</span><span class="c1"></span>    
<span class="c1">//2、交集 intersection
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">CollectionUtils</span><span class="o">.</span><span class="na">intersection</span><span class="o">(</span><span class="n">listA</span><span class="o">,</span> <span class="n">listB</span><span class="o">));</span>
<span class="c1">//输出:[3, 4]
</span><span class="c1"></span>
<span class="c1">//3、交集的补集（析取）disjunction
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">CollectionUtils</span><span class="o">.</span><span class="na">disjunction</span><span class="o">(</span><span class="n">listA</span><span class="o">,</span> <span class="n">listB</span><span class="o">));</span>
<span class="c1">//输出:[1, 2, 5, 6]
</span><span class="c1"></span>
<span class="c1">//4、差集（扣除）
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">CollectionUtils</span><span class="o">.</span><span class="na">subtract</span><span class="o">(</span><span class="n">listA</span><span class="o">,</span> <span class="n">listB</span><span class="o">));</span>
<span class="c1">//输出:[1, 2]
</span><span class="c1"></span><span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>⽅法⼆:List⾃带⽅法</p>
<table>
<thead>
<tr>
<th>需求</th>
<th>list的方法</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>交集</td>
<td>listA.retainAll(listB)</td>
<td>listA内容变为listA和listB都存在的对象</td>
<td>listB不变</td>
</tr>
<tr>
<td>差集</td>
<td>listA.removeAll(listB)</td>
<td>listA中存在的listB的内容去重</td>
<td>listB不变</td>
</tr>
<tr>
<td>并集</td>
<td>listA.removeAll(listB) listA.addAll(listB)</td>
<td>为了去重，listA先取差集，然后追加全部的listB</td>
<td>listB不变</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">publicstaticvoidmain</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">arrayA</span> <span class="o">=</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;1&#34;</span><span class="o">,</span><span class="s">&#34;2&#34;</span><span class="o">,</span><span class="s">&#34;3&#34;</span><span class="o">,</span><span class="s">&#34;4&#34;</span><span class="o">};</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">arrayB</span> <span class="o">=</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;3&#34;</span><span class="o">,</span><span class="s">&#34;4&#34;</span><span class="o">,</span><span class="s">&#34;5&#34;</span><span class="o">,</span><span class="s">&#34;6&#34;</span><span class="o">};</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listA</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">arrayA</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listB</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">arrayB</span><span class="o">);</span>

<span class="c1">//1、交集
</span><span class="c1"></span>    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span>  <span class="n">jiaoList</span> <span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">listA</span><span class="o">);</span>
    <span class="n">jiaoList</span><span class="o">.</span><span class="na">retainAll</span><span class="o">(</span><span class="n">listB</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">jiaoList</span><span class="o">);</span>
<span class="c1">//输出:[3, 4]
</span><span class="c1"></span>    

<span class="c1">//2、差集
</span><span class="c1"></span>    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span>  <span class="n">chaList</span> <span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">listA</span><span class="o">);</span>
    <span class="n">chaList</span><span class="o">.</span><span class="na">removeAll</span><span class="o">(</span><span class="n">listB</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">chaList</span><span class="o">);</span>
<span class="c1">//输出:[1, 2]
</span><span class="c1"></span>
<span class="c1">//3、并集先做差集再做添加所有）
</span><span class="c1"></span> <span class="o">(</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span>  <span class="n">bingList</span> <span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">listA</span><span class="o">);</span>
    <span class="n">bingList</span><span class="o">.</span><span class="na">removeAll</span><span class="o">(</span><span class="n">listB</span><span class="o">);</span><span class="c1">// bingList为[1, 2]
</span><span class="c1"></span>
    <span class="n">bingList</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">listB</span><span class="o">);</span><span class="c1">//添加[3,4,5,6]
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bingList</span><span class="o">);</span>
<span class="c1">//输出:[1, 2, 3, 4, 5, 6]
</span><span class="c1"></span><span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>注意 : intersection和retainAll的差别</p>
<p>要注意的是它们的返回类型是不⼀样的,intersection返回的是⼀个新的List集合，⽽retainAll返回是Bollean类型那就说明retainAll⽅法是
对原有集合进⾏处理再返回原有集合,会改变原有集合中的内容。</p>
<p>个⼈观点：1、从性能⾓度来考虑的话,List⾃带会⾼点,因为它不⽤再创建新的集合。2、需要注意的是：因为retainAll因为会改变原有集合,所以该集合需要多次使⽤就不适合⽤retainAll。</p>
<p>注意: Arrays.asList将数组转集合不能进⾏add和remove操作。</p>
<p>原因：调⽤Arrays.asList()⽣产的List的add、remove⽅法时报异常，这是由Arrays.asList() 返回的市Arrays的内部类ArrayList， ⽽
不是java.util.ArrayList。Arrays的内部类ArrayList和java.util.ArrayList都是继承AbstractList，remove、add等⽅法AbstractList中
是默认throw UnsupportedOperationException⽽且不作任何操作。java.util.ArrayList重新了这些⽅法⽽Arrays的内部类ArrayList没
有重新，所以会抛出异常。</p>
<p>所以正确做法如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">String</span><span class="o">[]</span> <span class="n">array</span> <span class="o">={</span><span class="s">&#34;1&#34;</span><span class="o">,</span><span class="s">&#34;2&#34;</span><span class="o">,</span><span class="s">&#34;3&#34;</span><span class="o">,</span><span class="s">&#34;4&#34;</span><span class="o">,</span><span class="s">&#34;5&#34;</span><span class="o">};</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">array</span><span class="o">);</span>
<span class="n">List</span> <span class="n">arrList</span> <span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
<span class="n">arrList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;6&#34;</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>⽅法三:JDK1.8 stream 新特性</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="n">String</span><span class="o">[]</span> <span class="n">arrayA</span> <span class="o">=</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;1&#34;</span><span class="o">,</span><span class="s">&#34;2&#34;</span><span class="o">,</span><span class="s">&#34;3&#34;</span><span class="o">,</span><span class="s">&#34;4&#34;</span><span class="o">};</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">arrayB</span> <span class="o">=</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;3&#34;</span><span class="o">,</span><span class="s">&#34;4&#34;</span><span class="o">,</span><span class="s">&#34;5&#34;</span><span class="o">,</span><span class="s">&#34;6&#34;</span><span class="o">};</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listA</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">arrayA</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listB</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">arrayB</span><span class="o">);</span>

	<span class="c1">// 交集
</span><span class="c1"></span>    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">intersection</span> <span class="o">=</span> <span class="n">listA</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">filter</span><span class="o">(</span><span class="n">item</span> <span class="o">-&gt;</span> <span class="n">listB</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">item</span><span class="o">)).</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">intersection</span><span class="o">);</span>
	<span class="c1">//输出:[3, 4]
</span><span class="c1"></span>
	<span class="c1">// 差集(list1 - list2)
</span><span class="c1"></span>    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">reduceList</span> <span class="o">=</span> <span class="n">listA</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">filter</span><span class="o">(</span><span class="n">item</span> <span class="o">-&gt;!</span><span class="n">listB</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">item</span><span class="o">)).</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">reduceList</span><span class="o">);</span>
	<span class="c1">//输出:[1, 2]
</span><span class="c1"></span>
	<span class="c1">// 并集（新建集合:1、是因为不影响原始集合。2、Arrays.asList不能add和remove操作。
</span><span class="c1"></span>    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listAll</span> <span class="o">=</span> <span class="n">listA</span><span class="o">.</span><span class="na">parallelStream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listAll2</span> <span class="o">=</span> <span class="n">listB</span><span class="o">.</span><span class="na">parallelStream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>
    <span class="n">listAll</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">listAll2</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">listAll</span><span class="o">);</span>
	<span class="c1">//输出:[1, 2, 3, 4, 3, 4, 5, 6]
</span><span class="c1"></span>

	<span class="c1">// 去重并集
</span><span class="c1"></span>    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">listA</span><span class="o">);</span>
    <span class="n">list</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">listB</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listAllDistinct</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">distinct</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">listAllDistinct</span><span class="o">);</span>
	<span class="c1">//输出:[1, 2, 3, 4, 5, 6]
</span></code></pre></td></tr></table>
</div>
</div><p>总结 ： 这三种推荐第⼀种⽅式，因为第⼆种还需要确定该集合是否被多次调⽤。第三种可读性不⾼。</p>
<p>对象集合交、并、差处理
因为对象的equels⽐较是⽐较两个对象的内存地址，所以除⾮是同⼀对象，否则equel返回永远是false。</p>
<p>但我们实际开发中 在我们的业务系统中判断对象时有时候需要的不是⼀种严格意义上的相等，⽽是⼀种业务上的对象相等。在这种情况
下，原⽣的equals⽅法就不能满⾜我们的需求了，所以这个时候我们需要重写equals⽅法。</p>
<p>说明 :String为什么可以使⽤equels⽅法为什么只要字符串相等就为true,那是因为String类重写了equal和hashCode⽅法，⽐较的是值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 为什么重写equals ⽅法⼀定要重写hashCode⽅法下⾯也会讲
</span><span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="n">age</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 重写equals⽅法根据name和age都相同那么对象就默认相同
</span><span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Person</span> <span class="n">u</span> <span class="o">=</span> <span class="o">(</span><span class="n">Person</span><span class="o">)</span> <span class="n">obj</span><span class="o">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">u</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">age</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">u</span><span class="o">.</span><span class="na">getAge</span><span class="o">()));</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 重写
</span><span class="cm">     * ⽅法
</span><span class="cm">     * toString
</span><span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;Person{&#34;</span> <span class="o">+</span>
                <span class="s">&#34;name=&#39;&#34;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="sc">&#39;\&#39;&#39;</span> <span class="o">+</span>
                <span class="s">&#34;, age=&#34;</span> <span class="o">+</span> <span class="n">age</span> <span class="o">+</span>
                <span class="sc">&#39;}&#39;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

    <span class="c1">//        这⾥根据name和age都相同那么就默认相同对象。
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">personList</span> <span class="o">=</span> <span class="n">Lists</span><span class="o">.</span><span class="na">newArrayList</span><span class="o">();</span>
        <span class="n">Person</span> <span class="n">person1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="s">&#34;⼩⼩&#34;</span><span class="o">,</span> <span class="n">3</span><span class="o">);</span>
        <span class="n">Person</span> <span class="n">person2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="s">&#34;中中&#34;</span><span class="o">,</span> <span class="n">4</span><span class="o">);</span>
        <span class="n">personList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">person1</span><span class="o">);</span>
        <span class="n">personList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">person2</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">person1List</span> <span class="o">=</span> <span class="n">Lists</span><span class="o">.</span><span class="na">newArrayList</span><span class="o">();</span>
        <span class="n">Person</span> <span class="n">person3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="s">&#34;中中&#34;</span><span class="o">,</span> <span class="n">4</span><span class="o">);</span>
        <span class="n">Person</span> <span class="n">person4</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="s">&#34;⼤⼤&#34;</span><span class="o">,</span> <span class="n">5</span><span class="o">);</span>
        <span class="n">person1List</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">person3</span><span class="o">);</span>
        <span class="n">person1List</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">person4</span><span class="o">);</span>
        <span class="cm">/**
</span><span class="cm">         1、差集
</span><span class="cm">         */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">CollectionUtils</span><span class="o">.</span><span class="na">subtract</span><span class="o">(</span><span class="n">personList</span><span class="o">,</span> <span class="n">person1List</span><span class="o">));</span>
        <span class="c1">//输出:[Person { name = &#39;⼩⼩&#39;, age=3}]
</span><span class="c1"></span>        <span class="cm">/**
</span><span class="cm">         1、并集
</span><span class="cm">         */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">CollectionUtils</span><span class="o">.</span><span class="na">union</span><span class="o">(</span><span class="n">personList</span><span class="o">,</span> <span class="n">person1List</span><span class="o">));</span>
        <span class="c1">//输出:[Person {name = &#39;⼩⼩&#39;, age=3}, Person{name=&#39;中中&#39;, age=4}, Person{name=&#39;⼤⼤&#39;, age=5}]
</span><span class="c1"></span>        <span class="cm">/**
</span><span class="cm">         3、交集
</span><span class="cm">         */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">CollectionUtils</span><span class="o">.</span><span class="na">intersection</span><span class="o">(</span><span class="n">personList</span><span class="o">,</span> <span class="n">person1List</span><span class="o">));</span>
        <span class="c1">//输出:[Person {name = &#39;中中&#39;, age=4}]
</span><span class="c1"></span>        <span class="cm">/**
</span><span class="cm">         4、交集的补集（析取）
</span><span class="cm">         */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">CollectionUtils</span><span class="o">.</span><span class="na">disjunction</span><span class="o">(</span><span class="n">personList</span><span class="o">,</span> <span class="n">person1List</span><span class="o">));</span>
        <span class="c1">// 输出:[Person {name = &#39;⼩⼩&#39;, age=3}, Person{name=&#39;⼤⼤&#39;, age=5}]
</span><span class="c1"></span>    <span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="在arraylist的循环中删除元素会不会出现问题">在ArrayList的循环中删除元素，会不会出现问题？</h3>
<p>在 ArrayList 的循环中删除元素，会不会出现问题？我开始觉得应该会有什么问题吧，但是不知道问题会在哪里。在经历了一番测试和查阅之后，发现这个“小”问题并不简单！</p>
<p>不在循环中的删除，是没有问题的，否则这个方法也没有存在的必要了嘛，我们这里讨论的是在循环中的删除，而对 ArrayList 的循环方法也是有多种的，这里定义一个类方法 remove()，先来看段代码吧。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">public</span> <span class="kr">class</span> <span class="nx">ArrayListTest</span> <span class="p">{</span>
    <span class="kr">public</span> <span class="kr">static</span> <span class="k">void</span> <span class="nx">main</span><span class="p">(</span><span class="nb">String</span><span class="p">[]</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ArrayList</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span> <span class="nx">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayList</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&#34;aa&#34;</span><span class="p">);</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&#34;bb&#34;</span><span class="p">);</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&#34;aa&#34;</span><span class="p">);</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&#34;bb&#34;</span><span class="p">);</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&#34;cc&#34;</span><span class="p">);</span>
        <span class="c1">// 删除元素 aa
</span><span class="c1"></span>        <span class="nx">remove</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="s2">&#34;aa&#34;</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="nb">String</span> <span class="nx">str</span> <span class="o">:</span> <span class="nx">list</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">System</span><span class="p">.</span><span class="nx">out</span><span class="p">.</span><span class="nx">println</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kr">public</span> <span class="kr">static</span> <span class="k">void</span> <span class="nx">remove</span><span class="p">(</span><span class="nx">ArrayList</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span> <span class="nx">list</span><span class="p">,</span> <span class="nb">String</span> <span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 不同的循环及删除方法
</span><span class="c1"></span>        <span class="c1">// 方法一：普通for循环正序删除，删除过程中元素向左移动，不能删除重复的元素
</span><span class="c1">//        for (int i = 0; i &lt; list.size(); i++) {
</span><span class="c1">//            if (list.get(i).equals(&#34;bb&#34;)) {
</span><span class="c1">//                list.remove(list.get(i));
</span><span class="c1">//            }
</span><span class="c1">//        }
</span><span class="c1"></span>        <span class="c1">// 方法二：普通for循环倒序删除，删除过程中元素向左移动，可以删除重复的元素
</span><span class="c1">//        for (int i = list.size() - 1; i &gt;= 0; i--) {
</span><span class="c1">//            if (list.get(i).equals(&#34;bb&#34;)) {
</span><span class="c1">//                list.remove(list.get(i));
</span><span class="c1">//            }
</span><span class="c1">//        }
</span><span class="c1"></span>        <span class="c1">// 方法三：增强for循环删除，使用ArrayList的remove()方法删除，产生并发修改异常 ConcurrentModificationException
</span><span class="c1">//        for (String str : list) {
</span><span class="c1">//            if (str.equals(&#34;aa&#34;)) {
</span><span class="c1">//                list.remove(str);
</span><span class="c1">//            }
</span><span class="c1">//        }
</span><span class="c1"></span>
        <span class="c1">// 方法四：迭代器，使用ArrayList的remove()方法删除，产生并发修改异常 ConcurrentModificationException
</span><span class="c1">//        Iterator iterator = list.iterator();
</span><span class="c1">//        while (iterator.hasNext()) {
</span><span class="c1">//            if(iterator.next().equals(elem)) {
</span><span class="c1">//                list.remove(iterator.next());
</span><span class="c1">//            }
</span><span class="c1">//        }
</span><span class="c1"></span>
        <span class="c1">// 方法五：迭代器，使用迭代器的remove()方法删除，可以删除重复的元素，但不推荐
</span><span class="c1">//        Iterator iterator = list.iterator();
</span><span class="c1">//        while (iterator.hasNext()) {
</span><span class="c1">//            if(iterator.next().equals(elem)) {
</span><span class="c1">//                iterator.remove();
</span><span class="c1">//            }
</span><span class="c1">//        }
</span><span class="c1"></span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这里我测试了五种不同的删除方法，一种是普通的 for 循环，一种是增强的 foreach 循环，还有一种是使用迭代器循环，一共这三种循环方式。也欢迎你点击文末的 “阅读全文”，留言和我们讨论哦！</p>
<p>上面这几种删除方式呢，在删除 list 中单个的元素，也即是没有重复的元素，如 “cc”。在方法三和方法四中都会产生并发修改异常 ConcurrentModificationException，这两个删除方式中都用到了 ArrayList 中的 remove() 方法（快去上面看看代码吧）。而在删除 list 中重复的元素时，会有这么两种情况，一种是这两个重复元素是紧挨着的，如 “bb”，另一种是这两个重复元素没有紧挨着，如 “aa”。删除这种元素时，方法一在删除重复但不连续的元素时是正常的，但在删除重复且连续的元素时，会出现删除不完全的问题，这种删除方式也是用到了 ArrayList 中的 remove() 方法。而另外两种方法都是可以正常删除的，但是不推荐第五种方式，这个后面再说。</p>
<p>经过对运行结果的分析，发现问题都指向了 ArrayList 中的 remove() 方法，（感觉有种侦探办案的味道，可能是代码写多了的错觉吧，txtx&hellip;）那么看 ArrayList 源码是最好的选择了，下面是我截取的关键代码（Java1.8）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">public</span> <span class="nx">E</span> <span class="nx">remove</span><span class="p">(</span><span class="kr">int</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">rangeCheck</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>

    <span class="nx">modCount</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">E</span> <span class="nx">oldValue</span> <span class="o">=</span> <span class="nx">elementData</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>

    <span class="kr">int</span> <span class="nx">numMoved</span> <span class="o">=</span> <span class="nx">size</span> <span class="o">-</span> <span class="nx">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">numMoved</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nx">System</span><span class="p">.</span><span class="nx">arraycopy</span><span class="p">(</span><span class="nx">elementData</span><span class="p">,</span> <span class="nx">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">elementData</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span>
                         <span class="nx">numMoved</span><span class="p">);</span>
    <span class="nx">elementData</span><span class="p">[</span><span class="o">--</span><span class="nx">size</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// clear to let GC do its work
</span><span class="c1"></span>
    <span class="k">return</span> <span class="nx">oldValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">public</span> <span class="kr">boolean</span> <span class="nx">remove</span><span class="p">(</span><span class="nb">Object</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">o</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kr">int</span> <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">size</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">elementData</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">fastRemove</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kr">int</span> <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">size</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="nx">elementData</span><span class="p">[</span><span class="nx">index</span><span class="p">]))</span> <span class="p">{</span>
                <span class="nx">fastRemove</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">private</span> <span class="k">void</span> <span class="nx">fastRemove</span><span class="p">(</span><span class="kr">int</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">modCount</span><span class="o">++</span><span class="p">;</span>
    <span class="kr">int</span> <span class="nx">numMoved</span> <span class="o">=</span> <span class="nx">size</span> <span class="o">-</span> <span class="nx">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">numMoved</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nx">System</span><span class="p">.</span><span class="nx">arraycopy</span><span class="p">(</span><span class="nx">elementData</span><span class="p">,</span> <span class="nx">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">elementData</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span>
                         <span class="nx">numMoved</span><span class="p">);</span>
    <span class="nx">elementData</span><span class="p">[</span><span class="o">--</span><span class="nx">size</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// clear to let GC do its work
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>可以看到这个 remove() 方法被重载了，一种是根据下标删除，一种是根据元素删除，这也都很好理解。</p>
<p>根据下标删除的 remove() 方法，大致的步骤如下：</p>
<ul>
<li>1、检查有没有下标越界，就是检查一下当前的下标有没有大于等于数组的长度</li>
<li>2、列表被修改（add和remove操作）的次数加1</li>
<li>3、保存要删除的值</li>
<li>4、计算移动的元素数量</li>
<li>5、删除位置后面的元素向左移动，这里是用数组拷贝实现的</li>
<li>6、将最后一个位置引用设为 null，使垃圾回收器回收这块内存</li>
<li>7、返回删除元素的值</li>
</ul>
<p>根据元素删除的 remove() 方法，大致的步骤如下：</p>
<ul>
<li>1、元素值分为null和非null值</li>
<li>2、循环遍历判等</li>
<li>3、调用 fastRemove(i) 函数
<ul>
<li>3.1、修改次数加1</li>
<li>3.2、计算移动的元素数量</li>
<li>3.3、数组拷贝实现元素向左移动</li>
<li>3.4、将最后一个位置引用设为 null</li>
<li>3.5、返回 fase</li>
</ul>
</li>
<li>4、返回 true</li>
</ul>
<p>这里我有个疑问，第一个 remove() 方法中的代码和 fastRemove() 方法中的代码是完全一样的，第一个 remove() 方法完全可以向第二个 remove() 方法一样调用 fastRemove() 方法嘛，这里代码感觉有些冗余，个人理解有限，还请知道的大佬指教。</p>
<p>我们重点关注的是删除过程，学过数据结构的小伙伴可能手写过这样的删除，下面我画个图来让大家更清楚的看到整个删除的过程。以删除 “bb” 为例，当指到下标为 1 的元素时，发现是 &ldquo;bb&rdquo;，此处元素应该被删除，根据上面的删除步骤可知，删除位置后面的元素要向前移动，移动之后 “bb” 后面的 “bb” 元素下标为1，后面的元素下标也依次减1，这是在 i = 1 时循环的操作。在下一次循环中 i = 2，第二个 “bb” 元素就被遗漏了，所以这种删除方法在删除连续重复元素时会有问题。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./31.jpeg"
        data-srcset="./31.jpeg, ./31.jpeg 1.5x, ./31.jpeg 2x"
        data-sizes="auto"
        alt="./31.jpeg"
        title="31" /></p>
<center>循环中的正序删除.jpg</center>
<p>但是如果我们使 i 递减循环，也即是方法二的倒序循环，这个问题就不存在了，如下图。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./32.jpeg"
        data-srcset="./32.jpeg, ./32.jpeg 1.5x, ./32.jpeg 2x"
        data-sizes="auto"
        alt="./32.jpeg"
        title="32" /></p>
<center>循环中的倒序删除.jpg</center>
<p>既然我们已经搞清不能正常删除的原因，那么再来看看方法五中可以正常删除的原因。方法五中使用的是迭代器中的 remove() 方法，通过阅读 ArrayList 的源码可以发现，有两个私有内部类，Itr 和 ListItr，Itr 实现自 Iterator 接口，ListItr 继承 Itr 类和实现自 ListIterator 接口。Itr 类中也有一个 remove() 方法，迭代器实际调用的也正是这个 remove() 方法，我也截取这个方法的源码。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">private</span> <span class="kr">class</span> <span class="nx">Itr</span> <span class="kr">implements</span> <span class="nx">Iterator</span><span class="o">&lt;</span><span class="nx">E</span><span class="o">&gt;</span>
<span class="kr">private</span> <span class="kr">class</span> <span class="nx">ListItr</span> <span class="kr">extends</span> <span class="nx">Itr</span> <span class="kr">implements</span> <span class="nx">ListIterator</span><span class="o">&lt;</span><span class="nx">E</span><span class="o">&gt;</span> 
<span class="kr">public</span> <span class="k">void</span> <span class="nx">remove</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">lastRet</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">IllegalStateException</span><span class="p">();</span>
    <span class="nx">checkForComodification</span><span class="p">();</span> <span class="c1">// 检查修改次数
</span><span class="c1"></span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nx">ArrayList</span><span class="p">.</span><span class="k">this</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">lastRet</span><span class="p">);</span>
        <span class="nx">cursor</span> <span class="o">=</span> <span class="nx">lastRet</span><span class="p">;</span>
        <span class="nx">lastRet</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="nx">expectedModCount</span> <span class="o">=</span> <span class="nx">modCount</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">IndexOutOfBoundsException</span> <span class="nx">ex</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">ConcurrentModificationException</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kr">final</span> <span class="k">void</span> <span class="nx">checkForComodification</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">modCount</span> <span class="o">!=</span> <span class="nx">expectedModCount</span><span class="p">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">ConcurrentModificationException</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>可以看到这个 remove() 方法中调用了 ArrayList 中的 remove() 方法，那为什么方法四会抛出并发修改异常而这里就没有问题呢？这里注意 expectedModCount 变量和 modCount 变量，modCount 在前面的代码中也见到了，它记录了 list 修改的次数，而前面还有一个 expectedModCount，这个变量的初值和 modCount 相等。在 <code>ArrayList.this.remove(lastRet);</code> 代码前面，还调用了检查修改次数的方法 checkForComodification()，这个方法里面做的事情很简单，如果 modCount 和 expectedModCount 不相等，那么就抛出 ConcurrentModificationException，而在这个 remove() 方法中存在 ``expectedModCount = modCount`，两个变量值在 ArrayList 的 remove() 方法后，进行了同步，所以不会有异常抛出，并且在循环过程中，也不会遗漏连续重复的元素，所以可以正常删除。上面这些代码都是在单线程中执行的，如果换到多线程中，方法五不能保证两个变量修改的一致性，结果具有不确定性，所以不推荐这种方法。而方法一在单线程和多线程中都是可以正常删除的，多线程中测试代码如下，这里我只模拟了三个线程：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="nx">java</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">ArrayList</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">java</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">Iterator</span><span class="p">;</span>

<span class="kr">public</span> <span class="kr">class</span> <span class="nx">MultiThreadArrayList</span> <span class="p">{</span>
    <span class="kr">public</span> <span class="kr">static</span> <span class="k">void</span> <span class="nx">main</span><span class="p">(</span><span class="nb">String</span><span class="p">[]</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ArrayList</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span> <span class="nx">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayList</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&#34;aa&#34;</span><span class="p">);</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&#34;bb&#34;</span><span class="p">);</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&#34;bb&#34;</span><span class="p">);</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&#34;aa&#34;</span><span class="p">);</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&#34;cc&#34;</span><span class="p">);</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&#34;dd&#34;</span><span class="p">);</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&#34;dd&#34;</span><span class="p">);</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&#34;cc&#34;</span><span class="p">);</span>
        <span class="nx">Thread</span> <span class="nx">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Thread</span><span class="p">()</span> <span class="p">{</span>
            <span class="err">@</span><span class="nx">Override</span>
            <span class="kr">public</span> <span class="k">void</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">remove</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span><span class="s2">&#34;aa&#34;</span><span class="p">);</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="nx">Thread</span><span class="p">.</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">InterruptedException</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">e</span><span class="p">.</span><span class="nx">printStackTrace</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="nx">Thread</span> <span class="nx">thread2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Thread</span><span class="p">()</span> <span class="p">{</span>
            <span class="err">@</span><span class="nx">Override</span>
            <span class="kr">public</span> <span class="k">void</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">remove</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="s2">&#34;bb&#34;</span><span class="p">);</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="nx">Thread</span><span class="p">.</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">InterruptedException</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">e</span><span class="p">.</span><span class="nx">printStackTrace</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="nx">Thread</span> <span class="nx">thread3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Thread</span><span class="p">()</span> <span class="p">{</span>
            <span class="err">@</span><span class="nx">Override</span>
            <span class="kr">public</span> <span class="k">void</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">remove</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="s2">&#34;dd&#34;</span><span class="p">);</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="nx">Thread</span><span class="p">.</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">InterruptedException</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">e</span><span class="p">.</span><span class="nx">printStackTrace</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="c1">// 使各个线程处于就绪状态
</span><span class="c1"></span>        <span class="nx">thread1</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
        <span class="nx">thread2</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
        <span class="nx">thread3</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
        <span class="c1">// 等待前面几个线程完成
</span><span class="c1"></span>        <span class="k">try</span> <span class="p">{</span>
            <span class="nx">thread1</span><span class="p">.</span><span class="nx">join</span><span class="p">();</span>
            <span class="nx">thread2</span><span class="p">.</span><span class="nx">join</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">InterruptedException</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="nb">String</span> <span class="nx">str</span> <span class="o">:</span> <span class="nx">list</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">System</span><span class="p">.</span><span class="nx">out</span><span class="p">.</span><span class="nx">println</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kr">static</span> <span class="k">void</span> <span class="nx">remove</span><span class="p">(</span><span class="nx">ArrayList</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span> <span class="nx">list</span><span class="p">,</span> <span class="nb">String</span> <span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 普通for循环倒序删除，删除过程中元素向左移动，不影响连续删除
</span><span class="c1"></span>        <span class="k">for</span> <span class="p">(</span><span class="kr">int</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nx">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">list</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">equals</span><span class="p">(</span><span class="nx">elem</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">list</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">list</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">i</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// 迭代器删除，多线程环境下无法使用
</span><span class="c1">//        Iterator iterator = list.iterator();
</span><span class="c1">//        while (iterator.hasNext()) {
</span><span class="c1">//            if(iterator.next().equals(elem)) {
</span><span class="c1">//                iterator.remove();
</span><span class="c1">//            }
</span><span class="c1">//        }
</span><span class="c1"></span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>既然 Java 的循环删除有问题，发散一下思维，Python 中的列表删除会不会也有这样的问题呢，我抱着好奇试了试，发现下面的方法一也同样存在不能删除连续重复元素的问题，方法二则是报列表下标越界的异常，测试代码如下，这里我只测试了单线程环境：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="nx">list</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;aa&#34;</span><span class="p">)</span>
<span class="nx">list</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;bb&#34;</span><span class="p">)</span>
<span class="nx">list</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;bb&#34;</span><span class="p">)</span>
<span class="nx">list</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;aa&#34;</span><span class="p">)</span>
<span class="nx">list</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;cc&#34;</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">方法一</span>
<span class="err">#</span> <span class="k">for</span> <span class="nx">str</span> <span class="k">in</span> <span class="nx">list</span><span class="o">:</span>
<span class="err">#</span>     <span class="k">if</span> <span class="nx">str</span> <span class="o">==</span> <span class="s2">&#34;bb&#34;</span><span class="o">:</span>
<span class="err">#</span>         <span class="nx">list</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">方法二</span>
<span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">range</span><span class="p">(</span><span class="nx">len</span><span class="p">(</span><span class="nx">list</span><span class="p">))</span><span class="o">:</span>
    <span class="k">if</span> <span class="nx">list</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;bb&#34;</span><span class="o">:</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">list</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
<span class="k">for</span> <span class="nx">str</span> <span class="k">in</span> <span class="nx">list</span><span class="o">:</span>
    <span class="nx">print</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>总结：一道看似很简单的问题，没想到背后却有这么多的知识，真是感觉自己要学的还很多，遇到方法细节的问题，我觉得直接看源码是最好的解决方法，另外我觉得在后面的版本的 JDK 中，可以增加一个在循环中删除连续元素的方法嘛，不然这里对于没有发现这个问题的人真是个坑。</p>
<h3 id="javalist-与-数组-相互转换">JAVA：List 与 数组 相互转换</h3>
<h4 id="一-list-转化成-数组">一、 List 转化成 数组</h4>
<p><strong>1. list.toArray();</strong></p>
<p>直接将 list 转换成 Object[] 类型的 <a href="https://so.csdn.net/so/search?q=%e6%95%b0%e7%bb%84&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">数组</a>；</p>
<p><strong>Object ： 对象类，是所有类的父类</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Object</span><span class="o">[]</span>  <span class="n">ans1</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">toArray</span><span class="o">();</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>2. list.toArray(T[] a);</strong></p>
<p>输出指定类型的数组，输出的数组类型与括号中参数类型一致；</p>
<p>必须是包装类（String、Integer、Character等），不能是基本数据类型了（string、int、char）；</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 创建数组时： int [ ] arr = new int [ ] {}; 使用的是基本数据类型
</span><span class="c1"></span><span class="n">Integer</span><span class="o">[]</span> <span class="n">ans2</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="n">Integer</span><span class="o">[</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()]);</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>案例：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 创建一个list，并且对list赋值        
</span><span class="c1"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span>  <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>       
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">11</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	<span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
<span class="o">}</span>
 
<span class="c1">//方法一：
</span><span class="c1"></span><span class="n">Object</span><span class="o">[]</span>  <span class="n">ans1</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">toArray</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;1:&#34;</span> <span class="o">+</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">ans1</span><span class="o">));</span>
 
<span class="c1">// 方法二：
</span><span class="c1"></span><span class="n">Integer</span><span class="o">[]</span> <span class="n">ans2</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="n">Integer</span><span class="o">[</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()]);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;2:&#34;</span> <span class="o">+</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">ans2</span><span class="o">));</span>
 
<span class="nl">1:</span><span class="o">[</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">4</span><span class="o">,</span> <span class="n">5</span><span class="o">,</span> <span class="n">6</span><span class="o">,</span> <span class="n">7</span><span class="o">,</span> <span class="n">8</span><span class="o">,</span> <span class="n">9</span><span class="o">,</span> <span class="n">10</span><span class="o">]</span>
<span class="nl">2:</span><span class="o">[</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">4</span><span class="o">,</span> <span class="n">5</span><span class="o">,</span> <span class="n">6</span><span class="o">,</span> <span class="n">7</span><span class="o">,</span> <span class="n">8</span><span class="o">,</span> <span class="n">9</span><span class="o">,</span> <span class="n">10</span><span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="二数组-转换成-list">二、数组 转换成 list</h4>
<p><strong>1. Arrays.asList( );</strong></p>
<p>注意该方法的返回值是java.util.Arrays类中一个私有静态内部类java.util.Arrays.ArrayList，
它并非java.util.ArrayList类。
java.util.Arrays.ArrayList类具有set()，get()，contains()等方法，
但是不支持添加add()或删除remove()方法,调用这些方法会报错。</p>
<p>也就是说，此种方法残缺：重新得到的 list <strong>不能</strong> add( ) 或者 remove( );</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 因为list中是包装类。所以数组创建时也需要使用包装类 
</span><span class="c1"></span><span class="n">Integer</span><span class="o">[]</span> <span class="n">num</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Integer</span><span class="o">[]{</span><span class="n">1</span><span class="o">,</span><span class="n">2</span><span class="o">,</span><span class="n">3</span><span class="o">,</span><span class="n">4</span><span class="o">,</span><span class="n">5</span><span class="o">,</span><span class="n">6</span><span class="o">,</span><span class="n">7</span><span class="o">,</span><span class="n">8</span><span class="o">,</span><span class="n">9</span><span class="o">};</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">ans1</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
 
<span class="c1">//此时得到的list 不能 使用 add() 与 remove()方法；
</span><span class="c1">// 解决办法：
</span><span class="c1">//    创建一个新的list 对象，将残缺的list加入进去     
</span><span class="c1"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">ans1</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>2、Collections.addAll( );（此种方法最实用）</strong></p>
<p>直接创建一个新的 list 对象，然后使用<strong>Collections.addAll( )</strong> 方法。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Integer</span><span class="o">[]</span> <span class="n">num</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Integer</span><span class="o">[]{</span><span class="n">1</span><span class="o">,</span><span class="n">2</span><span class="o">,</span><span class="n">3</span><span class="o">,</span><span class="n">4</span><span class="o">,</span><span class="n">5</span><span class="o">,</span><span class="n">6</span><span class="o">,</span><span class="n">7</span><span class="o">,</span><span class="n">8</span><span class="o">,</span><span class="n">9</span><span class="o">};</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">ans2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="n">Collections</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">ans2</span><span class="o">,</span><span class="n">num</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="map">Map</h2>
<h3 id="特点">特点</h3>
<p>map 没有无序，不能下标访问，只能通过keyvalue进行访问，能增加随机访问的速度</p>
<h3 id="修改">修改</h3>
<p>map 直接put进行key，value覆盖修改即可，无需其他操作</p>
<h3 id="遍历map的几种方法">遍历Map的几种方法</h3>
<p>java中的map遍历有多种方法，从最早的Iterator，到java5支持的foreach,再到java8 Lambda，让我们一起来看下具体的用法以及各自的优缺点</p>
<p>先初始化一个map</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestMap</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="keyset-values">keySet values</h4>
<p>如果只需要map的key或者value，用map的keySet或values方法无疑是最方便的</p>
<p>返回值类型<code>Set&lt;k&gt;</code>    方法是： <code>keySet()</code>   :返回此映射中包含的键的 <code>Set</code> 视图将<code>Map</code>中所有的键存入到<code>Set</code>集合，因为<code>Set</code>具备迭代器，所有迭代方式取出所有的键再根据<code>get()</code>方法  ，获取每一个键对应的值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">// KeySet 获取key
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testKeySet</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">key</span> <span class="o">:</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">// values 获取value
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testValues</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">value</span> <span class="o">:</span> <span class="n">map</span><span class="o">.</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="keyset-getkey">keySet get(key)</h4>
<p>如果需要同时获取key和value，可以先获取key,然后再通过map的get(key)获取value</p>
<p>需要说明的是，该方法不是最优选择，一般不推荐使用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">// keySet get(key) 获取key and value
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testKeySetAndGetKey</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">key</span> <span class="o">:</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">key</span> <span class="o">+</span> <span class="s">&#34;:&#34;</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
    <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="entryset">entrySet</h4>
<p>通过对map entrySet的遍历，也可以同时拿到key和value，一般情况下，性能上要优于上一种,这一种也是最常用的遍历方法</p>
<p>返回值类型：<code>Set&lt;Map.Entry&lt;K,V&gt;&gt;</code>方法是：<code>entrySet()</code>取出的是关系，关系中包含<code>key</code>和<code>value</code>,其中Map.Entry&lt;k,V&gt;来表示这种数据类型即：将<code>Map</code>集合中的映射关系存入到<code>Set</code>集合中，这个关系的数据类型为:Map.Entry</p>
<p><code>Map.Entry</code>接口,此接口在java.util包中，其实Entry也是一个接口，它是Map接口中的一个内部接口 ,<code>getKey()</code>和<code>getValue</code>是接口<code>Map.Entry&lt;K,V&gt;</code>中的方法，返回对应的键和对应的值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">// entrySet 获取key and value
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testEntry</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;:&#34;</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="iterator">Iterator</h4>
<p>对于上面的几种foreach都可以用Iterator代替，其实foreach在java5中才被支持，foreach的写法看起来更简洁</p>
<p>但Iterator也有其优势：在用foreach遍历map时，如果改变其大小，会报错，但如果只是删除元素，可以使用Iterator的remove方法删除元素</p>
<blockquote>
<p>HashMap 继承于AbstractMap，实现了Map、Cloneable、java.io.Serializable接口。
AbstractMap实现了Map接口。
Map接口里面有一个forEach方法，@since 1.8。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">default</span> <span class="kt">void</span> <span class="nf">forEach</span><span class="o">(</span><span class="n">BiConsumer</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">K</span><span class="o">,</span> <span class="o">?</span> <span class="kd">super</span> <span class="n">V</span><span class="o">&gt;</span> <span class="n">action</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">action</span><span class="o">);</span>
       <span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">entrySet</span><span class="o">())</span> <span class="o">{</span>
           <span class="n">K</span> <span class="n">k</span><span class="o">;</span>
           <span class="n">V</span> <span class="n">v</span><span class="o">;</span>
           <span class="k">try</span> <span class="o">{</span>
               <span class="n">k</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
               <span class="n">v</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
           <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">IllegalStateException</span> <span class="n">ise</span><span class="o">)</span> <span class="o">{</span>
               <span class="c1">// this usually means the entry is no longer in the map.
</span><span class="c1"></span>               <span class="k">throw</span> <span class="k">new</span> <span class="n">ConcurrentModificationException</span><span class="o">(</span><span class="n">ise</span><span class="o">);</span>
           <span class="o">}</span>
           <span class="n">action</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">);</span>
       <span class="o">}</span>
   <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>官方解释：
对此映射中的每个条目执行给定操作，直到所有条目已处理或操作引发异常。除非由实现类指定，操作将在入口集迭代的顺序（如果指定了迭代顺序）。
操作引发的异常将中继到调用方。</p>
<p>解读：
使用了try catch 抛出的异常为ConcurrentModificationException，标示在线程并发进行读写的时候会出现异常，即，不支持并发操作。</p>
</blockquote>
<p>Map集合中是没有迭代器 的 ,Map集合取	出键值的原理：将map集合转成set集合，再通过迭代器取出</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">// Iterator entrySet 获取key and value
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testIterator</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;:&#34;</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
      <span class="c1">// it.remove(); 删除元素
</span><span class="c1"></span>    <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">//Map.Entry的剖析和getKey(),getValue()的由来：
</span><span class="c1"></span><span class="kd">interface</span> <span class="nc">Map</span><span class="o">{</span>
 <span class="c1">//此内部接口的特点是静态的，而且是对外提供访问的
</span><span class="c1"></span>     <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">Entry</span><span class="o">{</span>

         <span class="c1">//因为具体情况要视情况而定，所以是抽象的，具体由子类来实现
</span><span class="c1"></span>
         <span class="kd">public</span> <span class="kd">abstract</span> <span class="n">Object</span> <span class="nf">getKey</span><span class="o">();</span>
         <span class="kd">public</span> <span class="kd">abstract</span> <span class="n">Object</span> <span class="nf">getValue</span><span class="o">();</span>   
                  <span class="o">}</span>
             <span class="o">}</span>
<span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">HashMap</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">{</span>
    <span class="c1">//内部类实现Map.Entry
</span><span class="c1"></span>    <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Hahs</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">{</span>
        <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getKey</span><span class="o">(){}</span>
        <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getValue</span><span class="o">(){}</span>
    <span class="o">}</span>
    
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>keySet()</code>取值方式示例图：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./16.png"
        data-srcset="./16.png, ./16.png 1.5x, ./16.png 2x"
        data-sizes="auto"
        alt="./16.png"
        title="16" /></p>
<p><code>entrySet()</code>取值方式示例图：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./17.png"
        data-srcset="./17.png, ./17.png 1.5x, ./17.png 2x"
        data-sizes="auto"
        alt="./17.png"
        title="17" /></p>
<p><strong>注意</strong></p>
<p>Entry是接口 ，但是为什么不定义定义在外面呢？</p>
<blockquote>
<p>Entry代表的是映射关系，先有Map集合，才有的映射关系，所以它是Map集合内部的事物，因此将Entry定义为
在Map的内部集合，可以直接访问Map集合中的元素
在API文档中有 <code>public static interface Map.Entry&lt;K,V&gt;</code>  其中被static静态修饰，只有接口在
成员位置上才能加静态修饰符 ,说明其是内部接口</p>
</blockquote>
<h4 id="lambda">Lambda</h4>
<p>java8提供了Lambda表达式支持，语法看起来更简洁，可以同时拿到key和value，不过，经测试，性能低于entrySet,所以更推荐用entrySet的方式</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">// Lambda 获取key and value
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testLambda</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">map</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">key</span> <span class="o">+</span> <span class="s">&#34;:&#34;</span> <span class="o">+</span> <span class="n">value</span><span class="o">);</span>
    <span class="o">});</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="简单性能测试">简单性能测试</h4>
<p>用10万条数据，做了一个简单性能测试，数据类型为Integer，map实现选取HashMap</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="kd">static</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">100000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">1</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>测试结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">KeySet</span><span class="err">：</span>           <span class="n">392</span>
<span class="n">Values</span><span class="err">：</span>           <span class="n">320</span>
<span class="n">keySet</span> <span class="nf">get</span><span class="o">(</span><span class="n">key</span><span class="o">)</span><span class="err">：</span>  <span class="n">552</span>
<span class="n">entrySet</span><span class="err">：</span>         <span class="n">465</span>
<span class="n">entrySet</span> <span class="n">Iterator</span><span class="err">：</span><span class="n">508</span>
<span class="n">Lambda</span><span class="err">：</span>           <span class="n">536</span>
</code></pre></td></tr></table>
</div>
</div><p>需要说明的是，map存储的数据类型，map的大小，以及map的不同实现方式都会影响遍历的性能，所以该测试结果仅供参考</p>
<h4 id="总结">总结</h4>
<p>如果只是获取key，或者value，推荐使用keySet或者values方式</p>
<p>如果同时需要key和value推荐使用entrySet</p>
<p>如果需要在遍历过程中删除元素推荐使用Iterator</p>
<p>如果需要在遍历过程中增加元素，可以新建一个临时map存放新增的元素，等遍历完毕，再把临时map放到原来的map中</p>
<h4 id="分析">分析</h4>
<p>一般来讲使用entrySet的方式进行遍历是效率最高的，因为hashMap内部的存储结构就是基于Entry的数组，在用这种方式进行遍历时，只需要遍历一次即可。而使用其他方式的时间复杂度可以会提高，例如：keySet方式，每次都需要通过key值去计算对应的hash,然后再通过hash获取对应的结果值，因此效率较低。</p>
<h4 id="扩容机制">扩容机制</h4>
<ol>
<li>
<p>导读
上期分享了HashMap的key定位以及数据节点的设计, 本期就下面三个问题来分享下个人对于HashMap扩容的理解:
.1 HashMap为什么要扩容? 何时扩容?
.2 负载因子为什么是0.75?
.3 HashMap如何扩容;</p>
</li>
<li>
<p>HashMap为什么要扩容
经过上期分享, 我们都知道HashMap在构建初始是可以指定table(hash槽)的长度的, 假设我们设定了2, 这时候有10万数据要插入, 最好的情况就是两边各是5万, 最差的情况就是一边是10万, 显然这个时候hash冲突已经很严重了, 为了解决冲突, 我们就需要对table进行扩容, 所以HashMap的扩容就是加长table的长度, 来减少hash冲突的概率;</p>
</li>
<li>
<p>HashMap何时扩容
HashMap是如何来判定何时该扩容的呢?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">     <span class="kd">final</span> <span class="n">V</span> <span class="nf">putVal</span><span class="o">(</span><span class="kt">int</span> <span class="n">hash</span><span class="o">,</span> <span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">onlyIfAbsent</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">evict</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">((</span><span class="n">tab</span> <span class="o">=</span> <span class="n">table</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">(</span><span class="n">n</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span>
                <span class="n">n</span> <span class="o">=</span> <span class="o">(</span><span class="n">tab</span> <span class="o">=</span> <span class="n">resize</span><span class="o">()).</span><span class="na">length</span><span class="o">;</span>
        <span class="o">...</span>
        <span class="k">if</span> <span class="o">(++</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="o">)</span>
            <span class="n">resize</span><span class="o">();</span>
        <span class="o">...</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>上面代码是HashMap::put的核心实现, 我将与本问题无关的代码都省略了, HashMap会在两个地方进行resize(扩容):
.1 HashMap实行了懒加载, 新建HashMap时不会对table进行赋值, 而是到第一次插入时, 进行resize时构建table;
.2 当HashMap.size 大于 threshold时, 会进行resize;threshold的值我们在上一次分享中提到过: 当第一次构建时, 如果没有指定HashMap.table的初始长度, 就用默认值16, 否则就是指定的值; 然后不管是第一次构建还是后续扩容, threshold = table.length * loadFactor;</p>
<ol start="3">
<li>为什么是0.75
HashMap的扩容时取决于threshold, 而threshold取决于loadFactor, loadFactor(负载因子)HashMap的默认值是0.75(3/4), 那么为什么当HashMap的容量超过3/4时就需要扩容了呢? 为什么不是1/2扩容 或者 等于table.length时扩容呢?
答案就在HashMap的注释中:</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"> <span class="cm">/**
</span><span class="cm">     *  Ideally, under random hashCodes, the frequency of
</span><span class="cm">     *     nodes in bins follows a Poisson distribution
</span><span class="cm">     *  (http://en.wikipedia.org/wiki/Poisson_distribution) with a
</span><span class="cm">     *     parameter of about 0.5 on average for the default resizing
</span><span class="cm">     *     threshold of 0.75, although with a large variance because of
</span><span class="cm">     *     resizing granularity. Ignoring variance, the expected
</span><span class="cm">     *     occurrences of list size k are (exp(-0.5) * pow(0.5, k) /
</span><span class="cm">     *     factorial(k)). The first values are:
</span><span class="cm">     *
</span><span class="cm">     * 0:    0.60653066
</span><span class="cm">     * 1:    0.30326533
</span><span class="cm">     * 2:    0.07581633
</span><span class="cm">     * 3:    0.01263606
</span><span class="cm">     * 4:    0.00157952
</span><span class="cm">     * 5:    0.00015795
</span><span class="cm">     * 6:    0.00001316
</span><span class="cm">     * 7:    0.00000094
</span><span class="cm">     * 8:    0.00000006
</span><span class="cm">     * 
</span><span class="cm">     */</span>
</code></pre></td></tr></table>
</div>
</div><p>根据统计学的结果, hash冲突是符合泊松分布的, 而冲突概率最小的是在7-8之间, 都小于百万分之一了; 所以HashMap.loadFactor选取只要在7-8之间的任意值即可, 但是为什么就选了3/4这个值, 我们看了HashMap的扩容机制也就知道了;</p>
<ol start="4">
<li>HashMap如何扩容
因为扩容的代码比较长, 我用文字来叙述下HashMap扩容的过程:
.1 如果table == null, 则为HashMap的初始化, 生成空table返回即可;
.2 如果table不为空, 需要重新计算table的长度, newLength = oldLength &laquo; 1(注, 如果原oldLength已经到了上限, 则newLength = oldLength);
.3 遍历oldTable:
.3.2 首节点为空, 本次循环结束;
.3.1 无后续节点, 重新计算hash位, 本次循环结束;
.3.2 当前是红黑树, 走红黑树的重定位;
.3.3 当前是链表, JAVA7时还需要重新计算hash位, 但是JAVA8做了优化, 通过(e.hash &amp; oldCap) == 0来判断是否需要移位; 如果为真则在原位不动, 否则则需要移动到当前hash槽位 + oldCap的位置;</li>
</ol>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./11.png"
        data-srcset="./11.png, ./11.png 1.5x, ./11.png 2x"
        data-sizes="auto"
        alt="./11.png"
        title="11" /></p>
<p>HashMap::resize的核心就是上图, 链表与红黑树的resize过程大同小异: 红黑树是把构建新链表的过程变为构建两颗新的红黑树, 定位table中的index都是用的 e.hash &amp; oldCap == 0 来判断;
再来看下 e.hash &amp; oldCap == 0为什么可以判断当前节点是否需要移位, 而不是再次计算hash;
仍然是原始长度为16举例:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">   <span class="n">old</span><span class="o">:</span>
   <span class="n">10</span><span class="o">:</span> <span class="n">0000</span> <span class="n">1010</span>
   <span class="n">15</span><span class="o">:</span> <span class="n">0000</span> <span class="n">1111</span>
    <span class="o">&amp;:</span> <span class="n">0000</span> <span class="n">1010</span>    
    
   <span class="k">new</span><span class="o">:</span>
   <span class="n">10</span><span class="o">:</span> <span class="n">0000</span> <span class="n">1010</span>
   <span class="n">31</span><span class="o">:</span> <span class="n">0001</span> <span class="n">1111</span>
    <span class="o">&amp;:</span> <span class="n">0001</span> <span class="n">1010</span>    
</code></pre></td></tr></table>
</div>
</div><p>从上面的示例可以很轻易的看出, 两次indexFor()的差别只是第二次参与位于比第一次左边有一位从0变为1, 而这个变化的1刚好是oldCap, 那么只需要判断原key的hash这个位上是否为1: 若是1, 则需要移动至oldCap + i的槽位, 若为0, 则不需要移动;
这也是HashMap的长度必须保证是2的倍数的原因, 正因为这种环环相扣的设计, HashMap.loadFactor的选值是3/4就能理解了, table.length * 3/4可以被优化为<code>(table.length &gt;&gt; 2) &lt;&lt; 2) - (table.length &gt;&gt; 2) == table.length - (table.lenght &gt;&gt; 2)</code>, JAVA的位运算比乘除的效率更高, 所以取3/4在保证hash冲突小的情况下兼顾了效率;</p>
<ol start="5">
<li>
<p>JDK8对JDK7的优化</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="kt">void</span> <span class="nf">transfer</span><span class="o">(</span><span class="n">Entry</span><span class="o">[]</span> <span class="n">newTable</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">rehash</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">newCapacity</span> <span class="o">=</span> <span class="n">newTable</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">:</span> <span class="n">table</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">while</span><span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">next</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">rehash</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">hash</span> <span class="o">=</span> <span class="kc">null</span> <span class="o">==</span> <span class="n">e</span><span class="o">.</span><span class="na">key</span> <span class="o">?</span> <span class="n">0</span> <span class="o">:</span> <span class="n">hash</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">key</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">indexFor</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span><span class="o">,</span> <span class="n">newCapacity</span><span class="o">);</span>
                <span class="n">e</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">newTable</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                <span class="n">newTable</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">next</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./12.png"
        data-srcset="./12.png, ./12.png 1.5x, ./12.png 2x"
        data-sizes="auto"
        alt="./12.png"
        title="12" /></p>
<p>上面的代码是JAVA7中对于HashMap节点重新定位的代码, 我们都知道HashMap是非线程安全的, 最主要的原因是他在resize的时候会形成环形链表, 然后导致get时死循环;
resize前的HashMap如下图所示:</p>
<p>这时候有两个线程需要插入第四个节点, 这个时候HashMap就需要做resize了,我们先假设线程已经resize完成, 而线程二必须等线程一完成再resize:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./13.png"
        data-srcset="./13.png, ./13.png 1.5x, ./13.png 2x"
        data-sizes="auto"
        alt="./13.png"
        title="13" /></p>
<p>经过线程一resize后, 可以发现a b节点的顺序被反转了, 这时候我们来看线程二:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./14.png"
        data-srcset="./14.png, ./14.png 1.5x, ./14.png 2x"
        data-sizes="auto"
        alt="./14.png"
        title="14" /></p>
<p>.1 线程二的开始点是只获取到A节点, 还没获取他的next;
.2 这时候线程一resize完成, a.next = null; b.next = a; newTable[i] = b;
.3 线程二开始执行, 获取A节点的next节点, a.next = null;
.4 接着执行 a.next = newTable[i]; 因为这时候newTable[i]已经是B节点了, 并且b.next = a; 那么我们把newTablei赋值给a.next后, 就会线程a-b-a这样的环形链表了, 也就是上图的结果;
.5 因为第三步的a.next已经是null, 所以C节点就丢失了;
.6 那这时候来查位于1节点的数据D(其实不存在), 因为 d != a, 会接着查a.next, 也就是b; 但是b != d, 所以接着查b.next, 但是b.next还是a; 这就悲剧了, 在循环里出不去了;
这就是JDK7resize最大的缺陷, 会形成死循环;
那么JDK8做了优化以后, 死循环的问题解除了吗?</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./15.png"
        data-srcset="./15.png, ./15.png 1.5x, ./15.png 2x"
        data-sizes="auto"
        alt="./15.png"
        title="15" /></p>
<p>通过上图我们发现JDK8的resize是让节点的顺序发生改变的, 也就是没有倒排问题了;也是假设有两个线程, 线程一已执行完成, 这时候线程二来执行:
.1 因为顺序没变, 所以node1.next还是node2, 只是node2.next从node3变成了null;
.2 而且JDK8是在遍历完所有节点之后, 才对形成的两个链表进行关联table的, 所以不会像JAVA7一般形成A-B-A问题了;
.3 但是如果并发了, JAVA的HashMap还是没有解决丢数据的问题, 但是不和JAVA7一般有数据倒排以及死循环的问题了;</p>
<h5 id="hashmap设计时就是没有保证线程安全的-所以在多线程环境请使用concurrenthashmap">HashMap设计时就是没有保证线程安全的, 所以在多线程环境请使用ConcurrentHashMap;</h5>
<hr>
<p><a href="https://blog.csdn.net/weixin_39667787/article/details/86678215" target="_blank" rel="noopener noreferrer">原文</a></p>
<p>以下为JDK8 resize方法详解</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;[]</span> <span class="nf">resize</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Node</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;[]</span> <span class="n">oldTab</span> <span class="o">=</span> <span class="n">table</span><span class="o">;</span> <span class="c1">//当前所有元素所在的数组，称为老的元素数组
</span><span class="c1"></span>        <span class="kt">int</span> <span class="n">oldCap</span> <span class="o">=</span> <span class="o">(</span><span class="n">oldTab</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="n">0</span> <span class="o">:</span> <span class="n">oldTab</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="c1">//老的元素数组长度
</span><span class="c1"></span>        <span class="kt">int</span> <span class="n">oldThr</span> <span class="o">=</span> <span class="n">threshold</span><span class="o">;</span>	<span class="c1">// 老的扩容阀值设置
</span><span class="c1"></span>        <span class="kt">int</span> <span class="n">newCap</span><span class="o">,</span> <span class="n">newThr</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>	<span class="c1">// 新数组的容量，新数组的扩容阀值都初始化为0
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">oldCap</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>	<span class="c1">// 如果老数组长度大于0，说明已经存在元素
</span><span class="c1"></span>            <span class="c1">// PS1
</span><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">oldCap</span> <span class="o">&gt;=</span> <span class="n">MAXIMUM_CAPACITY</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// 如果数组元素个数大于等于限定的最大容量（2的30次方）
</span><span class="c1"></span>                <span class="c1">// 扩容阀值设置为int最大值（2的31次方 -1 ），因为oldCap再乘2就溢出了。
</span><span class="c1"></span>                <span class="n">threshold</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">;</span>	
                <span class="k">return</span> <span class="n">oldTab</span><span class="o">;</span>	<span class="c1">// 返回老的元素数组
</span><span class="c1"></span>            <span class="o">}</span>
 
           <span class="cm">/*
</span><span class="cm">            * 如果数组元素个数在正常范围内，那么新的数组容量为老的数组容量的2倍（左移1位相当于乘以2）
</span><span class="cm">            * 如果扩容之后的新容量小于最大容量  并且  老的数组容量大于等于默认初始化容量（16），那么新数组的扩容阀值设置为老阀值的2倍。（老的数组容量大于16意味着：要么构造函数指定了一个大于16的初始化容量值，要么已经经历过了至少一次扩容）
</span><span class="cm">            */</span>
            <span class="k">else</span> <span class="k">if</span> <span class="o">((</span><span class="n">newCap</span> <span class="o">=</span> <span class="n">oldCap</span> <span class="o">&lt;&lt;</span> <span class="n">1</span><span class="o">)</span> <span class="o">&lt;</span> <span class="n">MAXIMUM_CAPACITY</span> <span class="o">&amp;&amp;</span>
                     <span class="n">oldCap</span> <span class="o">&gt;=</span> <span class="n">DEFAULT_INITIAL_CAPACITY</span><span class="o">)</span>
                <span class="n">newThr</span> <span class="o">=</span> <span class="n">oldThr</span> <span class="o">&lt;&lt;</span> <span class="n">1</span><span class="o">;</span> <span class="c1">// double threshold
</span><span class="c1"></span>        <span class="o">}</span>
 
        <span class="c1">// PS2
</span><span class="c1"></span>        <span class="c1">// 运行到这个else if  说明老数组没有任何元素
</span><span class="c1"></span>        <span class="c1">// 如果老数组的扩容阀值大于0，那么设置新数组的容量为该阀值
</span><span class="c1"></span>        <span class="c1">// 这一步也就意味着构造该map的时候，指定了初始化容量。
</span><span class="c1"></span>        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">oldThr</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="c1">// initial capacity was placed in threshold
</span><span class="c1"></span>            <span class="n">newCap</span> <span class="o">=</span> <span class="n">oldThr</span><span class="o">;</span>
        <span class="k">else</span> <span class="o">{</span>               <span class="c1">// zero initial threshold signifies using defaults
</span><span class="c1"></span>            <span class="c1">// 能运行到这里的话，说明是调用无参构造函数创建的该map，并且第一次添加元素
</span><span class="c1"></span>            <span class="n">newCap</span> <span class="o">=</span> <span class="n">DEFAULT_INITIAL_CAPACITY</span><span class="o">;</span>	<span class="c1">// 设置新数组容量 为 16
</span><span class="c1"></span>            <span class="n">newThr</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)(</span><span class="n">DEFAULT_LOAD_FACTOR</span> <span class="o">*</span> <span class="n">DEFAULT_INITIAL_CAPACITY</span><span class="o">);</span> <span class="c1">// 设置新数组扩容阀值为 16*0.75 = 12。0.75为负载因子（当元素个数达到容量了4分之3，那么扩容）
</span><span class="c1"></span>        <span class="o">}</span>
 
        <span class="c1">// 如果扩容阀值为0 （PS2的情况）
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">newThr</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">float</span> <span class="n">ft</span> <span class="o">=</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span><span class="n">newCap</span> <span class="o">*</span> <span class="n">loadFactor</span><span class="o">;</span>
            <span class="n">newThr</span> <span class="o">=</span> <span class="o">(</span><span class="n">newCap</span> <span class="o">&lt;</span> <span class="n">MAXIMUM_CAPACITY</span> <span class="o">&amp;&amp;</span> <span class="n">ft</span> <span class="o">&lt;</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span><span class="n">MAXIMUM_CAPACITY</span> <span class="o">?</span>
                      <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">ft</span> <span class="o">:</span> <span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">);</span>  <span class="c1">// 参见：PS2
</span><span class="c1"></span>        <span class="o">}</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">newThr</span><span class="o">;</span> <span class="c1">// 设置map的扩容阀值为 新的阀值
</span><span class="c1"></span>        <span class="nd">@SuppressWarnings</span><span class="o">({</span><span class="s">&#34;rawtypes&#34;</span><span class="o">,</span><span class="s">&#34;unchecked&#34;</span><span class="o">})</span>
            <span class="c1">// 创建新的数组（对于第一次添加元素，那么这个数组就是第一个数组；对于存在oldTab的时候，那么这个数组就是要需要扩容到的新数组）
</span><span class="c1"></span>            <span class="n">Node</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;[]</span> <span class="n">newTab</span> <span class="o">=</span> <span class="o">(</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;[])</span><span class="k">new</span> <span class="n">Node</span><span class="o">[</span><span class="n">newCap</span><span class="o">];</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">newTab</span><span class="o">;</span>	<span class="c1">// 将该map的table属性指向到该新数组
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">oldTab</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>	<span class="c1">// 如果老数组不为空，说明是扩容操作，那么涉及到元素的转移操作
</span><span class="c1"></span>            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">oldCap</span><span class="o">;</span> <span class="o">++</span><span class="n">j</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// 遍历老数组
</span><span class="c1"></span>                <span class="n">Node</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">e</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">((</span><span class="n">e</span> <span class="o">=</span> <span class="n">oldTab</span><span class="o">[</span><span class="n">j</span><span class="o">])</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// 如果当前位置元素不为空，那么需要转移该元素到新数组
</span><span class="c1"></span>                    <span class="n">oldTab</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// 释放掉老数组对于要转移走的元素的引用（主要为了使得数组可被回收）
</span><span class="c1"></span>                    <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">next</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="c1">// 如果元素没有有下一个节点，说明该元素不存在hash冲突
</span><span class="c1"></span>                        <span class="c1">// PS3
</span><span class="c1"></span>                        <span class="c1">// 把元素存储到新的数组中，存储到数组的哪个位置需要根据hash值和数组长度来进行取模
</span><span class="c1"></span>                        <span class="c1">// 【hash值  %   数组长度】   =    【  hash值   &amp; （数组长度-1）】
</span><span class="c1"></span>                        <span class="c1">//  这种与运算求模的方式要求  数组长度必须是2的N次方，但是可以通过构造函数随意指定初始化容量呀，如果指定了17,15这种，岂不是出问题了就？没关系，最终会通过tableSizeFor方法将用户指定的转化为大于其并且最相近的2的N次方。 15 -&gt; 16、17-&gt; 32
</span><span class="c1"></span>                        <span class="n">newTab</span><span class="o">[</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span> <span class="o">&amp;</span> <span class="o">(</span><span class="n">newCap</span> <span class="o">-</span> <span class="n">1</span><span class="o">)]</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
 
                        <span class="c1">// 如果该元素有下一个节点，那么说明该位置上存在一个链表了（hash相同的多个元素以链表的方式存储到了老数组的这个位置上了）
</span><span class="c1"></span>                        <span class="c1">// 例如：数组长度为16，那么hash值为1（1%16=1）的和hash值为17（17%16=1）的两个元素都是会存储在数组的第2个位置上（对应数组下标为1），当数组扩容为32（1%32=1）时，hash值为1的还应该存储在新数组的第二个位置上，但是hash值为17（17%32=17）的就应该存储在新数组的第18个位置上了。
</span><span class="c1"></span>                        <span class="c1">// 所以，数组扩容后，所有元素都需要重新计算在新数组中的位置。
</span><span class="c1"></span> 
 
                    <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="k">instanceof</span> <span class="n">TreeNode</span><span class="o">)</span>  <span class="c1">// 如果该节点为TreeNode类型
</span><span class="c1"></span>                        <span class="o">((</span><span class="n">TreeNode</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;)</span><span class="n">e</span><span class="o">).</span><span class="na">split</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">newTab</span><span class="o">,</span> <span class="n">j</span><span class="o">,</span> <span class="n">oldCap</span><span class="o">);</span>  <span class="c1">// 此处单独展开讨论
</span><span class="c1"></span>                    <span class="k">else</span> <span class="o">{</span> <span class="c1">// preserve order
</span><span class="c1"></span>                        <span class="n">Node</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">loHead</span> <span class="o">=</span> <span class="kc">null</span><span class="o">,</span> <span class="n">loTail</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>  <span class="c1">// 按命名来翻译的话，应该叫低位首尾节点
</span><span class="c1"></span>                        <span class="n">Node</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">hiHead</span> <span class="o">=</span> <span class="kc">null</span><span class="o">,</span> <span class="n">hiTail</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>  <span class="c1">// 按命名来翻译的话，应该叫高位首尾节点
</span><span class="c1"></span>                        <span class="c1">// 以上的低位指的是新数组的 0  到 oldCap-1 、高位指定的是oldCap 到 newCap - 1
</span><span class="c1"></span>                        <span class="n">Node</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">next</span><span class="o">;</span>
                        <span class="c1">// 遍历链表
</span><span class="c1"></span>                        <span class="k">do</span> <span class="o">{</span>  
                            <span class="n">next</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
                            <span class="c1">// 这一步判断好狠，拿元素的hash值  和  老数组的长度  做与运算
</span><span class="c1"></span>                            <span class="c1">// PS3里曾说到，数组的长度一定是2的N次方（例如16），如果hash值和该长度做与运算，结果为0，就说明该hash值小于数组长度（例如hash值为7），
</span><span class="c1"></span>                            <span class="c1">// 那么该hash值再和新数组的长度取摸的话mod值也不会放生变化，所以该元素的在新数组的位置和在老数组的位置是相同的，所以该元素可以放置在低位链表中。
</span><span class="c1"></span>                            <span class="k">if</span> <span class="o">((</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span> <span class="o">&amp;</span> <span class="n">oldCap</span><span class="o">)</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>  
                                <span class="c1">// PS4
</span><span class="c1"></span>                                <span class="k">if</span> <span class="o">(</span><span class="n">loTail</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="c1">// 如果没有尾，说明链表为空
</span><span class="c1"></span>                                    <span class="n">loHead</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span> <span class="c1">// 链表为空时，头节点指向该元素
</span><span class="c1"></span>                                <span class="k">else</span>
                                    <span class="n">loTail</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span> <span class="c1">// 如果有尾，那么链表不为空，把该元素挂到链表的最后。
</span><span class="c1"></span>                                <span class="n">loTail</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span> <span class="c1">// 把尾节点设置为当前元素
</span><span class="c1"></span>                            <span class="o">}</span>
 
                            <span class="c1">// 如果与运算结果不为0，说明hash值大于老数组长度（例如hash值为17）
</span><span class="c1"></span>                            <span class="c1">// 此时该元素应该放置到新数组的高位位置上
</span><span class="c1"></span>                            <span class="c1">// 例：老数组长度16，那么新数组长度为32，hash为17的应该放置在数组的第17个位置上，也就是下标为16，那么下标为16已经属于高位了，低位是[0-15]，高位是[16-31]
</span><span class="c1"></span>                            <span class="k">else</span> <span class="o">{</span>  <span class="c1">// 以下逻辑同PS4
</span><span class="c1"></span>                                <span class="k">if</span> <span class="o">(</span><span class="n">hiTail</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
                                    <span class="n">hiHead</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                                <span class="k">else</span>
                                    <span class="n">hiTail</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                                <span class="n">hiTail</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                            <span class="o">}</span>
                        <span class="o">}</span> <span class="k">while</span> <span class="o">((</span><span class="n">e</span> <span class="o">=</span> <span class="n">next</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">loTail</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// 低位的元素组成的链表还是放置在原来的位置
</span><span class="c1"></span>                            <span class="n">loTail</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                            <span class="n">newTab</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">loHead</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">hiTail</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>  <span class="c1">// 高位的元素组成的链表放置的位置只是在原有位置上偏移了老数组的长度个位置。
</span><span class="c1"></span>                            <span class="n">hiTail</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                            <span class="n">newTab</span><span class="o">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">oldCap</span><span class="o">]</span> <span class="o">=</span> <span class="n">hiHead</span><span class="o">;</span> <span class="c1">// 例：hash为 17 在老数组放置在0下标，在新数组放置在16下标；    hash为 18 在老数组放置在1下标，在新数组放置在17下标；                   
</span><span class="c1"></span>                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">newTab</span><span class="o">;</span> <span class="c1">// 返回新数组
</span><span class="c1"></span>    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><a href="https://blog.csdn.net/weixin_42340670/article/details/80503517" target="_blank" rel="noopener noreferrer">原文</a></p>
<h3 id="hashmap-的-7-种遍历方式与性能分析">HashMap 的 7 种遍历方式与性能分析</h3>
<p>首先，给大家说声抱歉~</p>
<p>事情经过是这样子的，五一节前我发布了一篇文章<a href="http://mp.weixin.qq.com/s?__biz=MzU1NTkwODE4Mw==&amp;mid=2247485176&amp;idx=1&amp;sn=961fcc0e4dd05a505ef0fc1eb5b10ac4&amp;chksm=fbcc6bc0ccbbe2d67850eb654fb8d72f3f2df3fa0ff1133700a0972728679863a9c5fad559e5&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">《HashMap 的 7 种遍历方式与性能分析！》</a>，但是好心的网友却发现了一个问题，他说 <strong>“<strong><strong>测试时使用了 sout 打印信息会导致测试的结果不准确，因为这样测试的话，大部分的性能消耗其实来源于信息打印</strong></strong>”</strong>，我细想了一下，<strong>说的确实有道理，于是我就重写了测试部分的代码</strong>。</p>
<p>但是不写不知道，一写吓一跳，删除了打印信息的代码之后，惊奇的发现，之前得出的“EntrySet 和 KeySet 性能相近”的结论是错误的，并且我也把 JMH  测试吞吐量的代码换成了平均执行时间，因为这样看起来更直观。而测试的结果是，EntrySet 和 KeySet 的性能相差在一倍以上，详见下文。</p>
<p>本文改动了两处内容：</p>
<ul>
<li>去掉了测试代码中的打印信息，把测试类型从吞吐量测试改成了平均执行时间测试（这样看起来更直观）；</li>
<li>新增了 EntrySet 和 KeySet 性能差别的原因分析。</li>
</ul>
<blockquote>
<p>备注：以上内容为更正后的完整文章。</p>
</blockquote>
<p>随着 JDK 1.8 Streams API 的发布，使得 HashMap 拥有了更多的遍历的方式，但应该选择那种遍历方式？反而成了一个问题。</p>
<p>本文<strong>先从 HashMap 的遍历方法讲起，然后再从性能、原理以及安全性等方面，来分析 HashMap 各种遍历方式的优势与不足</strong>，本文主要内容如下图所示：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./20.png"
        data-srcset="./20.png, ./20.png 1.5x, ./20.png 2x"
        data-sizes="auto"
        alt="./20.png"
        title="20" /></p>
<h4 id="hashmap-遍历">HashMap 遍历</h4>
<p>HashMap <strong>遍历从大的方向来说，可分为以下 4 类</strong>：</p>
<ol>
<li>迭代器（Iterator）方式遍历；</li>
<li>For Each 方式遍历；</li>
<li>Lambda 表达式遍历（JDK 1.8+）;</li>
<li>Streams API 遍历（JDK 1.8+）。</li>
</ol>
<p>但每种类型下又有不同的实现方式，因此具体的遍历方式又可以分为以下 7 种：</p>
<ol>
<li>使用迭代器（Iterator）EntrySet 的方式进行遍历；</li>
<li>使用迭代器（Iterator）KeySet 的方式进行遍历；</li>
<li>使用 For Each EntrySet 的方式进行遍历；</li>
<li>使用 For Each KeySet 的方式进行遍历；</li>
<li>使用 Lambda 表达式的方式进行遍历；</li>
<li>使用 Streams API 单线程的方式进行遍历；</li>
<li>使用 Streams API 多线程的方式进行遍历。</li>
</ol>
<p>接下来我们来看每种遍历方式的具体实现代码。</p>
<h5 id="1迭代器-entryset">1.迭代器 EntrySet</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashMapTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 创建并赋值 HashMap
</span><span class="c1"></span>        <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="s">&#34;Java&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="s">&#34;JDK&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="s">&#34;Spring Framework&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">4</span><span class="o">,</span> <span class="s">&#34;MyBatis framework&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">5</span><span class="o">,</span> <span class="s">&#34;Java中文社群&#34;</span><span class="o">);</span>
        <span class="c1">// 遍历
</span><span class="c1"></span>        <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以上程序的执行结果为：</p>
<blockquote>
<p>1</p>
<p>Java</p>
<p>2</p>
<p>JDK</p>
<p>3</p>
<p>Spring Framework</p>
<p>4</p>
<p>MyBatis framework</p>
<p>5</p>
<p>Java中文社群</p>
</blockquote>
<h5 id="2迭代器-keyset">2.迭代器 KeySet</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashMapTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 创建并赋值 HashMap
</span><span class="c1"></span>        <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="s">&#34;Java&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="s">&#34;JDK&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="s">&#34;Spring Framework&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">4</span><span class="o">,</span> <span class="s">&#34;MyBatis framework&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">5</span><span class="o">,</span> <span class="s">&#34;Java中文社群&#34;</span><span class="o">);</span>
        <span class="c1">// 遍历
</span><span class="c1"></span>        <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Integer</span> <span class="n">key</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以上程序的执行结果为：</p>
<blockquote>
<p>1</p>
<p>Java</p>
<p>2</p>
<p>JDK</p>
<p>3</p>
<p>Spring Framework</p>
<p>4</p>
<p>MyBatis framework</p>
<p>5</p>
<p>Java中文社群</p>
</blockquote>
<h5 id="3foreach-entryset">3.ForEach EntrySet</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashMapTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 创建并赋值 HashMap
</span><span class="c1"></span>        <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="s">&#34;Java&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="s">&#34;JDK&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="s">&#34;Spring Framework&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">4</span><span class="o">,</span> <span class="s">&#34;MyBatis framework&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">5</span><span class="o">,</span> <span class="s">&#34;Java中文社群&#34;</span><span class="o">);</span>
        <span class="c1">// 遍历
</span><span class="c1"></span>        <span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以上程序的执行结果为：</p>
<blockquote>
<p>1</p>
<p>Java</p>
<p>2</p>
<p>JDK</p>
<p>3</p>
<p>Spring Framework</p>
<p>4</p>
<p>MyBatis framework</p>
<p>5</p>
<p>Java中文社群</p>
</blockquote>
<h5 id="4foreach-keyset">4.ForEach KeySet</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashMapTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 创建并赋值 HashMap
</span><span class="c1"></span>        <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="s">&#34;Java&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="s">&#34;JDK&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="s">&#34;Spring Framework&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">4</span><span class="o">,</span> <span class="s">&#34;MyBatis framework&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">5</span><span class="o">,</span> <span class="s">&#34;Java中文社群&#34;</span><span class="o">);</span>
        <span class="c1">// 遍历
</span><span class="c1"></span>        <span class="k">for</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">key</span> <span class="o">:</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以上程序的执行结果为：</p>
<blockquote>
<p>1</p>
<p>Java</p>
<p>2</p>
<p>JDK</p>
<p>3</p>
<p>Spring Framework</p>
<p>4</p>
<p>MyBatis framework</p>
<p>5</p>
<p>Java中文社群</p>
</blockquote>
<h5 id="5lambda">5.Lambda</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashMapTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 创建并赋值 HashMap
</span><span class="c1"></span>        <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="s">&#34;Java&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="s">&#34;JDK&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="s">&#34;Spring Framework&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">4</span><span class="o">,</span> <span class="s">&#34;MyBatis framework&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">5</span><span class="o">,</span> <span class="s">&#34;Java中文社群&#34;</span><span class="o">);</span>
        <span class="c1">// 遍历
</span><span class="c1"></span>        <span class="n">map</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以上程序的执行结果为：</p>
<blockquote>
<p>1</p>
<p>Java</p>
<p>2</p>
<p>JDK</p>
<p>3</p>
<p>Spring Framework</p>
<p>4</p>
<p>MyBatis framework</p>
<p>5</p>
<p>Java中文社群</p>
</blockquote>
<h5 id="6streams-api-单线程">6.Streams API 单线程</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashMapTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 创建并赋值 HashMap
</span><span class="c1"></span>        <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="s">&#34;Java&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="s">&#34;JDK&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="s">&#34;Spring Framework&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">4</span><span class="o">,</span> <span class="s">&#34;MyBatis framework&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">5</span><span class="o">,</span> <span class="s">&#34;Java中文社群&#34;</span><span class="o">);</span>
        <span class="c1">// 遍历
</span><span class="c1"></span>        <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">stream</span><span class="o">().</span><span class="na">forEach</span><span class="o">((</span><span class="n">entry</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以上程序的执行结果为：</p>
<blockquote>
<p>1</p>
<p>Java</p>
<p>2</p>
<p>JDK</p>
<p>3</p>
<p>Spring Framework</p>
<p>4</p>
<p>MyBatis framework</p>
<p>5</p>
<p>Java中文社群</p>
</blockquote>
<h5 id="7streams-api-多线程">7.Streams API 多线程</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashMapTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 创建并赋值 HashMap
</span><span class="c1"></span>        <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="s">&#34;Java&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="s">&#34;JDK&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="s">&#34;Spring Framework&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">4</span><span class="o">,</span> <span class="s">&#34;MyBatis framework&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">5</span><span class="o">,</span> <span class="s">&#34;Java中文社群&#34;</span><span class="o">);</span>
        <span class="c1">// 遍历
</span><span class="c1"></span>        <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">parallelStream</span><span class="o">().</span><span class="na">forEach</span><span class="o">((</span><span class="n">entry</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以上程序的执行结果为：</p>
<blockquote>
<p>4</p>
<p>MyBatis framework</p>
<p>5</p>
<p>Java中文社群</p>
<p>1</p>
<p>Java</p>
<p>2</p>
<p>JDK</p>
<p>3</p>
<p>Spring Framework</p>
</blockquote>
<h4 id="性能测试">性能测试</h4>
<p>接下来我们使用 Oracle 官方提供的性能测试工具 JMH（Java Microbenchmark Harness，JAVA 微基准测试套件）来测试一下这 7 种循环的性能。</p>
<p>首先，我们先要引入 JMH 框架，在 <code>pom.xml</code> 文件中添加如下配置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- https://mvnrepository.com/artifact/org.openjdk.jmh/jmh-core --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.openjdk.jmh<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jmh-core<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.23<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="c">&lt;!-- https://mvnrepository.com/artifact/org.openjdk.jmh/jmh-generator-annprocess --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.openjdk.jmh<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jmh-generator-annprocess<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.23<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>然后编写测试代码，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@BenchmarkMode</span><span class="o">(</span><span class="n">Mode</span><span class="o">.</span><span class="na">AverageTime</span><span class="o">)</span> <span class="c1">// 测试完成时间
</span><span class="c1"></span><span class="nd">@OutputTimeUnit</span><span class="o">(</span><span class="n">TimeUnit</span><span class="o">.</span><span class="na">NANOSECONDS</span><span class="o">)</span>
<span class="nd">@Warmup</span><span class="o">(</span><span class="n">iterations</span> <span class="o">=</span> <span class="n">2</span><span class="o">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">1</span><span class="o">,</span> <span class="n">timeUnit</span> <span class="o">=</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">)</span> <span class="c1">// 预热 2 轮，每次 1s
</span><span class="c1"></span><span class="nd">@Measurement</span><span class="o">(</span><span class="n">iterations</span> <span class="o">=</span> <span class="n">5</span><span class="o">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">1</span><span class="o">,</span> <span class="n">timeUnit</span> <span class="o">=</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">)</span> <span class="c1">// 测试 5 轮，每次 1s
</span><span class="c1"></span><span class="nd">@Fork</span><span class="o">(</span><span class="n">1</span><span class="o">)</span> <span class="c1">// fork 1 个线程
</span><span class="c1"></span><span class="nd">@State</span><span class="o">(</span><span class="n">Scope</span><span class="o">.</span><span class="na">Thread</span><span class="o">)</span> <span class="c1">// 每个测试线程一个实例
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashMapCycleTest</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">()</span> <span class="o">{{</span>
        <span class="c1">// 添加数据
</span><span class="c1"></span>        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">100</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">put</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="s">&#34;val:&#34;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}};</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">RunnerException</span> <span class="o">{</span>
        <span class="c1">// 启动基准测试
</span><span class="c1"></span>        <span class="n">Options</span> <span class="n">opt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OptionsBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="n">HashMapCycle</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">())</span> <span class="c1">// 要导入的测试类
</span><span class="c1"></span>                <span class="o">.</span><span class="na">output</span><span class="o">(</span><span class="s">&#34;/Users/admin/Desktop/jmh-map.log&#34;</span><span class="o">)</span> <span class="c1">// 输出测试结果的文件
</span><span class="c1"></span>                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="k">new</span> <span class="n">Runner</span><span class="o">(</span><span class="n">opt</span><span class="o">).</span><span class="na">run</span><span class="o">();</span> <span class="c1">// 执行测试
</span><span class="c1"></span>    <span class="o">}</span>

    <span class="nd">@Benchmark</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 遍历
</span><span class="c1"></span>        <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">Integer</span> <span class="n">k</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">v</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Benchmark</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">forEachEntrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 遍历
</span><span class="c1"></span>        <span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Integer</span> <span class="n">k</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">v</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Benchmark</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">keySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 遍历
</span><span class="c1"></span>        <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Integer</span> <span class="n">k</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">v</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">k</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Benchmark</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">forEachKeySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 遍历
</span><span class="c1"></span>        <span class="k">for</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">key</span> <span class="o">:</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Integer</span> <span class="n">k</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
            <span class="n">String</span> <span class="n">v</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">k</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Benchmark</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">lambda</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 遍历
</span><span class="c1"></span>        <span class="n">map</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">Integer</span> <span class="n">k</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
            <span class="n">String</span> <span class="n">v</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="nd">@Benchmark</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">streamApi</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 单线程遍历
</span><span class="c1"></span>        <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">stream</span><span class="o">().</span><span class="na">forEach</span><span class="o">((</span><span class="n">entry</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">Integer</span> <span class="n">k</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">v</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">parallelStreamApi</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 多线程遍历
</span><span class="c1"></span>        <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">parallelStream</span><span class="o">().</span><span class="na">forEach</span><span class="o">((</span><span class="n">entry</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">Integer</span> <span class="n">k</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">v</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>所有被添加了 <code>@Benchmark</code> 注解的方法都会被测试，因为 parallelStream 为多线程版本性能一定是最好的，所以就不参与测试了，其他 6 个方法的测试结果如下：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./21.png"
        data-srcset="./21.png, ./21.png 1.5x, ./21.png 2x"
        data-sizes="auto"
        alt="./21.png"
        title="21" /></p>
<p>其中 Units 为 ns/op 意思是执行完成时间（单位为纳秒），而 Score 列为平均执行时间， <code>±</code> 符号表示误差。从以上结果可以看出，两个 <code>entrySet</code> 的性能相近，并且执行速度最快，接下来是 <code>stream</code> ，然后是两个 <code>keySet</code>，性能最差的是 <code>KeySet</code> 。</p>
<blockquote>
<p>注：以上结果基于测试环境：JDK 1.8 / Mac mini (2018) / Idea 2020.1</p>
</blockquote>
<h5 id="结论">结论</h5>
<p><strong>从以上结果可以看出 <code>entrySet</code> 的性能比 <code>keySet</code> 的性能高出了一倍之多，因此我们应该尽量使用 <code>entrySet</code>  来实现 Map 集合的遍历</strong>。</p>
<h4 id="字节码分析">字节码分析</h4>
<p>要理解以上的测试结果，我们需要把所有遍历代码通过 <code>javac</code> 编译成字节码来看具体的原因。</p>
<p>编译后，我们使用 Idea 打开字节码，内容如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">//
</span><span class="c1">// Source code recreated from a .class file by IntelliJ IDEA
</span><span class="c1">// (powered by Fernflower decompiler)
</span><span class="c1">//
</span><span class="c1"></span>
<span class="kn">package</span> <span class="nn">com.example</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Iterator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map.Entry</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashMapTest</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">{</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">var1</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">var1</span> <span class="o">&lt;</span> <span class="n">2</span><span class="o">;</span> <span class="o">++</span><span class="n">var1</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">var1</span><span class="o">,</span> <span class="s">&#34;val:&#34;</span> <span class="o">+</span> <span class="n">var1</span><span class="o">);</span>
            <span class="o">}</span>

        <span class="o">}</span>
    <span class="o">};</span>

    <span class="kd">public</span> <span class="nf">HashMapTest</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">var0</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">entrySet</span><span class="o">();</span>
        <span class="n">keySet</span><span class="o">();</span>
        <span class="n">forEachEntrySet</span><span class="o">();</span>
        <span class="n">forEachKeySet</span><span class="o">();</span>
        <span class="n">lambda</span><span class="o">();</span>
        <span class="n">streamApi</span><span class="o">();</span>
        <span class="n">parallelStreamApi</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Iterator</span> <span class="n">var0</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>

        <span class="k">while</span><span class="o">(</span><span class="n">var0</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Entry</span> <span class="n">var1</span> <span class="o">=</span> <span class="o">(</span><span class="n">Entry</span><span class="o">)</span><span class="n">var0</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">var1</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="n">String</span><span class="o">)</span><span class="n">var1</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">keySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Iterator</span> <span class="n">var0</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>

        <span class="k">while</span><span class="o">(</span><span class="n">var0</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Integer</span> <span class="n">var1</span> <span class="o">=</span> <span class="o">(</span><span class="n">Integer</span><span class="o">)</span><span class="n">var0</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">var1</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="n">String</span><span class="o">)</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">var1</span><span class="o">));</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">forEachEntrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Iterator</span> <span class="n">var0</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>

        <span class="k">while</span><span class="o">(</span><span class="n">var0</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Entry</span> <span class="n">var1</span> <span class="o">=</span> <span class="o">(</span><span class="n">Entry</span><span class="o">)</span><span class="n">var0</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">var1</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="n">String</span><span class="o">)</span><span class="n">var1</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">forEachKeySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Iterator</span> <span class="n">var0</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>

        <span class="k">while</span><span class="o">(</span><span class="n">var0</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Integer</span> <span class="n">var1</span> <span class="o">=</span> <span class="o">(</span><span class="n">Integer</span><span class="o">)</span><span class="n">var0</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">var1</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="n">String</span><span class="o">)</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">var1</span><span class="o">));</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">lambda</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">map</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">var0</span><span class="o">,</span> <span class="n">var1</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">var0</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">var1</span><span class="o">);</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">streamApi</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">stream</span><span class="o">().</span><span class="na">forEach</span><span class="o">((</span><span class="n">var0</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">var0</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="n">String</span><span class="o">)</span><span class="n">var0</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">parallelStreamApi</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">parallelStream</span><span class="o">().</span><span class="na">forEach</span><span class="o">((</span><span class="n">var0</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">var0</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="n">String</span><span class="o">)</span><span class="n">var0</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>从结果可以看出，除了 Lambda 和 Streams API 之外，通过迭代器循环和 <code>for</code> 循环的遍历的 <code>EntrySet</code> 最终生成的代码是一样的，他们都是在循环中创建了一个遍历对象 <code>Entry</code> ，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Iterator</span> <span class="n">var0</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
    <span class="k">while</span><span class="o">(</span><span class="n">var0</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">Entry</span> <span class="n">var1</span> <span class="o">=</span> <span class="o">(</span><span class="n">Entry</span><span class="o">)</span><span class="n">var0</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">var1</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="n">String</span><span class="o">)</span><span class="n">var1</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">forEachEntrySet</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Iterator</span> <span class="n">var0</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
    <span class="k">while</span><span class="o">(</span><span class="n">var0</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">Entry</span> <span class="n">var1</span> <span class="o">=</span> <span class="o">(</span><span class="n">Entry</span><span class="o">)</span><span class="n">var0</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">var1</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="n">String</span><span class="o">)</span><span class="n">var1</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>而 <code>KeySet</code> 的代码也是类似的，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">keySet</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Iterator</span> <span class="n">var0</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
    <span class="k">while</span><span class="o">(</span><span class="n">var0</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">Integer</span> <span class="n">var1</span> <span class="o">=</span> <span class="o">(</span><span class="n">Integer</span><span class="o">)</span><span class="n">var0</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">var1</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="n">String</span><span class="o">)</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">var1</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span> 
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">forEachKeySet</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Iterator</span> <span class="n">var0</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
    <span class="k">while</span><span class="o">(</span><span class="n">var0</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">Integer</span> <span class="n">var1</span> <span class="o">=</span> <span class="o">(</span><span class="n">Integer</span><span class="o">)</span><span class="n">var0</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">var1</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="n">String</span><span class="o">)</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">var1</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>所以我们在使用迭代器或是 <code>for</code> 循环 <code>EntrySet</code> 时，他们的性能都是相同的，因为他们最终生成的字节码基本都是一样的；同理 <code>KeySet</code> 的两种遍历方式也是类似的。</p>
<h4 id="性能分析">性能分析</h4>
<p><code>EntrySet</code> 之所以比 <code>KeySet</code> 的性能高是因为，<code>KeySet</code> 在循环时使用了 <code>map.get(key)</code>，而 <code>map.get(key)</code> 相当于又遍历了一遍 Map 集合去查询 <code>key</code> 所对应的值。为什么要用“又”这个词？那是因为<strong>在使用迭代器或者 for 循环时，其实已经遍历了一遍 Map 集合了，因此再使用 <code>map.get(key)</code> 查询时，相当于遍历了两遍</strong>。</p>
<p>而 <code>EntrySet</code> 只遍历了一遍 Map 集合，之后通过代码“Entry&lt;Integer, String&gt; entry = iterator.next()”把对象的 <code>key</code> 和 <code>value</code> 值都放入到了 <code>Entry</code> 对象中，因此再获取 <code>key</code> 和 <code>value</code> 值时就无需再遍历 Map 集合，只需要从 <code>Entry</code> 对象中取值就可以了。</p>
<p>所以，<strong><code>EntrySet</code> 的性能比 <code>KeySet</code> 的性能高出了一倍，因为 <code>KeySet</code> 相当于循环了两遍 Map 集合，而 <code>EntrySet</code> 只循环了一遍</strong>。</p>
<h4 id="安全性测试">安全性测试</h4>
<p>从上面的性能测试结果和原理分析，我想大家应该选用那种遍历方式，已经心中有数的，而接下来我们就从「安全」的角度入手，来分析那种遍历方式更安全。</p>
<p>我们把以上遍历划分为四类进行测试：迭代器方式、For 循环方式、Lambda 方式和 Stream 方式，测试代码如下。</p>
<h5 id="1迭代器方式">1.迭代器方式</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
<span class="k">while</span> <span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">==</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 删除
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;del:&#34;</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
        <span class="n">iterator</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;show:&#34;</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以上程序的执行结果：</p>
<blockquote>
<p>show:0</p>
<p>del:1</p>
<p>show:2</p>
</blockquote>
<p>测试结果：<strong>迭代器中循环删除数据安全</strong>。</p>
<h5 id="2for-循环方式">2.For 循环方式</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">==</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 删除
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;del:&#34;</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
        <span class="n">map</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;show:&#34;</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以上程序的执行结果：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./22.png"
        data-srcset="./22.png, ./22.png 1.5x, ./22.png 2x"
        data-sizes="auto"
        alt="./22.png"
        title="22" />image.png</p>
<p>测试结果：<strong>For 循环中删除数据非安全</strong>。</p>
<h5 id="3lambda-方式">3.Lambda 方式</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">map</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;del:&#34;</span> <span class="o">+</span> <span class="n">key</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;show:&#34;</span> <span class="o">+</span> <span class="n">key</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre></td></tr></table>
</div>
</div><p>以上程序的执行结果：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./23.png"
        data-srcset="./23.png, ./23.png 1.5x, ./23.png 2x"
        data-sizes="auto"
        alt="./23.png"
        title="23" />测试结果：<strong>Lambda 循环中删除数据非安全</strong>。</p>
<p><strong>Lambda 删除的正确方式</strong>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 根据 map 中的 key 去判断删除
</span><span class="c1"></span><span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">removeIf</span><span class="o">(</span><span class="n">key</span> <span class="o">-&gt;</span> <span class="n">key</span> <span class="o">==</span> <span class="n">1</span><span class="o">);</span>
<span class="n">map</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;show:&#34;</span> <span class="o">+</span> <span class="n">key</span><span class="o">);</span>
<span class="o">});</span>
</code></pre></td></tr></table>
</div>
</div><p>以上程序的执行结果：</p>
<blockquote>
<p>show:0</p>
<p>show:2</p>
</blockquote>
<p>从上面的代码可以看出，可以先使用 <code>Lambda</code> 的 <code>removeIf</code> 删除多余的数据，再进行循环是一种正确操作集合的方式。</p>
<h5 id="4stream-方式">4.Stream 方式</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">stream</span><span class="o">().</span><span class="na">forEach</span><span class="o">((</span><span class="n">entry</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">==</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;del:&#34;</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
        <span class="n">map</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;show:&#34;</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre></td></tr></table>
</div>
</div><p>以上程序的执行结果：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./24.png"
        data-srcset="./24.png, ./24.png 1.5x, ./24.png 2x"
        data-sizes="auto"
        alt="./24.png"
        title="24" /></p>
<p>测试结果：<strong>Stream 循环中删除数据非安全</strong>。</p>
<p><strong>Stream 循环的正确方式</strong>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">stream</span><span class="o">().</span><span class="na">filter</span><span class="o">(</span><span class="n">m</span> <span class="o">-&gt;</span> <span class="n">1</span> <span class="o">!=</span> <span class="n">m</span><span class="o">.</span><span class="na">getKey</span><span class="o">()).</span><span class="na">forEach</span><span class="o">((</span><span class="n">entry</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">==</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;del:&#34;</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;show:&#34;</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre></td></tr></table>
</div>
</div><p>以上程序的执行结果：</p>
<blockquote>
<p>show:0</p>
<p>show:2</p>
</blockquote>
<p>从上面的代码可以看出，可以使用 <code>Stream</code> 中的 <code>filter</code> 过滤掉无用的数据，再进行遍历也是一种安全的操作集合的方式。</p>
<h5 id="小结-1">小结</h5>
<p>我们不能在遍历中使用集合 <code>map.remove()</code> 来删除数据，这是非安全的操作方式，但我们可以使用迭代器的 <code>iterator.remove()</code> 的方法来删除数据，这是安全的删除集合的方式。同样的我们也可以使用 Lambda 中的 <code>removeIf</code> 来提前删除数据，或者是使用 Stream 中的 <code>filter</code> 过滤掉要删除的数据进行循环，这样都是安全的，当然我们也可以在 <code>for</code> 循环前删除数据在遍历也是线程安全的。</p>
<h4 id="总结-1">总结</h4>
<p>本文我们讲了 HashMap 4 种遍历方式：迭代器、for、lambda、stream，以及具体的 7 种遍历方法，综合性能和安全性来看，<strong>我们应该尽量使用迭代器（Iterator）来遍历 <code>EntrySet</code> 的遍历方式来操作 Map 集合</strong>，这样就会既安全又高效了。</p>
<h3 id="java-hashmap的死循环">Java HashMap的死循环</h3>
<p>在淘宝内网里看到同事发了贴说了一个CPU被100%的线上故障，并且这个事发生了很多次，原因是在Java语言在并发情况下使用HashMap造成Race  Condition，从而导致死循环。这个事情我4、5年前也经历过，本来觉得没什么好写的，因为Java的HashMap是非线程安全的，所以在并发下必然出现问题。但是，我发现近几年，很多人都经历过这个事（在网上查“HashMap Infinite  Loop”可以看到很多人都在说这个事）所以，觉得这个是个普遍问题，需要写篇疫苗文章说一下这个事，并且给大家看看一个完美的“Race  Condition”是怎么形成的。</p>
<h4 id="问题的症状">问题的症状</h4>
<p>从前我们的Java代码因为一些原因使用了HashMap这个东西，但是当时的程序是单线程的，一切都没有问题。后来，我们的程序性能有问题，所以需要变成多线程的，于是，变成多线程后到了线上，发现程序经常占了100%的CPU，查看堆栈，你会发现程序都Hang在了HashMap.get()这个方法上了，重启程序后问题消失。但是过段时间又会来。而且，这个问题在测试环境里可能很难重现。</p>
<p>我们简单的看一下我们自己的代码，我们就知道HashMap被多个线程操作。而Java的文档说HashMap是非线程安全的，应该用ConcurrentHashMap。</p>
<p>但是在这里我们可以来研究一下原因。</p>
<h4 id="hash表数据结构">Hash表数据结构</h4>
<p>我需要简单地说一下HashMap这个经典的数据结构。</p>
<p>HashMap通常会用一个指针数组（假设为table[]）来做分散所有的key，当一个key被加入时，会通过Hash算法通过key算出这个数组的下标i，然后就把这个&lt;key,  value&gt;插到table[i]中，如果有两个不同的key被算在了同一个i，那么就叫冲突，又叫碰撞，这样会在table[i]上形成一个链表。</p>
<p>我们知道，如果table[]的尺寸很小，比如只有2个，如果要放进10个keys的话，那么碰撞非常频繁，于是一个O(1)的查找算法，就变成了链表遍历，性能变成了O(n)，这是Hash表的缺陷（可参看《<a href="https://coolshell.cn/articles/6424.html" target="_blank" rel="noopener noreferrer">Hash Collision DoS 问题</a>》）。</p>
<p>所以，Hash表的尺寸和容量非常的重要。一般来说，Hash表这个容器当有数据要插入时，都会检查容量有没有超过设定的thredhold，如果超过，需要增大Hash表的尺寸，但是这样一来，整个Hash表里的无素都需要被重算一遍。这叫rehash，这个成本相当的大。</p>
<p>相信大家对这个基础知识已经很熟悉了。</p>
<h4 id="hashmap的rehash源代码">HashMap的rehash源代码</h4>
<p>下面，我们来看一下Java的HashMap的源代码。</p>
<p>Put一个Key,Value对到Hash表中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span>
<span class="o">{</span>
    <span class="o">......</span>
    <span class="c1">//算Hash值
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">hash</span> <span class="o">=</span> <span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">indexFor</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">table</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
    <span class="c1">//如果该key已被插入，则替换掉旧的value （链接操作）
</span><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">table</span><span class="o">[</span><span class="n">i</span><span class="o">];</span> <span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Object</span> <span class="n">k</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span> <span class="o">==</span> <span class="n">hash</span> <span class="o">&amp;&amp;</span> <span class="o">((</span><span class="n">k</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">key</span><span class="o">)</span> <span class="o">==</span> <span class="n">key</span> <span class="o">||</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">k</span><span class="o">)))</span> <span class="o">{</span>
            <span class="n">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
            <span class="n">e</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
            <span class="n">e</span><span class="o">.</span><span class="na">recordAccess</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">modCount</span><span class="o">++;</span>
    <span class="c1">//该key不存在，需要增加一个结点
</span><span class="c1"></span>    <span class="n">addEntry</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>检查容量是否超标</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">void</span> <span class="nf">addEntry</span><span class="o">(</span><span class="kt">int</span> <span class="n">hash</span><span class="o">,</span> <span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">,</span> <span class="kt">int</span> <span class="n">bucketIndex</span><span class="o">)</span>
<span class="o">{</span>
    <span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">table</span><span class="o">[</span><span class="n">bucketIndex</span><span class="o">];</span>
    <span class="n">table</span><span class="o">[</span><span class="n">bucketIndex</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;(</span><span class="n">hash</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="c1">//查看当前的size是否超过了我们设定的阈值threshold，如果超过，需要resize
</span><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">size</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="o">)</span>
        <span class="n">resize</span><span class="o">(</span><span class="n">2</span> <span class="o">*</span> <span class="n">table</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
<span class="o">}</span> 
</code></pre></td></tr></table>
</div>
</div><p>新建一个更大尺寸的hash表，然后把数据从老的Hash表中迁移到新的Hash表中。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">void</span> <span class="nf">resize</span><span class="o">(</span><span class="kt">int</span> <span class="n">newCapacity</span><span class="o">)</span>
<span class="o">{</span>
    <span class="n">Entry</span><span class="o">[]</span> <span class="n">oldTable</span> <span class="o">=</span> <span class="n">table</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">oldCapacity</span> <span class="o">=</span> <span class="n">oldTable</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
    <span class="o">......</span>
    <span class="c1">//创建一个新的Hash Table
</span><span class="c1"></span>    <span class="n">Entry</span><span class="o">[]</span> <span class="n">newTable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entry</span><span class="o">[</span><span class="n">newCapacity</span><span class="o">];</span>
    <span class="c1">//将Old Hash Table上的数据迁移到New Hash Table上
</span><span class="c1"></span>    <span class="n">transfer</span><span class="o">(</span><span class="n">newTable</span><span class="o">);</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">newTable</span><span class="o">;</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)(</span><span class="n">newCapacity</span> <span class="o">*</span> <span class="n">loadFactor</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>迁移的源代码，注意高亮处：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">void</span> <span class="nf">transfer</span><span class="o">(</span><span class="n">Entry</span><span class="o">[]</span> <span class="n">newTable</span><span class="o">)</span>
<span class="o">{</span>
    <span class="n">Entry</span><span class="o">[]</span> <span class="n">src</span> <span class="o">=</span> <span class="n">table</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">newCapacity</span> <span class="o">=</span> <span class="n">newTable</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
    <span class="c1">//下面这段代码的意思是：
</span><span class="c1"></span>    <span class="c1">//  从OldTable里摘一个元素出来，然后放到NewTable中
</span><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">src</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">src</span><span class="o">[</span><span class="n">j</span><span class="o">];</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">src</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">do</span> <span class="o">{</span>
                <span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">next</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">indexFor</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span><span class="o">,</span> <span class="n">newCapacity</span><span class="o">);</span>
                <span class="n">e</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">newTable</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                <span class="n">newTable</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">next</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span> 
</code></pre></td></tr></table>
</div>
</div><p>好了，这个代码算是比较正常的。而且没有什么问题。</p>
<h4 id="正常的rehash的过程">正常的ReHash的过程</h4>
<p>画了个图做了个演示。</p>
<ul>
<li>
<p>我假设了我们的hash算法就是简单的用key mod 一下表的大小（也就是数组的长度）。</p>
</li>
<li>
<p>最上面的是old hash 表，其中的Hash表的size=2, 所以key = 3, 7, 5，在mod 2以后都冲突在table[1]这里了。</p>
</li>
<li>
<p>接下来的三个步骤是Hash表 resize成4，然后所有的&lt;key,value&gt; 重新rehash的过程</p>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./26.jpg"
        data-srcset="./26.jpg, ./26.jpg 1.5x, ./26.jpg 2x"
        data-sizes="auto"
        alt="./26.jpg"
        title="26" /></p>
<h4 id="并发下的rehash">并发下的Rehash</h4>
<p>**1）假设我们有两个线程。**我用红色和浅蓝色标注了一下。</p>
<p>我们再回头看一下我们的 transfer代码中的这个细节：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">do</span> <span class="o">{</span>
    <span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">next</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">;</span> <span class="c1">// &lt;--假设线程一执行到这里就被调度挂起了
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">indexFor</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span><span class="o">,</span> <span class="n">newCapacity</span><span class="o">);</span>
    <span class="n">e</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">newTable</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
    <span class="n">newTable</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">next</span><span class="o">;</span>
<span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>而我们的线程二执行完成了。于是我们有下面的这个样子。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./27.jpg"
        data-srcset="./27.jpg, ./27.jpg 1.5x, ./27.jpg 2x"
        data-sizes="auto"
        alt="./27.jpg"
        title="27" /></p>
<p>注意，<strong>因为Thread1的 e 指向了key(3)，而next指向了key(7)，其在线程二rehash后，指向了线程二重组后的链表</strong>。我们可以看到链表的顺序被反转后。</p>
<p><strong>2）线程一被调度回来执行。</strong></p>
<ul>
<li><strong>先是执行 newTalbe[i] = e;</strong></li>
<li><strong>然后是e = next，导致了e指向了key(7)，</strong></li>
<li><strong>而下一次循环的next = e.next导致了next指向了key(3)</strong></li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./28.jpg"
        data-srcset="./28.jpg, ./28.jpg 1.5x, ./28.jpg 2x"
        data-sizes="auto"
        alt="./28.jpg"
        title="28" /></p>
<p><strong>3）一切安好。</strong></p>
<p>线程一接着工作。<strong>把key(7)摘下来，放到newTable[i]的第一个，然后把e和next往下移</strong>。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./29.jpg"
        data-srcset="./29.jpg, ./29.jpg 1.5x, ./29.jpg 2x"
        data-sizes="auto"
        alt="./29.jpg"
        title="29" /></p>
<p><strong>4）环形链接出现。</strong></p>
<p><strong>e.next = newTable[i] 导致 key(3).next 指向了 key(7)</strong></p>
<p><strong>注意：此时的key(7).next 已经指向了key(3)， 环形链表就这样出现了。</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./30.jpg"
        data-srcset="./30.jpg, ./30.jpg 1.5x, ./30.jpg 2x"
        data-sizes="auto"
        alt="./30.jpg"
        title="30" /></p>
<p><strong>于是，当我们的线程一调用到，HashTable.get(11)时，悲剧就出现了——Infinite Loop。</strong></p>
<p><strong>设计思想</strong></p>
<p>局部性原理，当时设计HashMap的大叔采用头插法而没有采用尾插法有一点考虑是性能优化，认为最近put进去的元素，被get的概率相对较其他元素大，采用头插法能够更快得获取到最近插入的元素。</p>
<p>但头插法的设计有一个特点，就是扩容之后，链表上的元素顺序会反过来，这也是死循环的一个重要原因。</p>
<h4 id="问题答疑">问题答疑</h4>
<blockquote>
<p>1、有同学认为线程B对链表的操作，线程A怎么会看到呢？不是有线程可见性问题吗？</p>
</blockquote>
<p>首先得理解线程可见性的原因是因为有cpu缓存，在线程执行之前，读取了操作数，在操作过程中操作数都在CPU缓存中，在线程没有将操作数写入主存之前，线程中对操作数的修改则对于其他线程是不可见的。</p>
<p>而在hashMap扩容的过程中，线程操作的是堆中的对象，线程持有的是对对象的引用。引用就是一个地址，对引用的修改就是对堆中对象的修改。线程B的操作对于线程A的操作是透明的，所以线程A能看到线程B对链表的修改。</p>
<h4 id="其它">其它</h4>
<p>有人把这个问题报给了Sun，不过Sun不认为这个是一个问题。因为HashMap本来就不支持并发。要并发就用ConcurrentHashmap</p>
<p><a href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6423457" target="_blank" rel="noopener noreferrer">http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6423457</a></p>
<p>我在这里把这个事情记录下来，只是为了让大家了解并体会一下并发环境下的危险。</p>
<h4 id="修复">修复</h4>
<p>Java1.8版本将头插法修复为尾插法，解决了问题，但HashMap本身是线程不安全的(不管哪个jdk版本)，所以请不要在并发访问的场景下直接使用HashMap。如果在并发访问的场景下，建议采用concurrentHashMap。</p>
<h3 id="java-集合---tablesizefor">Java 集合 &ndash;tableSizeFor</h3>
<p>在看 HashMap 源码的时候有这么一段代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">MAXIMUM_CAPACITY</span> <span class="o">=</span> <span class="n">1</span> <span class="o">&lt;&lt;</span> <span class="n">30</span><span class="o">;</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">tableSizeFor</span><span class="o">(</span><span class="kt">int</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">c</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span>
    <span class="n">n</span> <span class="o">|=</span> <span class="n">n</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">1</span><span class="o">;</span>
    <span class="n">n</span> <span class="o">|=</span> <span class="n">n</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">2</span><span class="o">;</span>
    <span class="n">n</span> <span class="o">|=</span> <span class="n">n</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">4</span><span class="o">;</span>
    <span class="n">n</span> <span class="o">|=</span> <span class="n">n</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">8</span><span class="o">;</span>
    <span class="n">n</span> <span class="o">|=</span> <span class="n">n</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">16</span><span class="o">;</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">?</span> <span class="n">1</span> <span class="o">:</span> <span class="o">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="n">MAXIMUM_CAPACITY</span><span class="o">)</span> <span class="o">?</span> <span class="n">MAXIMUM_CAPACITY</span> <span class="o">:</span> <span class="n">n</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>第一眼看上去完全看不懂，这几个右移按位或是什么意思</p>
<p>运行一个例子看看</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">MAXIMUM_CAPACITY</span> <span class="o">=</span> <span class="n">1</span> <span class="o">&lt;&lt;</span> <span class="n">30</span><span class="o">;</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">tableSizeFor</span><span class="o">(</span><span class="kt">int</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">c</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span>
    <span class="n">n</span> <span class="o">|=</span> <span class="n">n</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">1</span><span class="o">;</span>
    <span class="n">n</span> <span class="o">|=</span> <span class="n">n</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">2</span><span class="o">;</span>
    <span class="n">n</span> <span class="o">|=</span> <span class="n">n</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">4</span><span class="o">;</span>
    <span class="n">n</span> <span class="o">|=</span> <span class="n">n</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">8</span><span class="o">;</span>
    <span class="n">n</span> <span class="o">|=</span> <span class="n">n</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">16</span><span class="o">;</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">?</span> <span class="n">1</span> <span class="o">:</span> <span class="o">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="n">MAXIMUM_CAPACITY</span><span class="o">)</span> <span class="o">?</span> <span class="n">MAXIMUM_CAPACITY</span> <span class="o">:</span> <span class="n">n</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">tableSizeFor</span><span class="o">(</span><span class="n">6</span><span class="o">));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">tableSizeFor</span><span class="o">(</span><span class="n">7</span><span class="o">));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">tableSizeFor</span><span class="o">(</span><span class="n">10</span><span class="o">));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">tableSizeFor</span><span class="o">(</span><span class="n">15</span><span class="o">));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">tableSizeFor</span><span class="o">(</span><span class="n">18</span><span class="o">));</span>
<span class="o">}</span>

<span class="c1">// 输出
</span><span class="c1"></span><span class="n">8</span>
<span class="n">8</span>
<span class="n">16</span>
<span class="n">16</span>
<span class="n">32</span>
</code></pre></td></tr></table>
</div>
</div><p>输入 6，7 都是输出 8</p>
<p>输入 10， 15 输出 16</p>
<p>输入 18 输出 32</p>
<p>输出的都是 2 的指数幂，其实这个方法是用于找到大于等于输入参数的的最小的 2 的指数幂。为什么需要这样的方法，因为 hashmap 的容量大小都是 2 的指数幂。</p>
<p>以输入 22 为例子， n = c - 1, n 为 21</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./25.webp"
        data-srcset="./25.webp, ./25.webp 1.5x, ./25.webp 2x"
        data-sizes="auto"
        alt="./25.webp"
        title="25" /></p>
<p>每一次右移之后与上一次的结果做按位或操作（只要有一个位是 1，结果就是 1），通过几次操作之后将原本二进制最高位为 1 的后面几位全部至 1，最后再加 1，得到一个 2 的指数幂。</p>
<p>至于为什么一开始要执行 n = c - 1; 这是为了防止 c 已经是 2 的幂，如果 c 已经是 2 的幂， 又没有执行这个减 1 操作，则执行完后面的几条无符号右移操作之后，返回的结果将是这个 c 的 2 倍。</p>
<h2 id="java-collectors常用的20个方法">Java-Collectors常用的20个方法</h2>
<div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>返回List集合: toList()</font>
</div>
<p>用于将元素累积到<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>List</font>集合中。它将创建一个新<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>List</font>集合（不会更改当前集合）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">integers</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">1</span><span class="o">,</span><span class="n">2</span><span class="o">,</span><span class="n">3</span><span class="o">,</span><span class="n">4</span><span class="o">,</span><span class="n">5</span><span class="o">,</span><span class="n">6</span><span class="o">,</span><span class="n">6</span><span class="o">);</span>
<span class="n">integers</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
<span class="c1">// output: [1,4,9,16,25,36,36]
</span></code></pre></td></tr></table>
</div>
</div><div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>返回Set集合: toSet()</font>
</div>
<p>用于将元素累积到<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Set</font>集合中。它会删除重复元素。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">integers</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">1</span><span class="o">,</span><span class="n">2</span><span class="o">,</span><span class="n">3</span><span class="o">,</span><span class="n">4</span><span class="o">,</span><span class="n">5</span><span class="o">,</span><span class="n">6</span><span class="o">,</span><span class="n">6</span><span class="o">);</span>
<span class="n">integers</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toSet</span><span class="o">());</span>
<span class="c1">// output: [1,4,9,16,25,36]
</span></code></pre></td></tr></table>
</div>
</div><div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>返回指定的集合: toCollection()</font>
</div>
<p>可以将元素雷击到指定的集合中。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">integers</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">1</span><span class="o">,</span><span class="n">2</span><span class="o">,</span><span class="n">3</span><span class="o">,</span><span class="n">4</span><span class="o">,</span><span class="n">5</span><span class="o">,</span><span class="n">6</span><span class="o">,</span><span class="n">6</span><span class="o">);</span>
<span class="n">integers</span>
    <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
    <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">&gt;</span><span class="n">2</span><span class="o">)</span>
    <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toCollection</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">::</span><span class="k">new</span><span class="o">));</span>
<span class="c1">// output: [3,4,5,6,6]
</span></code></pre></td></tr></table>
</div>
</div><div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>计算元素数量: Counting()</font>
</div>
<p>用于返回计算集合中存在的元素个数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">integers</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">1</span><span class="o">,</span><span class="n">2</span><span class="o">,</span><span class="n">3</span><span class="o">,</span><span class="n">4</span><span class="o">,</span><span class="n">5</span><span class="o">,</span><span class="n">6</span><span class="o">,</span><span class="n">6</span><span class="o">);</span>
<span class="n">Long</span> <span class="n">collect</span> <span class="o">=</span> <span class="n">integers</span>
                   <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                   <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">&lt;</span><span class="n">4</span><span class="o">)</span>
                   <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">counting</span><span class="o">());</span>
<span class="c1">// output: 3
</span></code></pre></td></tr></table>
</div>
</div><div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>求最小值: minBy()</font>
</div>
<p>用于返回列表中存在的最小值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">integers</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">1</span><span class="o">,</span><span class="n">2</span><span class="o">,</span><span class="n">3</span><span class="o">,</span><span class="n">4</span><span class="o">,</span><span class="n">5</span><span class="o">,</span><span class="n">6</span><span class="o">,</span><span class="n">6</span><span class="o">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;alpha&#34;</span><span class="o">,</span><span class="s">&#34;beta&#34;</span><span class="o">,</span><span class="s">&#34;gamma&#34;</span><span class="o">);</span>
<span class="n">integers</span>
    <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
    <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">minBy</span><span class="o">(</span><span class="n">Comparator</span><span class="o">.</span><span class="na">naturalOrder</span><span class="o">()))</span>
    <span class="o">.</span><span class="na">get</span><span class="o">();</span>
<span class="c1">// output: 1
</span><span class="c1"></span><span class="n">strings</span>
   <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
   <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">minBy</span><span class="o">(</span><span class="n">Comparator</span><span class="o">.</span><span class="na">naturalOrder</span><span class="o">()))</span>
   <span class="o">.</span><span class="na">get</span><span class="o">();</span>
<span class="c1">// output: alpha
</span></code></pre></td></tr></table>
</div>
</div><p>按照整数排序返回1，按照字符串排序返回alpha</p>
<p>可以使用reverseOrder（）方法反转顺序。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">integers</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">1</span><span class="o">,</span><span class="n">2</span><span class="o">,</span><span class="n">3</span><span class="o">,</span><span class="n">4</span><span class="o">,</span><span class="n">5</span><span class="o">,</span><span class="n">6</span><span class="o">,</span><span class="n">6</span><span class="o">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;alpha&#34;</span><span class="o">,</span><span class="s">&#34;beta&#34;</span><span class="o">,</span><span class="s">&#34;gamma&#34;</span><span class="o">);</span>
<span class="n">integers</span>
    <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
    <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">minBy</span><span class="o">(</span><span class="n">Comparator</span><span class="o">.</span><span class="na">reverseOrder</span><span class="o">()))</span>
    <span class="o">.</span><span class="na">get</span><span class="o">();</span>
<span class="c1">// output: 6
</span><span class="c1"></span><span class="n">strings</span>
   <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
   <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">minBy</span><span class="o">(</span><span class="n">Comparator</span><span class="o">.</span><span class="na">reverseOrder</span><span class="o">()))</span>
   <span class="o">.</span><span class="na">get</span><span class="o">();</span>
<span class="c1">// output: gamma
</span></code></pre></td></tr></table>
</div>
</div><p>同时可以自定义的对象定制比较器。</p>
<div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>求最大值: maxBy()</font>
</div>
<p>和最小值方法类似，使用<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>maxBy（）</font>方法来获得最大值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;alpha&#34;</span><span class="o">,</span><span class="s">&#34;beta&#34;</span><span class="o">,</span><span class="s">&#34;gamma&#34;</span><span class="o">);</span>
<span class="n">strings</span>
   <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
   <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">maxBy</span><span class="o">(</span><span class="n">Comparator</span><span class="o">.</span><span class="na">naturalOrder</span><span class="o">()))</span>
   <span class="o">.</span><span class="na">get</span><span class="o">();</span>
<span class="c1">// output: gamma
</span></code></pre></td></tr></table>
</div>
</div><div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>分区列表:partitioningBy()</font>
</div>
<p>用于将一个集合划分为2个集合并将其添加到映射中，1个满足给定条件，另一个不满足，例如从集合中分离奇数。因此它将在<code>map</code>中生成2条数据，1个以<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>true</font>为<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>key</font>，奇数为值，第2个以<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>false</font>为<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>key</font>，以偶数为值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;a&#34;</span><span class="o">,</span><span class="s">&#34;alpha&#34;</span><span class="o">,</span><span class="s">&#34;beta&#34;</span><span class="o">,</span><span class="s">&#34;gamma&#34;</span><span class="o">);</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">collect1</span> <span class="o">=</span> <span class="n">strings</span>
          <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
          <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">partitioningBy</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">2</span><span class="o">));</span>
<span class="c1">// output: {false=[a], true=[alpha, beta, gamma]}
</span></code></pre></td></tr></table>
</div>
</div><p>这里我们将长度大于2的字符串与其余字符串分开。</p>
<div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>返回不可修改的List集合：toUnmodifiableList（）</font>
</div>
<p>用于创建只读<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>List</font>集合。任何试图对此不可修改<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>List</font>集合进行更改的尝试都将导致<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>UnsupportedOperationException</font>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;alpha&#34;</span><span class="o">,</span><span class="s">&#34;beta&#34;</span><span class="o">,</span><span class="s">&#34;gamma&#34;</span><span class="o">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">collect2</span> <span class="o">=</span> <span class="n">strings</span>
       <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
       <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toUnmodifiableList</span><span class="o">());</span>
<span class="c1">// output: [&#34;alpha&#34;,&#34;beta&#34;,&#34;gamma&#34;]
</span></code></pre></td></tr></table>
</div>
</div><div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>返回不可修改的Set集合：toUnmodifiableSet()</font>
</div>
<p>用于创建只读<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Set</font>集合。任何试图对此不可修改<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Set</font>集合进行更改的尝试都将导致<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>UnsupportedOperationException</font>。它会删除重复元素。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;alpha&#34;</span><span class="o">,</span><span class="s">&#34;beta&#34;</span><span class="o">,</span><span class="s">&#34;gamma&#34;</span><span class="o">,</span><span class="s">&#34;alpha&#34;</span><span class="o">);</span>
<span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">readOnlySet</span> <span class="o">=</span> <span class="n">strings</span>
       <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
       <span class="o">.</span><span class="na">sorted</span><span class="o">()</span>
       <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toUnmodifiableSet</span><span class="o">());</span>
<span class="c1">// output: [&#34;alpha&#34;,&#34;beta&#34;,&#34;gamma&#34;]
</span></code></pre></td></tr></table>
</div>
</div><div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>连接元素：Joining（）</font>
</div>
<p>用指定的字符串链接集合内的元素。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;alpha&#34;</span><span class="o">,</span><span class="s">&#34;beta&#34;</span><span class="o">,</span><span class="s">&#34;gamma&#34;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">collect3</span> <span class="o">=</span> <span class="n">strings</span>
     <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
     <span class="o">.</span><span class="na">distinct</span><span class="o">()</span>
     <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">joining</span><span class="o">(</span><span class="s">&#34;,&#34;</span><span class="o">));</span>
<span class="c1">// output: alpha,beta,gamma
</span><span class="c1"></span><span class="n">String</span> <span class="n">collect4</span> <span class="o">=</span> <span class="n">strings</span>
     <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
     <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">s</span> <span class="o">-&gt;</span> <span class="n">s</span><span class="o">.</span><span class="na">toString</span><span class="o">())</span>
     <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">joining</span><span class="o">(</span><span class="s">&#34;,&#34;</span><span class="o">,</span><span class="s">&#34;[&#34;</span><span class="o">,</span><span class="s">&#34;]&#34;</span><span class="o">));</span>
<span class="c1">// output: [alpha,beta,gamma]
</span></code></pre></td></tr></table>
</div>
</div><div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>Long类型集合的平均值：averagingLong()</font>
</div>
<p>查找<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Long</font>类型集合的平均值。</p>
<p>注意：返回的是<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Double</font>类型而不是 <font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Long</font>类型</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">longValues</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">100l</span><span class="o">,</span><span class="n">200l</span><span class="o">,</span><span class="n">300l</span><span class="o">);</span>
<span class="n">Double</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">longValues</span>
    <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
    <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">averagingLong</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">2</span><span class="o">));</span>
<span class="c1">// output: 400.0
</span></code></pre></td></tr></table>
</div>
</div><div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>Integer类型集合的平均值：averagingInt()</font>
</div>
<p>查找<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Integer</font>类型集合的平均值。</p>
<p>注意：返回的是<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Double</font>类型而不是<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>int</font> 类型</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">longValues</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">100l</span><span class="o">,</span><span class="n">200l</span><span class="o">,</span><span class="n">300l</span><span class="o">);</span>
<span class="n">Double</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">longValues</span>
    <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
    <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">averagingLong</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">2</span><span class="o">));</span>
<span class="c1">// output: 400.0
</span></code></pre></td></tr></table>
</div>
</div><div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>Double类型集合的平均值：averagingDouble()</font>
</div>
<p>查找<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Double</font>类型集合的平均值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="n">doubles</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">1</span><span class="o">.</span><span class="na">1</span><span class="o">,</span><span class="n">2</span><span class="o">.</span><span class="na">0</span><span class="o">,</span><span class="n">3</span><span class="o">.</span><span class="na">0</span><span class="o">,</span><span class="n">4</span><span class="o">.</span><span class="na">0</span><span class="o">,</span><span class="n">5</span><span class="o">.</span><span class="na">0</span><span class="o">,</span><span class="n">5</span><span class="o">.</span><span class="na">0</span><span class="o">);</span>
<span class="n">Double</span> <span class="n">d3</span> <span class="o">=</span> <span class="n">doubles</span>
    <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
    <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">averagingDouble</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">));</span>
<span class="c1">// output: 3.35
</span></code></pre></td></tr></table>
</div>
</div><div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>创建Map：toMap（）</font>
</div>
<p>根据集合的值创建<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Map</font>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;alpha&#34;</span><span class="o">,</span><span class="s">&#34;beta&#34;</span><span class="o">,</span><span class="s">&#34;gamma&#34;</span><span class="o">);</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="n">strings</span>
       <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
       <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span>
          <span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">Function</span><span class="o">.</span><span class="na">identity</span><span class="o">(),</span><span class="n">String</span><span class="o">::</span><span class="n">length</span><span class="o">));</span>
<span class="c1">// output: {alpha=5, beta=4, gamma=5}
</span></code></pre></td></tr></table>
</div>
</div><div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>在创建Map时处理列表的重复项</font>
</div>
<p>集合中可以包含重复的值，因此，如果想从列表中创建一个<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Map</font>，并希望使用集合值作为<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Map</font>的<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>key</font>，那么需要解析重复的<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>key</font>。由于<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Map</font>只包含唯一的<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>key</font>，可以使用比较器来实现这一点。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;alpha&#34;</span><span class="o">,</span><span class="s">&#34;beta&#34;</span><span class="o">,</span><span class="s">&#34;gamma&#34;</span><span class="o">,</span><span class="s">&#34;beta&#34;</span><span class="o">);</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="n">strings</span>
        <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span>
          <span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">Function</span><span class="o">.</span><span class="na">identity</span><span class="o">(),</span><span class="n">String</span><span class="o">::</span><span class="n">length</span><span class="o">,(</span><span class="n">i1</span><span class="o">,</span><span class="n">i2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">i1</span><span class="o">));</span>
<span class="c1">// output: {alpha=5, gamma=5, beta=4}
</span></code></pre></td></tr></table>
</div>
</div><p><font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Function.identity()</font>指向集合中的值，<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>i1</font>和<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>i2</font>是重复键的值。可以只保留一个值，这里选择<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>i1</font>，也可以用这两个值来计算任何东西，比如把它们相加，比较和选择较大的那个，等等。</p>
<div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>整数求和:summingInt ()</font>
</div>
<p>查找集合中所有整数的和。它并不总是初始集合的和，就像我们在下面的例子中使用的我们使用的是字符串列表，首先我们把每个字符串转换成一个等于它的长度的整数，然后把所有的长度相加。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;alpha&#34;</span><span class="o">,</span><span class="s">&#34;beta&#34;</span><span class="o">,</span><span class="s">&#34;gamma&#34;</span><span class="o">);</span>
<span class="n">Integer</span> <span class="n">collect4</span> <span class="o">=</span> <span class="n">strings</span>
      <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
      <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">summingInt</span><span class="o">(</span><span class="n">String</span><span class="o">::</span><span class="n">length</span><span class="o">));</span>
<span class="c1">// output: 18
</span></code></pre></td></tr></table>
</div>
</div><p>或直接集合值和</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">integers</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">1</span><span class="o">,</span><span class="n">2</span><span class="o">,</span><span class="n">3</span><span class="o">,</span><span class="n">4</span><span class="o">,</span><span class="n">5</span><span class="o">,</span><span class="n">6</span><span class="o">,</span><span class="n">6</span><span class="o">);</span>
<span class="n">Integer</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">integers</span>
    <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
    <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">summingInt</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">));</span>
<span class="c1">// output: 27
</span></code></pre></td></tr></table>
</div>
</div><div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>double求和:summingDouble ()</font>
</div>
<p>类似于整数求和，只是它用于双精度值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span>  <span class="n">doubleValues</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">1</span><span class="o">.</span><span class="na">1</span><span class="o">,</span><span class="n">2</span><span class="o">.</span><span class="na">0</span><span class="o">,</span><span class="n">3</span><span class="o">.</span><span class="na">0</span><span class="o">,</span><span class="n">4</span><span class="o">.</span><span class="na">0</span><span class="o">,</span><span class="n">5</span><span class="o">.</span><span class="na">0</span><span class="o">,</span><span class="n">5</span><span class="o">.</span><span class="na">0</span><span class="o">);</span>
<span class="n">Double</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">doubleValues</span>
     <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
     <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">summingDouble</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span><span class="n">x</span><span class="o">));</span>
<span class="c1">// output: 20.1
</span></code></pre></td></tr></table>
</div>
</div><div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>Long求和:summingLong ()</font>
</div>
<p>与前两个相同，用于添加<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>long</font>值或<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>int</font> 值。可以对<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>int</font> 值使用<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>summinglong()</font> ，但不能对<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>long</font>值使用<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>summinglong()</font> 。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">longValues</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">100l</span><span class="o">,</span><span class="n">200l</span><span class="o">,</span><span class="n">300l</span><span class="o">);</span>
<span class="n">Long</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">longValues</span>
    <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
    <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">summingLong</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span><span class="n">x</span><span class="o">));</span>
<span class="c1">// output: 600
</span></code></pre></td></tr></table>
</div>
</div><div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>汇总整数:summarizingInt ()</font>
</div>
<p>它给出集合中出现的值的所有主要算术运算值，如所有值的平均值、最小值、最大值、所有值的计数和总和。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">integers</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">1</span><span class="o">,</span><span class="n">2</span><span class="o">,</span><span class="n">3</span><span class="o">,</span><span class="n">4</span><span class="o">,</span><span class="n">5</span><span class="o">,</span><span class="n">6</span><span class="o">,</span><span class="n">6</span><span class="o">);</span>
<span class="n">IntSummaryStatistics</span> <span class="n">stats</span> <span class="o">=</span> <span class="n">integers</span>
          <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
          <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">summarizingInt</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">));</span>
<span class="c1">//output: IntSummaryStatistics{count=7, sum=27, min=1, average=3.857143, max=6}
</span></code></pre></td></tr></table>
</div>
</div><p>可以使用<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>get</font>方法提取不同的值，如:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">stats</span><span class="o">.</span><span class="na">getAverage</span><span class="o">();</span>   <span class="c1">// 3.857143
</span><span class="c1"></span><span class="n">stats</span><span class="o">.</span><span class="na">getMax</span><span class="o">();</span>       <span class="c1">// 6
</span><span class="c1"></span><span class="n">stats</span><span class="o">.</span><span class="na">getMin</span><span class="o">();</span>       <span class="c1">// 1
</span><span class="c1"></span><span class="n">stats</span><span class="o">.</span><span class="na">getCount</span><span class="o">();</span>     <span class="c1">// 7
</span><span class="c1"></span><span class="n">stats</span><span class="o">.</span><span class="na">getSum</span><span class="o">();</span>       <span class="c1">// 27
</span></code></pre></td></tr></table>
</div>
</div><div style="background-color: #f9f2f4;border-radius: 2px; display:inline-block;*display:inline;*zoom:1;">
    <font color=#c7254e size=5>分组函数:GroupingBy ()</font>
</div>
<p><font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>GroupingBy()</font>是一种高级方法，用于从任何其他集合创建<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Map</font>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;alpha&#34;</span><span class="o">,</span><span class="s">&#34;beta&#34;</span><span class="o">,</span><span class="s">&#34;gamma&#34;</span><span class="o">);</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">collect</span> <span class="o">=</span> <span class="n">strings</span>
          <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
          <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">groupingBy</span><span class="o">(</span><span class="n">String</span><span class="o">::</span><span class="n">length</span><span class="o">));</span>
<span class="c1">// output: {4=[beta, beta], 5=[alpha, gamma]}
</span></code></pre></td></tr></table>
</div>
</div><p>它将字符串长度作为<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>key</font>，并将该长度的字符串列表作为<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>value</font>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;alpha&#34;</span><span class="o">,</span><span class="s">&#34;beta&#34;</span><span class="o">,</span><span class="s">&#34;gamma&#34;</span><span class="o">);</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">collect1</span> <span class="o">=</span> <span class="n">strings</span>
            <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">groupingBy</span><span class="o">(</span><span class="n">String</span><span class="o">::</span><span class="n">length</span><span class="o">,</span> 
                <span class="n">Collectors</span><span class="o">.</span><span class="na">toCollection</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">::</span><span class="k">new</span><span class="o">)));</span>
<span class="c1">// output: {4=[beta, beta], 5=[alpha, gamma]}
</span></code></pre></td></tr></table>
</div>
</div><p>这里指定了<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Map</font>中需要的列表类型(<font style="background-color: #F9F2F4; border-radius: 2px; display:inline-block;*display:inline;*zoom:1;" color=#C7254E size=4>Libkedlist</font>)。</p>
<h2 id="java8-stream集合操作">Java8-Stream集合操作</h2>
<h3 id="stream简介">Stream简介</h3>
<ul>
<li>Java 8引入了全新的Stream API。这里的Stream和I/O流不同，它更像具有Iterable的集合类，但行为和集合类又有所不同。</li>
<li>stream是对集合对象功能的增强，它专注于对集合对象进行各种非常便利、高效的聚合操作，或者大批量数据操作。</li>
<li>只要给出需要对其包含的元素执行什么操作，比如 “过滤掉长度大于 10 的字符串”、“获取每个字符串的首字母”等，Stream 会隐式地在内部进行遍历，做出相应的数据转换。</li>
</ul>
<h3 id="为什么要使用stream">为什么要使用Stream</h3>
<ul>
<li>函数式编程带来的好处尤为明显。这种代码更多地表达了业务逻辑的意图，而不是它的实现机制。易读的代码也易于维护、更可靠、更不容易出错。</li>
<li>高端</li>
</ul>
<h3 id="实例数据源">实例数据源</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Data</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="n">PersonModel</span> <span class="n">wu</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PersonModel</span><span class="o">(</span><span class="s">&#34;wu qi&#34;</span><span class="o">,</span> <span class="n">18</span><span class="o">,</span> <span class="s">&#34;男&#34;</span><span class="o">);</span>
        <span class="n">PersonModel</span> <span class="n">zhang</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PersonModel</span><span class="o">(</span><span class="s">&#34;zhang san&#34;</span><span class="o">,</span> <span class="n">19</span><span class="o">,</span> <span class="s">&#34;男&#34;</span><span class="o">);</span>
        <span class="n">PersonModel</span> <span class="n">wang</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PersonModel</span><span class="o">(</span><span class="s">&#34;wang si&#34;</span><span class="o">,</span> <span class="n">20</span><span class="o">,</span> <span class="s">&#34;女&#34;</span><span class="o">);</span>
        <span class="n">PersonModel</span> <span class="n">zhao</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PersonModel</span><span class="o">(</span><span class="s">&#34;zhao wu&#34;</span><span class="o">,</span> <span class="n">20</span><span class="o">,</span> <span class="s">&#34;男&#34;</span><span class="o">);</span>
        <span class="n">PersonModel</span> <span class="n">chen</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PersonModel</span><span class="o">(</span><span class="s">&#34;chen liu&#34;</span><span class="o">,</span> <span class="n">21</span><span class="o">,</span> <span class="s">&#34;男&#34;</span><span class="o">);</span>
        <span class="n">list</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">wu</span><span class="o">,</span> <span class="n">zhang</span><span class="o">,</span> <span class="n">wang</span><span class="o">,</span> <span class="n">zhao</span><span class="o">,</span> <span class="n">chen</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="nf">getData</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span> 
</code></pre></td></tr></table>
</div>
</div><h3 id="filter">Filter</h3>
<ul>
<li>遍历数据并检查其中的元素时使用。</li>
<li>filter接受一个函数作为参数，该函数用Lambda表达式表示。</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./5.webp"
        data-srcset="./5.webp, ./5.webp 1.5x, ./5.webp 2x"
        data-sizes="auto"
        alt="./5.webp"
        title="5" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="cm">/**
</span><span class="cm">     * 过滤所有的男性
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">fiterSex</span><span class="o">(){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>

        <span class="c1">//old
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">temp</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">PersonModel</span> <span class="n">person</span><span class="o">:</span><span class="n">data</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="s">&#34;男&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="na">getSex</span><span class="o">())){</span>
                <span class="n">temp</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">temp</span><span class="o">);</span>
        <span class="c1">//new
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">collect</span> <span class="o">=</span> <span class="n">data</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">person</span> <span class="o">-&gt;</span> <span class="s">&#34;男&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="na">getSex</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">collect</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 过滤所有的男性 并且小于20岁
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">fiterSexAndAge</span><span class="o">(){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>

        <span class="c1">//old
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">temp</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">PersonModel</span> <span class="n">person</span><span class="o">:</span><span class="n">data</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="s">&#34;男&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="na">getSex</span><span class="o">())&amp;&amp;</span><span class="n">person</span><span class="o">.</span><span class="na">getAge</span><span class="o">()&lt;</span><span class="n">20</span><span class="o">){</span>
                <span class="n">temp</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">//new 1
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">collect</span> <span class="o">=</span> <span class="n">data</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">person</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="s">&#34;男&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="na">getSex</span><span class="o">())&amp;&amp;</span><span class="n">person</span><span class="o">.</span><span class="na">getAge</span><span class="o">()&lt;</span><span class="n">20</span><span class="o">){</span>
                        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                    <span class="o">}</span>
                    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                <span class="o">})</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>
        <span class="c1">//new 2
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">collect1</span> <span class="o">=</span> <span class="n">data</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">person</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="s">&#34;男&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="na">getSex</span><span class="o">())&amp;&amp;</span><span class="n">person</span><span class="o">.</span><span class="na">getAge</span><span class="o">()&lt;</span><span class="n">20</span><span class="o">))</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>

    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Map</p>
<ul>
<li>map生成的是个一对一映射,for的作用</li>
<li>比较常用</li>
<li>而且很简单</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./6.webp"
        data-srcset="./6.webp, ./6.webp 1.5x, ./6.webp 2x"
        data-sizes="auto"
        alt="./6.webp"
        title="6" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">   <span class="cm">/**
</span><span class="cm">     * 取出所有的用户名字
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">getUserNameList</span><span class="o">(){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>

        <span class="c1">//old
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">PersonModel</span> <span class="n">persion</span><span class="o">:</span><span class="n">data</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">persion</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>

        <span class="c1">//new 1
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">collect</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">person</span> <span class="o">-&gt;</span> <span class="n">person</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">collect</span><span class="o">);</span>

        <span class="c1">//new 2
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">collect1</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">PersonModel</span><span class="o">::</span><span class="n">getName</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">collect1</span><span class="o">);</span>

        <span class="c1">//new 3
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">collect2</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">person</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
            <span class="k">return</span> <span class="n">person</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="o">}).</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="flatmap">FlatMap</h3>
<ul>
<li>顾名思义，跟map差不多,更深层次的操作</li>
<li>但还是有区别的</li>
<li>map和flat返回值不同</li>
<li>Map 每个输入元素，都按照规则转换成为另外一个元素。
还有一些场景，是一对多映射关系的，这时需要 flatMap。</li>
<li>Map一对一</li>
<li>Flatmap一对多</li>
<li>map和flatMap的方法声明是不一样的</li>
<li>
<ul>
<li><r> Stream<r>      map(Function mapper);</li>
</ul>
</li>
<li>
<ul>
<li><r> Stream<r> flatMap(Function&gt; mapper);</li>
</ul>
</li>
<li>map和flatMap的区别：我个人认为，flatMap的可以处理更深层次的数据，入参为多个list，结果可以返回为一个list，而map是一对一的，入参是多个list，结果返回必须是多个list。通俗的说，如果入参都是对象，那么flatMap可以操作对象里面的对象，而map只能操作第一层。</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./7.webp"
        data-srcset="./7.webp, ./7.webp 1.5x, ./7.webp 2x"
        data-sizes="auto"
        alt="./7.webp"
        title="7" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">flatMapString</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
        <span class="c1">//返回类型不一样
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">collect</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">person</span> <span class="o">-&gt;</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&#34; &#34;</span><span class="o">))).</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">collect1</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">person</span> <span class="o">-&gt;</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&#34; &#34;</span><span class="o">))).</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>

        <span class="c1">//用map实现
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">collect2</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">person</span> <span class="o">-&gt;</span> <span class="n">person</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&#34; &#34;</span><span class="o">))</span>
                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">Arrays</span><span class="o">::</span><span class="n">stream</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>
        <span class="c1">//另一种方式
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">collect3</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">person</span> <span class="o">-&gt;</span> <span class="n">person</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&#34; &#34;</span><span class="o">))</span>
                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">str</span><span class="o">).</span><span class="na">stream</span><span class="o">()).</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="reduce">Reduce</h3>
<ul>
<li>感觉类似递归</li>
<li>数字(字符串)累加</li>
<li>个人没咋用过</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./8.webp"
        data-srcset="./8.webp, ./8.webp 1.5x, ./8.webp 2x"
        data-sizes="auto"
        alt="./8.webp"
        title="8" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"> <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">reduceTest</span><span class="o">(){</span>
        <span class="c1">//累加，初始化值是 10
</span><span class="c1"></span>        <span class="n">Integer</span> <span class="n">reduce</span> <span class="o">=</span> <span class="n">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">4</span><span class="o">)</span>
                <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="n">10</span><span class="o">,</span> <span class="o">(</span><span class="n">count</span><span class="o">,</span> <span class="n">item</span><span class="o">)</span> <span class="o">-&gt;{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;count:&#34;</span><span class="o">+</span><span class="n">count</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;item:&#34;</span><span class="o">+</span><span class="n">item</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">count</span> <span class="o">+</span> <span class="n">item</span><span class="o">;</span>
        <span class="o">}</span> <span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">reduce</span><span class="o">);</span>

        <span class="n">Integer</span> <span class="n">reduce1</span> <span class="o">=</span> <span class="n">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">4</span><span class="o">)</span>
                <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">reduce1</span><span class="o">);</span>

        <span class="n">String</span> <span class="n">reduce2</span> <span class="o">=</span> <span class="n">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&#34;1&#34;</span><span class="o">,</span> <span class="s">&#34;2&#34;</span><span class="o">,</span> <span class="s">&#34;3&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="s">&#34;0&#34;</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">x</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span> <span class="o">+</span> <span class="n">y</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">reduce2</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="collect">Collect</h3>
<ul>
<li>collect在流中生成列表，map，等常用的数据结构</li>
<li>toList()</li>
<li>toSet()</li>
<li>toMap()</li>
<li>自定义</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm">  * toList
</span><span class="cm">  */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">toListTest</span><span class="o">(){</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">collect</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">PersonModel</span><span class="o">::</span><span class="n">getName</span><span class="o">)</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm">  * toSet
</span><span class="cm">  */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">toSetTest</span><span class="o">(){</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">collect</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">PersonModel</span><span class="o">::</span><span class="n">getName</span><span class="o">)</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toSet</span><span class="o">());</span>
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm">  * toMap
</span><span class="cm">  */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">toMapTest</span><span class="o">(){</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">collect</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span>
        <span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">PersonModel</span><span class="o">::</span><span class="n">getName</span><span class="o">,</span> <span class="n">PersonModel</span><span class="o">::</span><span class="n">getAge</span><span class="o">)</span>
    <span class="o">);</span>

    <span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">per</span><span class="o">-&gt;</span><span class="n">per</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">value</span><span class="o">-&gt;{</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">+</span><span class="s">&#34;1&#34;</span><span class="o">;</span>
        <span class="o">}));</span>
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm">  * toMap处理冲突
</span><span class="cm">  */</span>
<span class="kn">import</span> <span class="nn">lombok.AllArgsConstructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Setter</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.function.Function</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>
 
<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="s">&#34;1&#34;</span><span class="o">));</span>
<span class="c1">//        list.add(new Person(1, &#34;4&#34;));
</span><span class="c1"></span>        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="s">&#34;2&#34;</span><span class="o">));</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="s">&#34;3&#34;</span><span class="o">));</span>
 
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Person</span><span class="o">&gt;</span> <span class="n">collect</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">Person</span><span class="o">::</span><span class="n">getId</span><span class="o">,</span> <span class="n">Function</span><span class="o">.</span><span class="na">identity</span><span class="o">()));</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Person</span><span class="o">&gt;</span> <span class="n">collect1</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">Person</span><span class="o">::</span><span class="n">getId</span><span class="o">,</span> <span class="n">Function</span><span class="o">.</span><span class="na">identity</span><span class="o">(),</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">)-&gt;</span><span class="n">a</span><span class="o">));</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Person</span><span class="o">&gt;</span> <span class="n">collect2</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">Person</span><span class="o">::</span><span class="n">getId</span><span class="o">,</span> <span class="n">v</span> <span class="o">-&gt;</span> <span class="n">v</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">)-&gt;</span><span class="n">a</span><span class="o">));</span>
        <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">values</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">Person</span><span class="o">::</span><span class="n">getId</span><span class="o">,</span> <span class="n">Function</span><span class="o">.</span><span class="na">identity</span><span class="o">(),</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">a</span><span class="o">)).</span><span class="na">values</span><span class="o">();</span>
        <span class="kt">long</span> <span class="n">count</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">Person</span><span class="o">::</span><span class="n">getId</span><span class="o">,</span> <span class="n">Function</span><span class="o">.</span><span class="na">identity</span><span class="o">(),</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">a</span><span class="o">)).</span><span class="na">values</span><span class="o">().</span><span class="na">stream</span><span class="o">().</span><span class="na">count</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">collect</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">collect1</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">collect2</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">values</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">count</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./33.png"
        data-srcset="./33.png, ./33.png 1.5x, ./33.png 2x"
        data-sizes="auto"
        alt="./33.png"
        title="33" /></p>
<p>使用toMap()函数之后，返回的就是一个Map了，自然会需要key和value。
toMap()的第一个参数就是用来生成key值的，第二个参数就是用来生成value值的。
第三个参数用在key值冲突的情况下：如果新元素产生的key在Map中已经出现过了，第三个参数就会定义解决的办法。</p>
<p>在.collect(Collectors.toMap(Person::getId, v -&gt; v, (a,b)-&gt;a))中：</p>
<p>第一个参数：Person:getId表示选择Person的getId作为map的key值；</p>
<p>第二个参数：v-&gt;v表示选择将原来的对象作为Map的value值</p>
<p>第三个参数：(a,b)-&gt;a中，如果a与b的key值相同，选择a作为那个key所对应的value值。</p>
<p>如果key冲突，不加(a,b）-&gt;a会报如下错误</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./34.png"
        data-srcset="./34.png, ./34.png 1.5x, ./34.png 2x"
        data-sizes="auto"
        alt="./34.png"
        title="34" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./35.png"
        data-srcset="./35.png, ./35.png 1.5x, ./35.png 2x"
        data-sizes="auto"
        alt="./35.png"
        title="35" /></p>
<p><a href="https://blog.csdn.net/jiangpingjiangping/article/details/76474010?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.channel_param&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.channel_param" target="_blank" rel="noopener noreferrer">参考1</a></p>
<p><a href="https://blog.csdn.net/jiangpingjiangping/article/details/76474010?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.channel_param&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.channel_param" target="_blank" rel="noopener noreferrer">参考2</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"> <span class="cm">/**
</span><span class="cm">  * 指定类型
</span><span class="cm">  */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">toTreeSetTest</span><span class="o">(){</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
    <span class="n">TreeSet</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">collect</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toCollection</span><span class="o">(</span><span class="n">TreeSet</span><span class="o">::</span><span class="k">new</span><span class="o">));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">collect</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm">  * 分组
</span><span class="cm">  */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">toGroupTest</span><span class="o">(){</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;&gt;</span> <span class="n">collect</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">groupingBy</span><span class="o">(</span><span class="n">per</span> <span class="o">-&gt;</span> <span class="s">&#34;男&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">per</span><span class="o">.</span><span class="na">getSex</span><span class="o">())));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">collect</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm">  * 分隔
</span><span class="cm">  */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">toJoiningTest</span><span class="o">(){</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">collect</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">personModel</span> <span class="o">-&gt;</span> <span class="n">personModel</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">joining</span><span class="o">(</span><span class="s">&#34;,&#34;</span><span class="o">,</span> <span class="s">&#34;{&#34;</span><span class="o">,</span> <span class="s">&#34;}&#34;</span><span class="o">));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">collect</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm">  * 自定义
</span><span class="cm">  */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">reduce</span><span class="o">(){</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">collect</span> <span class="o">=</span> <span class="n">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&#34;1&#34;</span><span class="o">,</span> <span class="s">&#34;2&#34;</span><span class="o">,</span> <span class="s">&#34;3&#34;</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span>
        <span class="n">Collectors</span><span class="o">.</span><span class="na">reducing</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(),</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">x</span><span class="o">),</span> <span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="n">z</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">y</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">z</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">y</span><span class="o">;</span>
        <span class="o">}));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">collect</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="optional">Optional</h3>
<ul>
<li>Optional 是为核心类库新设计的一个数据类型，用来替换 null 值。</li>
<li>人们对原有的 null 值有很多抱怨，甚至连发明这一概念的Tony Hoare也是如此，他曾说这是自己的一个“价值连城的错误”</li>
<li>用处很广，不光在lambda中，哪都能用</li>
<li>Optional.of(T)，T为非空，否则初始化报错</li>
<li>Optional.ofNullable(T)，T为任意，可以为空</li>
<li>isPresent()，相当于 ！=null</li>
<li>ifPresent(T)， T可以是一段lambda表达式 ，或者其他代码，非空则执行</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>


        <span class="n">PersonModel</span> <span class="n">personModel</span><span class="o">=</span><span class="k">new</span> <span class="n">PersonModel</span><span class="o">();</span>

        <span class="c1">//对象为空则打出 -
</span><span class="c1"></span>        <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">o</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">personModel</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">isPresent</span><span class="o">()?</span><span class="n">o</span><span class="o">.</span><span class="na">get</span><span class="o">():</span><span class="s">&#34;-&#34;</span><span class="o">);</span>

        <span class="c1">//名称为空则打出 -
</span><span class="c1"></span>        <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">name</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">personModel</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">isPresent</span><span class="o">()?</span><span class="n">name</span><span class="o">.</span><span class="na">get</span><span class="o">():</span><span class="s">&#34;-&#34;</span><span class="o">);</span>

        <span class="c1">//如果不为空，则打出xxx
</span><span class="c1"></span>        <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="s">&#34;test&#34;</span><span class="o">).</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">na</span><span class="o">-&gt;{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">na</span><span class="o">+</span><span class="s">&#34;ifPresent&#34;</span><span class="o">);</span>
        <span class="o">});</span>

        <span class="c1">//如果空，则返回指定字符串
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="s">&#34;-&#34;</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="s">&#34;1&#34;</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="s">&#34;-&#34;</span><span class="o">));</span>

        <span class="c1">//如果空，则返回 指定方法，或者代码
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="na">orElseGet</span><span class="o">(()-&gt;{</span>
            <span class="k">return</span> <span class="s">&#34;hahah&#34;</span><span class="o">;</span>
        <span class="o">}));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="s">&#34;1&#34;</span><span class="o">).</span><span class="na">orElseGet</span><span class="o">(()-&gt;{</span>
            <span class="k">return</span> <span class="s">&#34;hahah&#34;</span><span class="o">;</span>
        <span class="o">}));</span>

        <span class="c1">//如果空，则可以抛出异常
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="s">&#34;1&#34;</span><span class="o">).</span><span class="na">orElseThrow</span><span class="o">(()-&gt;{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&#34;ss&#34;</span><span class="o">);</span>
        <span class="o">}));</span>


<span class="c1">//        Objects.requireNonNull(null,&#34;is null&#34;);
</span><span class="c1"></span>

        <span class="c1">//利用 Optional 进行多级判断
</span><span class="c1"></span>        <span class="n">EarthModel</span> <span class="n">earthModel1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EarthModel</span><span class="o">();</span>
        <span class="c1">//old
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">earthModel1</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">earthModel1</span><span class="o">.</span><span class="na">getTea</span><span class="o">()!=</span><span class="kc">null</span><span class="o">){</span>
                <span class="c1">//...
</span><span class="c1"></span>            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">//new
</span><span class="c1"></span>        <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">earthModel1</span><span class="o">)</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">EarthModel</span><span class="o">::</span><span class="n">getTea</span><span class="o">)</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">TeaModel</span><span class="o">::</span><span class="n">getType</span><span class="o">)</span>
                <span class="o">.</span><span class="na">isPresent</span><span class="o">();</span>


<span class="c1">//        Optional&lt;EarthModel&gt; earthModel = Optional.ofNullable(new EarthModel());
</span><span class="c1">//        Optional&lt;List&lt;PersonModel&gt;&gt; personModels = earthModel.map(EarthModel::getPersonModels);
</span><span class="c1">//        Optional&lt;Stream&lt;String&gt;&gt; stringStream = personModels.map(per -&gt; per.stream().map(PersonModel::getName));
</span><span class="c1"></span>

        <span class="c1">//判断对象中的list
</span><span class="c1"></span>        <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="k">new</span> <span class="n">EarthModel</span><span class="o">())</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">EarthModel</span><span class="o">::</span><span class="n">getPersonModels</span><span class="o">)</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">pers</span><span class="o">-&gt;</span><span class="n">pers</span>
                        <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">PersonModel</span><span class="o">::</span><span class="n">getName</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">per</span><span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">per</span><span class="o">));</span>


        <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">models</span><span class="o">=</span><span class="n">Data</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
        <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">models</span><span class="o">)</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">per</span> <span class="o">-&gt;</span> <span class="n">per</span>
                        <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">PersonModel</span><span class="o">::</span><span class="n">getName</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">per</span><span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">per</span><span class="o">));</span>

    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="java8用optional处理-null">Java8用Optional处理 null</h4>
<p>注意开头增加</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="ofnullable">ofNullable</h5>
<p>Optional 类是一个可以为null的容器对象。如果值存在则isPresent()方法会返回true，调用get()方法会返回该对象。</p>
<p>Optional 是个容器：它可以保存类型T的值，或者仅仅保存null。Optional提供很多有用的方法，这样我们就不用显式进行空值检测。</p>
<p>Optional 类的引入很好的解决空指针异常。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getGender</span><span class="o">(</span><span class="n">Student</span> <span class="n">student</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">student</span><span class="o">).</span><span class="na">map</span><span class="o">(</span><span class="n">u</span> <span class="o">-&gt;</span> <span class="n">u</span><span class="o">.</span><span class="na">getGender</span><span class="o">()).</span><span class="na">orElse</span><span class="o">(</span><span class="s">&#34;Unkown&#34;</span><span class="o">);</span>    
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="ifpresent">ifPresent()</h5>
<p>isPresent()方法用于判断包装对象的值是否非空。</p>
<p>ifPresent()方法接受一个Consumer对象（消费函数），如果包装对象的值非空，运行Consumer对象的accept()方法。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printName</span><span class="o">(</span><span class="n">Student</span> <span class="n">student</span><span class="o">){</span>
	<span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">student</span><span class="o">).</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">u</span> <span class="o">-&gt;</span>  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;The student name is : &#34;</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="na">getName</span><span class="o">()));</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="filter-1">filter()</h5>
<p>filter()方法接受参数为Predicate对象，用于对Optional对象进行过滤，如果符合Predicate的条件，返回Optional对象本身，否则返回一个空的Optional对象。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">filterAge</span><span class="o">(</span><span class="n">Student</span> <span class="n">student</span><span class="o">){</span>
	<span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">student</span><span class="o">).</span><span class="na">filter</span><span class="o">(</span> <span class="n">u</span> <span class="o">-&gt;</span> <span class="n">u</span><span class="o">.</span><span class="na">getAge</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">18</span><span class="o">).</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">u</span> <span class="o">-&gt;</span>  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;The student age is more than 18.&#34;</span><span class="o">));</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="map-1">map()</h5>
<p>map()方法的参数为Function（函数式接口）对象，map()方法将Optional中的包装对象用Function函数进行运算，并包装成新的Optional对象（包装对象的类型可能改变）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">getAge</span><span class="o">(</span><span class="n">Student</span> <span class="n">student</span><span class="o">){</span>
	<span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">student</span><span class="o">).</span><span class="na">map</span><span class="o">(</span><span class="n">u</span> <span class="o">-&gt;</span> <span class="n">u</span><span class="o">.</span><span class="na">getAge</span><span class="o">());</span> 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="flatmap-1">flatMap()</h5>
<p>跟map()方法不同的是，入参Function函数的返回值类型为Optional类型，而不是U类型，这样flatMap()能将一个二维的Optional对象映射成一个一维的对象。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">getAge</span><span class="o">(</span><span class="n">Student</span> <span class="n">student</span><span class="o">){</span>
	<span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">student</span><span class="o">).</span><span class="na">flatMap</span><span class="o">(</span><span class="n">u</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">u</span><span class="o">.</span><span class="na">getAge</span><span class="o">()));</span> 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="orelse">orElse()</h5>
<p>orElse()方法功能比较简单，即如果包装对象值非空，返回包装对象值，否则返回入参other的值（默认值）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getGender</span><span class="o">(</span><span class="n">Student</span> <span class="n">student</span><span class="o">){</span>
	<span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">student</span><span class="o">).</span><span class="na">map</span><span class="o">(</span><span class="n">u</span> <span class="o">-&gt;</span> <span class="n">u</span><span class="o">.</span><span class="na">getGender</span><span class="o">()).</span><span class="na">orElse</span><span class="o">(</span><span class="s">&#34;Unkown&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="orelseget">orElseGet()</h5>
<p>orElseGet()方法与orElse()方法类似，区别在于orElseGet()方法的入参为一个Supplier对象，用Supplier对象的get()方法的返回值作为默认值。</p>
<p>orElseGet 可以处理需要根据null对象进行处理的场景。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getGender</span><span class="o">(</span><span class="n">Student</span> <span class="n">student</span><span class="o">){</span>
	<span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">student</span><span class="o">).</span><span class="na">map</span><span class="o">(</span><span class="n">u</span> <span class="o">-&gt;</span> <span class="n">u</span><span class="o">.</span><span class="na">getGender</span><span class="o">()).</span><span class="na">orElseGet</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="s">&#34;Unkown&#34;</span><span class="o">);</span>      
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="orelsethrow">orElseThrow()</h5>
<p>orElseThrow()方法其实与orElseGet()方法非常相似了，入参都是Supplier对象，只不过orElseThrow()的Supplier对象必须返回一个Throwable异常，并在orElseThrow()中将异常抛出：</p>
<p>orElseThrow()方法适用于包装对象值为空时需要抛出特定异常的场景。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getGender1</span><span class="o">(</span><span class="n">Student</span> <span class="n">student</span><span class="o">){</span>
    <span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">student</span><span class="o">).</span><span class="na">map</span><span class="o">(</span><span class="n">u</span> <span class="o">-&gt;</span> <span class="n">u</span><span class="o">.</span><span class="na">getGender</span><span class="o">()).</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&#34;Unkown&#34;</span><span class="o">));</span>      
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="并发">并发</h3>
<ul>
<li>stream替换成parallelStream或 parallel</li>
<li>输入流的大小并不是决定并行化是否会带来速度提升的唯一因素，性能还会受到编写代码的方式和核的数量的影响</li>
<li>影响性能的五要素是:数据大小、源数据结构、值是否装箱、可用的CPU核数量，以及处理每个元素所花的时间</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"> <span class="c1">//根据数字的大小，有不同的结果
</span><span class="c1"></span>    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">size</span><span class="o">=</span><span class="n">10000000</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;-----------List-----------&#34;</span><span class="o">);</span>
        <span class="n">testList</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;-----------Set-----------&#34;</span><span class="o">);</span>
        <span class="n">testSet</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 测试list
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">testList</span><span class="o">(){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">size</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">temp1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">size</span><span class="o">);</span>
        <span class="c1">//老的
</span><span class="c1"></span>        <span class="kt">long</span> <span class="n">start</span><span class="o">=</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">i</span><span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">temp1</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(+</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()-</span><span class="n">start</span><span class="o">);</span>

        <span class="c1">//同步
</span><span class="c1"></span>        <span class="kt">long</span> <span class="n">start1</span><span class="o">=</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()-</span><span class="n">start1</span><span class="o">);</span>

        <span class="c1">//并发
</span><span class="c1"></span>        <span class="kt">long</span> <span class="n">start2</span><span class="o">=</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">list</span><span class="o">.</span><span class="na">parallelStream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()-</span><span class="n">start2</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 测试set
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">testSet</span><span class="o">(){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">size</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">temp1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;&gt;(</span><span class="n">size</span><span class="o">);</span>
        <span class="c1">//老的
</span><span class="c1"></span>        <span class="kt">long</span> <span class="n">start</span><span class="o">=</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">i</span><span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">temp1</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(+</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()-</span><span class="n">start</span><span class="o">);</span>

        <span class="c1">//同步
</span><span class="c1"></span>        <span class="kt">long</span> <span class="n">start1</span><span class="o">=</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toSet</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()-</span><span class="n">start1</span><span class="o">);</span>

        <span class="c1">//并发
</span><span class="c1"></span>        <span class="kt">long</span> <span class="n">start2</span><span class="o">=</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">list</span><span class="o">.</span><span class="na">parallelStream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toSet</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()-</span><span class="n">start2</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="调试">调试</h3>
<ul>
<li>list.map.fiter.map.xx 为链式调用，最终调用collect(xx)返回结果</li>
<li>分惰性求值和及早求值</li>
<li>判断一个操作是惰性求值还是及早求值很简单:只需看它的返回值。如果返回值是 Stream，那么是惰性求值;如果返回值是另一个值或为空，那么就是及早求值。使用这些操作的理想方式就是形成一个惰性求值的链，最后用一个及早求值的操作返回想要的结果。</li>
<li>通过peek可以查看每个值，同时能继续操作流</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">peekTest</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonModel</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>

        <span class="c1">//peek打印出遍历的每个per
</span><span class="c1"></span>        <span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">per</span><span class="o">-&gt;</span><span class="n">per</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">peek</span><span class="o">(</span><span class="n">p</span><span class="o">-&gt;{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="o">}).</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="java8-streammapcollect用法">Java8 stream().map().collect()用法</h2>
<h3 id="集合">集合</h3>
<p><code>List&lt;User&gt; users = getList();</code> //从数据库查询的用户集合</p>
<p>现在想获取User的身份证号码；在后续的逻辑处理中要用；</p>
<p>常用的方法我们大家都知道，用for循环，</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">idcards</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span><span class="c1">//定义一个集合来装身份证号码
</span><span class="c1"></span><span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">users</span><span class="o">.</span><span class="na">size</span><span class="o">();</span><span class="n">i</span><span class="o">++){</span>
　　<span class="n">idcards</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">users</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getIdcard</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这种方法要写好几行代码，有没有简单点的，有，java8 API能一行搞定：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">idcards</span><span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">User</span><span class="o">::</span><span class="n">getIdcard</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">())</span>
</code></pre></td></tr></table>
</div>
</div><p>解释下一这行代码：</p>
<ul>
<li>users：一个实体类的集合，类型为<code>List&lt;User&gt;</code></li>
<li>User：实体类</li>
<li>getIdcard：实体类中的get方法，为获取User的idcard</li>
</ul>
<h3 id="stream优点">stream()优点</h3>
<p><strong>无存储。stream不是一种数据结构，它只是某种数据源的一个视图，数据源可以是一个数组，Java容器或I/O channel等。</strong>
<strong>为函数式编程而生。对stream的任何修改都不会修改背后的数据源，比如对stream执行过滤操作并不会删除被过滤的元素，而是会产生一个不包含被过滤元素的新stream。</strong>
<strong>惰式执行。stream上的操作并不会立即执行，只有等到用户真正需要结果的时候才会执行。</strong>
<strong>可消费性。stream只能被“消费”一次，一旦遍历过就会失效，就像容器的迭代器那样，想要再次遍历必须重新生成。</strong>
<strong>stream().map()方法的使用示例:</strong></p>
<h3 id="其他例子">其他例子</h3>
<p>再看几个例子：数组字母小写变大写</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;a&#34;</span><span class="o">,</span> <span class="s">&#34;b&#34;</span><span class="o">,</span> <span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="s">&#34;d&#34;</span><span class="o">);</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">collect</span> <span class="o">=</span><span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">String</span><span class="o">::</span><span class="n">toUpperCase</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">collect</span><span class="o">);</span> <span class="c1">//[A, B, C, D]
</span></code></pre></td></tr></table>
</div>
</div><p>数组所有元素，按某种规律计算：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">num</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">1</span><span class="o">,</span><span class="n">2</span><span class="o">,</span><span class="n">3</span><span class="o">,</span><span class="n">4</span><span class="o">,</span><span class="n">5</span><span class="o">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">collect1</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">*</span> <span class="n">2</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">collect1</span><span class="o">);</span> <span class="c1">//[2, 4, 6, 8, 10]
</span></code></pre></td></tr></table>
</div>
</div><h2 id="为什么在java-8中stringchars是一个整数流">为什么在Java 8中String.chars（）是一个整数流？</h2>
<p>正如其他人已经提到的那样,这背后的设计决策是为了防止方法和类的爆炸.</p>
<p>不过,我个人认为这是一个非常糟糕的决定,并且鉴于他们不想制作<code>CharStream</code>,这应该是合理的,不同的方法而不是<code>chars()</code>,我会想到:</p>
<ul>
<li><code>Stream&lt;Character&gt; chars()</code>,这给出了一个盒子字符流,这将有一些轻微的性能损失.</li>
<li><code>IntStream unboxedChars()</code>,将用于性能代码.</li>
</ul>
<p><strong>但是</strong>,我认为这个答案应该专注于展示使用Java 8获得的API的方法,而不是关注<em>为什么</em>它以这种方式完成.</p>
<p>在Java 7中,我会这样做:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">hello</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">hello</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>我认为在Java 8中使用它的合理方法如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">hello</span><span class="o">.</span><span class="na">chars</span><span class="o">()</span>
        <span class="o">.</span><span class="na">mapToObj</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span><span class="n">i</span><span class="o">)</span>
        <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>在这里,我获得了一个<code>IntStream</code>并通过lambda <code>i -&gt; (char)i</code>将它映射到一个对象,这将自动将其打包成一个<code>Stream&lt;Character&gt;</code>,然后我们可以做我们想要的,并仍然使用方法引用作为加号.</p>
<p><strong>请注意</strong>,你<em>必须</em>这样做<code>mapToObj</code>,如果你忘记并使用<code>map</code>,那么没有什么会抱怨,但你仍然<code>IntStream</code>会得到一个,你可能会想知道为什么它打印整数值而不是代表字符的字符串.</p>
<p><strong>Java 8的其他丑陋替代品:</strong></p>
<p>通过保留<code>IntStream</code>并希望最终打印它们,您不能再使用方法引用进行打印:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">hello</span><span class="o">.</span><span class="na">chars</span><span class="o">()</span>
        <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="kt">char</span><span class="o">)</span><span class="n">i</span><span class="o">));</span>
</code></pre></td></tr></table>
</div>
</div><p>而且,使用方法引用自己的方法不再起作用了!考虑以下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">char</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>然后</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">hello</span><span class="o">.</span><span class="na">chars</span><span class="o">()</span>
        <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">print</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>这将产生编译错误,因为可能存在有损转换.</p>
<p><strong>结论:</strong></p>
<p>API是这样设计的,因为不想添加<code>CharStream</code>,我个人认为该方法应该返回一个<code>Stream&lt;Character&gt;</code>,并且当前的解决方法是使用<code>mapToObj(i -&gt; (char)i)</code>on <code>IntStream</code>来能够正常使用它们.</p>
<p><strong>补充</strong></p>
<p>任何API的设计都是一系列的权衡.在Java中,其中一个难题是处理很久以前制定的设计决策.</p>
<p>从1.0开始,基元就一直在Java中.它们使Java成为一种&quot;不纯的&quot;面向对象语言,因为原语不是对象.我相信,添加原语是一种务实的决定,以牺牲面向对象的纯度为代价来提高性能.</p>
<p>这是近20年后我们仍然生活在今天的权衡.Java 5中添加的自动装箱功能大多消除了使用装箱和拆箱方法调用来混乱源代码的需要,但开销仍然存在.在许多情况下,它并不明显.但是,如果您要在内部循环中执行装箱或拆箱,您会发现它可能会产生大量的CPU和垃圾收集开销.</p>
<p>在设计Streams API时,很明显我们必须支持原语.装箱/拆箱开销会破坏并行性带来的任何性能优势.但是,我们不想支持<strong>所有</strong>原语,因为这会给API增加大量的混乱.(你能真正看到一个用途<code>ShortStream</code>？)&ldquo;全部&quot;或&quot;无&quot;是设计的舒适场所,但都不可接受.所以我们必须找到合理的&quot;一些&quot;价值.我们结束了与原始的专长<code>int</code>,<code>long</code>和<code>double</code>.(我个人可能会漏掉<code>int</code>但那只是我.)</p>
<p>因为<code>CharSequence.chars()</code>我们考虑返回<code>Stream&lt;Character&gt;</code>(早期的原型可能实现了这个),但由于拳击开销而被拒绝.考虑到String将<code>char</code>值作为基元,当调用者可能只对该值进行一些处理并将其反转回字符串时,无条件地强加拳击似乎是错误的.</p>
<p>我们还考虑了一种<code>CharStream</code>原始的特化,但与它添加到API的批量相比,它的使用似乎相当狭窄.添加它似乎不值得.</p>
<p>对调用者施加的惩罚是他们必须知道<code>IntStream</code>包含的<code>char</code>值表示为<code>ints</code>和必须在适当的位置进行转换.这是令人困惑的,因为有过多的API调用,<code>PrintStream.print(char)</code>并且<code>PrintStream.print(int)</code>它们的行为明显不同.可能会出现另一个混乱点,因为<code>codePoints()</code>调用也返回一个<code>IntStream</code>但它包含的值非常不同.</p>
<p>因此,这归结为在几种选择中实际选择:</p>
<ol>
<li>我们不能提供原始的特化,从而产生一个简单,优雅,一致的API,但它会带来高性能和GC开销;</li>
<li>我们可以提供一整套原始专业化,代价是混乱API并给JDK开发人员带来维护负担; 要么</li>
<li>我们可以提供一个原始特化的子集,给出一个中等大小,高性能的API,在相当窄范围的用例(字符处理)中给调用者带来相对较小的负担.</li>
</ol>
<p>我们选择了最后一个</p>
<hr>
<ul>
<li>
<p>只有三种系统自带的streams：IntStream, LongStream and DoubleStream.CharStream 并不存在，原因就是防止方法和类的爆炸，其他类型如（char、short、float）可以用它们更大的等价类型（int、double）来表示，同时也不会有显著的性能损失。已有的三个流的重载可能已经存在接口爆炸的现象了，如果八个接口都存在流类型，可能爆炸会非常严重。</p>
</li>
<li>
<p>但我的建议是使用<code>codePoints()</code>而不是<code>chars()</code>你会发现很多库函数已经接受<code>int</code>除了<code>char</code>之外的代码点,例如<code>的所有方法java.lang.Character</code>以及<code>StringBuilder.appendCodePoint</code>等.这个支持从<code>jdk1.5</code>开始存在. 同时chars并不包含所有Unicode字符（他会切分代理对（UTF-16中用于扩展字符而使用的编码）），除非您确定不会是使用高位代码字符。</p>
</li>
<li>
<p>关于代码点的好处.使用它们将处理补充字符,它们在<code>String</code>或<code>char []</code>中表示为代理对.大多数<code>char</code>处理代码极有可能错误处理了代理对.，这就是为什么<code>Stream&lt;Character&gt;</code>不应该存在了</p>
</li>
<li>
<p>定义`void print(int ch){System.out.println((char)ch); 然后你可以使用方法引用，可能是一种办法</p>
</li>
<li>
<p>自带的Stream<code>Collector</code>的<code>collect()</code>方法.它们只有前面评论中提到的三参数<code>collect()</code>方法.可能代码要繁琐一点。使用代码点流(IntStream)也不错:<code>collect(StringBuilder :: new,StringBuilder :: appendCodePoint,StringBuilder :: append).toString()</code>.我猜它不是很短,但使用代码点避免了<code>(char)</code>强制转换,并允许使用方法引用.此外,它正确处理代理人. 但是可以使用.collect(Collectors.joining())</p>
</li>
<li>
<p>多亏了重复的问题,我注意到了这个.我同意<code>chars()</code>返回<code>IntStream</code>并不是一个大问题,特别是考虑到它很少使用这种方法的事实.然而,有一个内置的方法将<code>IntStream</code>转换回<code>String</code>会很好.它可以用<code>.reduce(StringBuilder :: new,(sb,c) - &gt; sb.append((char)c),StringBuilder :: append).toString()</code>完成,但它确实很长.</p>
</li>
<li>
<p>极简主义在这里出现.如果已经有<code>chars()</code>方法返回<code>IntStream</code>中的char值,那么为了获得相同的值但是以盒装形式的另一个API调用,它并没有增加太多.呼叫者可以毫不费力地打包值.当然,不必在这种(可能是罕见的)情况下执行此操作会更方便,但代价是为API添加混乱.</p>
</li>
<li>
<p>但是，它没有回答为什么chars（）不能有两个不同的方法，一个返回流<code>Stream&lt;Character&gt;</code>（性能损失很小），另一个是IntStream，这也被考虑了吗？如果人们认为便利性比性能损失更值得，那么他们很可能最终会将其映射到流<code>Stream&lt;Character&gt;</code>。</p>
</li>
<li>
<blockquote>
<p>(我个人可能会漏掉<code>int</code>但那只是我.)</p>
</blockquote>
</li>
<li>
<p>int是唯一保证是原子的，不是长的和双精度的，所以并不对</p>
</li>
<li>
<p>真正的说法是long和double的非原子性在流中并不真正相关，因为这些值都不会出现在跨线程共享的字段中。从纯API的角度来看，int不能做long也不能做的事情，所以从这个意义上说int是多余的。我怀疑使用IntStream的真正原因是性能，因为它只需要移动LongStream的一半数据。不过，我还没有测量过这个。</p>
</li>
<li>
<p>非常不幸，这将花费开发人员数千小时的时间，因为像：array.stream（char[]）这样的自然构造不起作用，开发人员将在谷歌上寻找替代方案。至少应该存在array.stream（char/byte/short[]）并返回IntStream。</p>
</li>
</ul>
<h2 id="深入理解java双冒号运算符的使用">深入理解Java双冒号(::)运算符的使用</h2>
<p>Jdk8中有好多新的特性，比如引入Lambda，简化代码的书写等等</p>
<p>Java8 推出了属于Java的lambda表达式，与一众的 =&gt; 不同，Java选择了 -&gt; 做为箭头符号。有没有观众知道为什么这么选择。 lambda表达式的基本格式是这样的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="o">(</span> <span class="o">)-&gt;{</span> <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>分析</strong></p>
<p>java此时还有另外一个特性叫做lambda表达式和函数式接口，仅仅有一个未实现方法的接口，可以直接写作(参数列表) -&gt; {方法体}这种形式。</p>
<p>例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@FunctionalInterface</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">FuncA</span> <span class="o">{</span>
   <span class="kt">void</span> <span class="nf">doSomeThing</span><span class="o">(</span><span class="n">String</span> <span class="n">str</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>那么上面这种接口就可以直接写作：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">FuncA</span> <span class="n">funcA</span> <span class="o">=</span> <span class="o">(</span><span class="n">str</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;hello&#34;</span><span class="o">);</span>
<span class="o">};</span>
</code></pre></td></tr></table>
</div>
</div><p>类似的还有Swing或者javaFx的监听器：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">btn</span><span class="o">.</span><span class="na">addActionListener</span><span class="o">(</span><span class="n">e</span><span class="o">-&gt;{</span>
  <span class="c1">// do something
</span><span class="c1"></span><span class="o">});</span>
</code></pre></td></tr></table>
</div>
</div><p>或者</p>
<p>java.lang.Iterable 的 foreach(xxx)方法中的xxx位置需要一个 Consumer 接口类</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">default</span> <span class="kt">void</span> <span class="nf">forEach</span><span class="o">(</span><span class="n">Consumer</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">action</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">action</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">T</span> <span class="n">t</span> <span class="o">:</span> <span class="k">this</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">action</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>而 Consumer 正好是一个函数式接口，@FunctionalInterface 注解和上面类似</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@FunctionalInterface</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Consumer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">);</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这样就省去了之前需要专为他编写一个实现类或者匿名内部类的代码，直接对接口进行实现。</p>
<p>而在这之上，如果一个方法的调用中，这个方法给接口提供的参数和他接收的返回，和你现有某个实现完全一致，就可以进一步进行简化，称为方法引用。</p>
<p>forEach方法提供一个某种类型的Object（具体是什么类型是要看Stream类的泛型参数<T>的，不过一般就是这个集合提供的那种类型），而System.out.println可以接受一个Object，因此，forEach提供的参数和System.out.println的参数类型是一致的，可以进行这种简写。</p>
<p>具体来说就是：原本应该写为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">element</span> <span class="o">-&gt;</span> <span class="o">{</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">element</span><span class="o">)</span>
<span class="o">})</span>
</code></pre></td></tr></table>
</div>
</div><p>但是System.out.println的参数和传递的参数element 的类型完全匹配，所以这样的时候就可以简化为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="o">.</span><span class="na">forEach</span><span class="err">（</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>即forEach将会使用System.out对象的println方法进行接下来的操作。</p>
<p>那么对于Coutum接口可以这么用  <code>Consumer one = (x) -&gt; { System.out.println(x) }</code> ，这句可以和上面结合起来看，x就是accept中的t，花括号里没有return是因为accept返回值是void。因为 Consumer 接口中只有一个方法，因此不会有冲突的可能。 然后再把 <code>one</code> 传进去forEach就可以了。</p>
<p><strong>使用</strong></p>
<p>我们先看一个关于Lambda的使用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm">* 输出list
</span><span class="cm"> */</span>
<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
	<span class="n">String</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="o">{</span><span class="s">&#34;aaaa&#34;</span><span class="o">,</span> <span class="s">&#34;bbbb&#34;</span><span class="o">,</span> <span class="s">&#34;cccc&#34;</span><span class="o">};</span>
	<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">array</span><span class="o">);</span>
	
	<span class="c1">//Java 7 
</span><span class="c1"></span>	<span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">:</span><span class="n">list</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="c1">//Java 8
</span><span class="c1"></span>	<span class="n">list</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>其中<code>list.forEach(System.out::println);</code>就是Java 8中的Lambda写法之一， 有没有特别注意到输出语句跟我们平时写的syso语句不一样，常规输出语句是这样的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;流浪地球拍的不错哦！&#34;</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>这里面使用到了<code>::</code>， 有点意思，来认识一下这个新东西！</p>
<h3 id="双冒号">双冒号（::）</h3>
<p>英文：double colon，双冒号（<code>::</code>）运算符在Java 8中被用作<strong>方法引用（method reference）</strong>，方法引用是与lambda表达式相关的一个重要特性。它提供了一种不执行方法的方法。为此，方法引用需要由兼容的函数接口组成的目标类型上下文。</p>
<blockquote>
<p><strong>Method References</strong>
You use lambda expressions to create anonymous methods. Sometimes, however, a lambda expression does nothing but call an existing method. In those cases, it’s often clearer to refer to the existing method by name. Method references enable you to do this; they are compact, easy-to-read lambda expressions for methods that already have a name.
关于方法引用的描述，摘自<a href="https://docs.oracle.com/javase/tutorial/java/javaOO/methodreferences.html" target="_blank" rel="noopener noreferrer">oracle官网</a></p>
</blockquote>
<p>大致意思是，使用lambda表达式会创建匿名方法， 但有时候需要使用一个lambda表达式只调用一个已经存在的方法（不做其它）， 所以这才有了方法引用！</p>
<p><strong>条件1</strong></p>
<p>条件1为必要条件，必须要满足这个条件才能使用双冒号。</p>
<p>Lambda表达式内部只有一条表达式(第一种Lambda表达式)，并且这个表达式只是调用已经存在的方法，不做其他的操作。</p>
<p><strong>条件2</strong></p>
<p>由于双冒号是为了省略item -&gt;这一部分，所以条件2是需要满足不需要写参数item也知道如何使用item的情况。</p>
<p>有两种情况可以满足这个要求，这就是我将双冒号的使用分为2类的依据。</p>
<p>以下是Java 8中方法引用的一些语法：</p>
<ol>
<li>静态方法引用（static method）语法：classname::methodname 例如：Person::getAge</li>
<li>对象的实例方法引用语法：instancename::methodname 例如：System.out::println</li>
<li>对象的超类方法引用语法： super::methodname</li>
<li>类构造器引用语法： classname::new 例如：ArrayList::new</li>
<li>数组构造器引用语法： typename[]::new 例如： String[]:new</li>
</ol>
<p><strong>总的来说lambda 表达式允许4种方式的双冒号</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./9.jpg"
        data-srcset="./9.jpg, ./9.jpg 1.5x, ./9.jpg 2x"
        data-sizes="auto"
        alt="./9.jpg"
        title="9" /></p>
<p><strong>如果上的语法太枯燥，那就通过一些例子来加强对它的理解：</strong></p>
<p>静态方法语法使用例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span class="o">;</span>
<span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * @author zhoufy
</span><span class="cm"> * @date 2019年2月20日 下午2:19:13
</span><span class="cm"> */</span>
<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="s">&#34;com.zhoufy&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Demo</span> <span class="o">{</span>
	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;aaaa&#34;</span><span class="o">,</span> <span class="s">&#34;bbbb&#34;</span><span class="o">,</span> <span class="s">&#34;cccc&#34;</span><span class="o">);</span>
		
		<span class="c1">//静态方法语法	ClassName::methodName
</span><span class="c1"></span>		<span class="n">list</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">Demo</span><span class="o">::</span><span class="n">print</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>类实例方法语法使用例子：</p>
<p>其中的 Class 指的是类名，产生于 class Class { }。object 是实例对象，产生于 <code>Class object = new Class();</code>  一个一个的说。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nl">object:</span><span class="o">:</span><span class="n">instanceMethod</span><span class="err">`</span>  <span class="n">的一个典型用法就是</span> <span class="err">`</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span>
</code></pre></td></tr></table>
</div>
</div><p>在此请回看 Consumer 类的代码，就明白了为什么 <code>Consumer one = System.out::println</code> 是 <code>Consumer one = t -&gt; System.out.println(t)</code> 的简写</p>
<p>在这里插一个多线程的lambda表达式使用技巧：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span><span class="lnt">99
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">cn.edu.hubu.lhy</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SynchronizedTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">method1</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;当前线程：&#34;</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Method 1 start&#34;</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Method 1 execute&#34;</span><span class="o">);</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">3000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Method 1 end&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">method1</span><span class="o">(</span><span class="n">String</span> <span class="n">flag</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;当前线程：&#34;</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Method 1 start,flag=&#34;</span> <span class="o">+</span> <span class="n">flag</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Method 1 execute,flag=&#34;</span> <span class="o">+</span> <span class="n">flag</span><span class="o">);</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">3000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Method 1 end,flag=&#34;</span> <span class="o">+</span> <span class="n">flag</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">method2</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;当前线程：&#34;</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Method 2 start&#34;</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Method 2 execute&#34;</span><span class="o">);</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Method 2 end&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">method2</span><span class="o">(</span><span class="n">String</span> <span class="n">flag</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;当前线程：&#34;</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Method 2 start,flag=&#34;</span> <span class="o">+</span> <span class="n">flag</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Method 2 execute,flag=&#34;</span> <span class="o">+</span> <span class="n">flag</span><span class="o">);</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Method 2 end,flag=&#34;</span> <span class="o">+</span> <span class="n">flag</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 一种最简洁的启动方法
</span><span class="c1">//        new Thread( ()-&gt; new SynchronizedTest().method1() ).start();
</span><span class="c1"></span>        <span class="c1">//新建实例对象的启动方法
</span><span class="c1"></span>        <span class="kd">final</span> <span class="n">SynchronizedTest</span> <span class="n">test</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SynchronizedTest</span><span class="o">();</span>

        <span class="n">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">test</span><span class="o">::</span><span class="n">method1</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;t1:&#34;</span> <span class="o">+</span> <span class="n">t1</span><span class="o">);</span>
        <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="n">Thread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">test</span><span class="o">.</span><span class="na">method1</span><span class="o">(</span><span class="s">&#34;1&#34;</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;t2:&#34;</span> <span class="o">+</span> <span class="n">t2</span><span class="o">);</span>
        <span class="n">t2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="c1">//
</span><span class="c1">//        显式的赋值Runnable后再启动
</span><span class="c1"></span>        <span class="n">Runnable</span> <span class="n">tt</span> <span class="o">=</span> <span class="n">test</span><span class="o">::</span><span class="n">method1</span><span class="o">;</span>
        <span class="n">Thread</span> <span class="n">t3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">tt</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;t3:&#34;</span> <span class="o">+</span> <span class="n">t3</span><span class="o">);</span>
        <span class="n">t3</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="n">Runnable</span> <span class="n">tt2</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">test</span><span class="o">.</span><span class="na">method1</span><span class="o">(</span><span class="s">&#34;1&#34;</span><span class="o">);</span>
        <span class="n">Thread</span> <span class="n">t4</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">tt2</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;t4:&#34;</span> <span class="o">+</span> <span class="n">t4</span><span class="o">);</span>
        <span class="n">t4</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="c1">//
</span><span class="c1"></span>        <span class="n">Thread</span> <span class="n">t5</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">test</span><span class="o">::</span><span class="n">method2</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;t5:&#34;</span> <span class="o">+</span> <span class="n">t5</span><span class="o">);</span>
        <span class="n">t5</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="n">Thread</span> <span class="n">t6</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">test</span><span class="o">.</span><span class="na">method2</span><span class="o">(</span><span class="s">&#34;1&#34;</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;t6:&#34;</span> <span class="o">+</span> <span class="n">t6</span><span class="o">);</span>
        <span class="n">t6</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="c1">//
</span><span class="c1">//        显式的赋值Runnable后再启动
</span><span class="c1"></span>        <span class="n">Runnable</span> <span class="n">tt3</span> <span class="o">=</span> <span class="n">test</span><span class="o">::</span><span class="n">method2</span><span class="o">;</span>
        <span class="n">Thread</span> <span class="n">t7</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">tt3</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;t7:&#34;</span> <span class="o">+</span> <span class="n">t7</span><span class="o">);</span>
        <span class="n">t7</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="n">Runnable</span> <span class="n">tt4</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">test</span><span class="o">.</span><span class="na">method2</span><span class="o">(</span><span class="s">&#34;1&#34;</span><span class="o">);</span>
        <span class="n">Thread</span> <span class="n">t8</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">tt4</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;t4:&#34;</span> <span class="o">+</span> <span class="n">t8</span><span class="o">);</span>
        <span class="n">t8</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="c1">//运行完后对结果有没有疑问？ 为什么2后面还有1？
</span><span class="c1"></span>        <span class="c1">//线程不设置flag，无为而治的执行顺序为先执行第一个线程，然后从最后一个线程倒序执行到第二个线程
</span><span class="c1"></span>    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span class="o">;</span>
<span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * @author zhoufy
</span><span class="cm"> * @date 2019年2月20日 下午2:19:13
</span><span class="cm"> */</span>
<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="s">&#34;com.zhoufy&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Demo</span> <span class="o">{</span>
	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;aaaa&#34;</span><span class="o">,</span> <span class="s">&#34;bbbb&#34;</span><span class="o">,</span> <span class="s">&#34;cccc&#34;</span><span class="o">);</span>
		
		<span class="c1">//对象实例语法	instanceRef::methodName
</span><span class="c1"></span>		<span class="n">list</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="k">new</span> <span class="n">Demo</span><span class="o">()::</span><span class="n">print</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>超类方法语法使用例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span class="o">;</span>


<span class="cm">/**
</span><span class="cm"> * @author zhoufy
</span><span class="cm"> * @date 2019年2月20日 下午2:41:38
</span><span class="cm"> */</span>
<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="s">&#34;com.zhoufy&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="kd">extends</span> <span class="n">BaseExample</span><span class="o">{</span>

	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;aaaa&#34;</span><span class="o">,</span> <span class="s">&#34;bbbb&#34;</span><span class="o">,</span> <span class="s">&#34;cccc&#34;</span><span class="o">);</span>
		
		<span class="c1">//对象的超类方法语法： super::methodName 
</span><span class="c1"></span>		<span class="n">list</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="kd">super</span><span class="o">::</span><span class="n">print</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">BaseExample</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>类构造器语法使用例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span class="o">;</span>
<span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * @author zhoufy
</span><span class="cm"> * @date 2019年2月20日 下午2:19:13
</span><span class="cm"> */</span>
<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="s">&#34;com.zhoufy&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>

	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">InterfaceExample</span> <span class="n">com</span> <span class="o">=</span>  <span class="n">Example</span><span class="o">::</span><span class="k">new</span><span class="o">;</span>
		<span class="n">Example</span> <span class="n">bean</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>	
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">InterfaceExample</span><span class="o">{</span>
	<span class="n">Example</span> <span class="nf">create</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>如果是带参数的构造器，示例如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * @author zhoufy
</span><span class="cm"> * @date 2019年2月20日 下午2:19:13
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>
	
	<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
	
	<span class="n">Example</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">){</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">InterfaceExample</span> <span class="n">com</span> <span class="o">=</span>  <span class="n">Example</span><span class="o">::</span><span class="k">new</span><span class="o">;</span>
		<span class="n">Example</span> <span class="n">bean</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&#34;hello world&#34;</span><span class="o">);</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bean</span><span class="o">.</span><span class="na">name</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
<span class="kd">interface</span> <span class="nc">InterfaceExample</span><span class="o">{</span>
	<span class="n">Example</span> <span class="nf">create</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这里需要特别注意的是：Example 类并没有implements InterfaceExample接口哦！！！</p>
<p>数组构造器语法使用例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">java.util.function.Function</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author zhoufy
</span><span class="cm"> * @date 2019年2月20日 下午2:19:13
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">Function</span> <span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Example</span><span class="o">[]&gt;</span> <span class="n">function</span> <span class="o">=</span> <span class="n">Example</span><span class="o">[]::</span><span class="k">new</span><span class="o">;</span>
		<span class="n">Example</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">4</span><span class="o">);</span>	<span class="c1">//这里的4是数组的大小
</span><span class="c1"></span>		
		<span class="k">for</span><span class="o">(</span><span class="n">Example</span> <span class="n">e</span><span class="o">:</span><span class="n">array</span><span class="o">){</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>	<span class="c1">//如果输出的话，你会发现会输出4个空对象(null)
</span><span class="c1"></span>		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这里是借用jdk自带的java.util.function.Function类实现的，如果想要自定义接口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * @author zhoufy
</span><span class="cm"> * @date 2019年2月20日 下午2:19:13
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>
	
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">Interface</span> <span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Example</span><span class="o">[]&gt;</span> <span class="n">function</span> <span class="o">=</span> <span class="n">Example</span><span class="o">[]::</span><span class="k">new</span><span class="o">;</span>
		<span class="n">Example</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">4</span><span class="o">);</span>	<span class="c1">//这里的4是数组的大小
</span><span class="c1"></span>		
		<span class="k">for</span><span class="o">(</span><span class="n">Example</span> <span class="n">e</span><span class="o">:</span><span class="n">array</span><span class="o">){</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@FunctionalInterface</span>
<span class="kd">interface</span> <span class="nc">Interface</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span> <span class="n">T</span><span class="o">&gt;{</span>
	<span class="n">T</span> <span class="nf">apply</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">);</span> 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="自定义接口的几种调用方法">自定义接口的几种调用方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">interface</span> <span class="nc">Person</span><span class="o">{</span>
    <span class="kt">void</span> <span class="nf">say</span><span class="o">(</span><span class="n">String</span> <span class="n">t</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">AnimalSay</span><span class="o">{</span>  
     <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">saySomething</span><span class="o">(</span><span class="n">String</span> <span class="n">something</span><span class="o">,</span><span class="n">Person</span> <span class="n">person</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">person</span><span class="o">.</span><span class="na">say</span><span class="o">(</span><span class="n">something</span><span class="o">);</span>
     <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Mian</span> <span class="o">{</span>
     <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>  
         <span class="n">Person</span> <span class="n">xiaoMing</span> <span class="o">=</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">);</span> <span class="o">};</span>    <span class="c1">//1
</span><span class="c1"></span>         <span class="c1">//xiaoMing.say(&#34;hello&#34;);
</span><span class="c1"></span>         <span class="n">AnimalSay</span><span class="o">.</span><span class="na">saySomething</span><span class="o">(</span><span class="s">&#34;hello&#34;</span><span class="o">,</span> <span class="n">xiaoMing</span> <span class="o">);</span>           <span class="c1">//2
</span><span class="c1"></span>         <span class="c1">//AnimalSay.saySomething(&#34;hello&#34;, (x)-&gt;{System.out.println(x)};);    //3
</span><span class="c1"></span>     <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>可以直接把 lambda 表达式直接放在需要的位置。这时候 lambda 就可以自动变成所需类 （上面代码被注掉的部分）。</p>
<p>那么回到最开始也有两种用法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">//第一种
</span><span class="c1"></span><span class="n">Consumer</span> <span class="n">one</span> <span class="o">=</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">);};</span>
<span class="n">Iterable</span><span class="o">.</span><span class="na">foreach</span><span class="o">(</span><span class="n">one</span><span class="o">);</span>
<span class="c1">//第二种
</span><span class="c1"></span><span class="n">Iterable</span><span class="o">.</span><span class="na">foreach</span><span class="o">(</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="java双端队列deque使用详解">Java双端队列Deque使用详解</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./10.jpg"
        data-srcset="./10.jpg, ./10.jpg 1.5x, ./10.jpg 2x"
        data-sizes="auto"
        alt="./10.jpg"
        title="10" /></p>
<p>Deque是一个双端队列接口，继承自Queue接口，Deque的实现类是LinkedList、ArrayDeque、LinkedBlockingDeque，其中LinkedList是最常用的。</p>
<h3 id="deque有三种用途">Deque有三种用途：</h3>
<ul>
<li>普通队列(一端进另一端出):
Queue queue = new LinkedList()或Deque deque = new LinkedList()</li>
<li>双端队列(两端都可进出)
Deque deque = new LinkedList()</li>
<li>堆栈
Deque deque = new LinkedList()</li>
</ul>
<blockquote>
<p>注意：Java堆栈Stack类已经过时，Java官方推荐使用Deque替代Stack使用。Deque堆栈操作方法：push()、pop()、peek()。</p>
</blockquote>
<p>Deque是一个线性collection，支持在两端插入和移除元素。名称 deque 是“double ended queue（双端队列）”的缩写，通常读为“deck”。大多数 Deque 实现对于它们能够包含的元素数没有固定限制，但此接口既支持有容量限制的双端队列，也支持没有固定大小限制的双端队列。</p>
<p>此接口定义在双端队列两端访问元素的方法。提供插入、移除和检查元素的方法。每种方法都存在两种形式：一种形式在操作失败时抛出异常，另一种形式返回一个特殊值（null 或 false，具体取决于操作）。插入操作的后一种形式是专为使用有容量限制的 Deque 实现设计的；在大多数实现中，插入操作不能失败。</p>
<p>下表总结了上述 12 种方法：</p>
<table border="" cellpadding="3" cellspacing="1">
    <tbody>
        <tr bgcolor="#20252b">
            <td></td>
            <td align="CENTER" colspan="2" style="color: #20252b;"> <b>第一个元素 (头部)</b></td>
            <td align="CENTER" colspan="2"> <b>最后一个元素 (尾部)</b></td>
        </tr>
        <tr>
            <td></td>
            <td align="CENTER"><em>抛出异常</em></td>
            <td align="CENTER"><em>特殊值</em></td>
            <td align="CENTER"><em>抛出异常</em></td>
            <td align="CENTER"><em>特殊值</em></td>
        </tr>
        <tr>
            <td><b>插入</b></td>
            <td>addFirst(e)</td>
            <td>offerFirst(e)</td>
            <td>addLast(e)</td>
            <td>offerLast(e)</td>
        </tr>
        <tr>
            <td><b>删除</b></td>
            <td>removeFirst()</td>
            <td>pollFirst()</td>
            <td>removeLast()</td>
            <td>pollLast()</td>
        </tr>
        <tr>
            <td><b>检查</b></td>
            <td>getFirst()</td>
            <td>peekFirst()</td>
            <td>getLast()</td>
            <td>peekLast()</td>
        </tr>
    </tbody>
</table>
<p>Deque接口扩展(继承)了 Queue 接口。在将双端队列用作队列时，将得到 FIFO（先进先出）行为。将元素添加到双端队列的末尾，从双端队列的开头移除元素。从 Queue 接口继承的方法完全等效于 Deque 方法，如下表所示：</p>
<table>
<thead>
<tr>
<th style="text-align:center"><strong>Queue方法</strong></th>
<th style="text-align:center"><strong>等效Deque方法</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">add add(e)</td>
<td style="text-align:center">addLast(e)</td>
</tr>
<tr>
<td style="text-align:center">offer(e)</td>
<td style="text-align:center">offerLast(e)</td>
</tr>
<tr>
<td style="text-align:center">remove()</td>
<td style="text-align:center">removeFirst()</td>
</tr>
<tr>
<td style="text-align:center">poll()</td>
<td style="text-align:center">pollFirst()</td>
</tr>
<tr>
<td style="text-align:center">element()</td>
<td style="text-align:center">getFirst()</td>
</tr>
<tr>
<td style="text-align:center">peek()</td>
<td style="text-align:center">peekFirst()</td>
</tr>
</tbody>
</table>
<p>双端队列也可用作 LIFO（后进先出）堆栈。应优先使用此接口而不是遗留 Stack 类。在将双端队列用作堆栈时，元素被推入双端队列的开头并从双端队列开头弹出。堆栈方法完全等效于 Deque 方法，如下表所示：</p>
<table>
<thead>
<tr>
<th style="text-align:center"><strong>堆栈方法</strong></th>
<th style="text-align:center"><strong>等效Deque方法</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">push(e)</td>
<td style="text-align:center">addFirst(e)</td>
</tr>
<tr>
<td style="text-align:center">pop()</td>
<td style="text-align:center">removeFirst()</td>
</tr>
<tr>
<td style="text-align:center">peek()</td>
<td style="text-align:center">peekFirst()</td>
</tr>
</tbody>
</table>
<h2 id="queue队列操作">Queue队列操作</h2>
<table>
<thead>
<tr>
<th style="text-align:center"><strong>方法名</strong></th>
<th style="text-align:center"><strong>作用</strong></th>
<th style="text-align:center"><strong>区别</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>add</strong></td>
<td style="text-align:center">增加一个元索</td>
<td style="text-align:center">如果队列已满，则抛出一个IIIegaISlabEepeplian异常</td>
</tr>
<tr>
<td style="text-align:center"><strong>remove</strong></td>
<td style="text-align:center">移除并返回队列头部的元素</td>
<td style="text-align:center">如果队列为空，则抛出一个NoSuchElementException异常</td>
</tr>
<tr>
<td style="text-align:center"><strong>element</strong></td>
<td style="text-align:center">返回队列头部的元素</td>
<td style="text-align:center">如果队列为空，则抛出一个NoSuchElementException异常</td>
</tr>
<tr>
<td style="text-align:center"><strong>offer</strong></td>
<td style="text-align:center">添加一个元素并返回true</td>
<td style="text-align:center">如果队列已满，则返回false</td>
</tr>
<tr>
<td style="text-align:center"><strong>offer</strong></td>
<td style="text-align:center">移除并返问队列头部的元素</td>
<td style="text-align:center">如果队列为空，则返回null</td>
</tr>
<tr>
<td style="text-align:center"><strong>peek</strong></td>
<td style="text-align:center">返回队列头部的元素</td>
<td style="text-align:center">如果队列为空，则返回null</td>
</tr>
<tr>
<td style="text-align:center"><strong>put</strong></td>
<td style="text-align:center">添加一个元素</td>
<td style="text-align:center">如果队列满，则阻塞</td>
</tr>
<tr>
<td style="text-align:center"><strong>take</strong></td>
<td style="text-align:center">移除并返回队列头部的元素</td>
<td style="text-align:center">如果队列为空，则阻塞</td>
</tr>
</tbody>
</table>
<h2 id="hashset-是否无序"><strong>HashSet 是否无序</strong></h2>
<h3 id="一-问题起因"><strong>(一) 问题起因：</strong></h3>
<p>《Core Java Volume I—Fundamentals》中对HashSet的描述是这样的：</p>
<blockquote>
<p>HashSet：一种没有重复元素的无序集合</p>
</blockquote>
<p>解释：我们一般说HashSet是无序的，它既不能保证存储和取出顺序一致，更不能保证自然顺序（a-z）</p>
<p>下面是《Thinking in Java》中的使用Integer对象的HashSet的示例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
  
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SetOfInteger</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">47</span><span class="o">);</span>
          <span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">intset</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;();</span>
          <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">10000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
              <span class="n">intset</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">30</span><span class="o">));</span>
          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">intset</span><span class="o">);</span>
  
      <span class="o">}</span>
  <span class="o">}</span>
<span class="o">/*</span> <span class="n">Output</span><span class="o">:</span>
  <span class="o">[</span><span class="n">15</span><span class="o">,</span> <span class="n">8</span><span class="o">,</span> <span class="n">23</span><span class="o">,</span> <span class="n">16</span><span class="o">,</span> <span class="n">7</span><span class="o">,</span> <span class="n">22</span><span class="o">,</span> <span class="n">9</span><span class="o">,</span> <span class="n">21</span><span class="o">,</span> <span class="n">6</span><span class="o">,</span> <span class="n">1</span> <span class="o">,</span> <span class="n">29</span> <span class="o">,</span> <span class="n">14</span><span class="o">,</span> <span class="n">24</span><span class="o">,</span> <span class="n">4</span><span class="o">,</span> <span class="n">19</span><span class="o">,</span> <span class="n">26</span><span class="o">,</span> <span class="n">11</span><span class="o">,</span> <span class="n">18</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">12</span><span class="o">,</span> <span class="n">27</span><span class="o">,</span> <span class="n">17</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">13</span><span class="o">,</span> <span class="n">28</span><span class="o">,</span> <span class="n">20</span><span class="o">,</span> <span class="n">25</span><span class="o">,</span> <span class="n">10</span><span class="o">,</span> <span class="n">5</span><span class="o">,</span> <span class="n">0</span><span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><p>在0-29之间的10000个随机数被添加到了Set中，大量的数据是重复的，但输出结果却每一个数只有一个实例出现在结果中，并且输出的结果没有任何规律可循。 这正与其<strong>不重复</strong>，且<strong>无序</strong>的特点相吻合。</p>
<p>看来两本书的结果，以及我们之前所学的知识，看起来都是一致的，一切就是这么美好。</p>
<p>随手运行了一下这段书中的代码，结果却让人大吃一惊</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">//JDK1.8下 Idea中运行
</span><span class="c1"></span>  <span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
  
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SetOfInteger</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">47</span><span class="o">);</span>
          <span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">intset</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;();</span>
          <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">10000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
              <span class="n">intset</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">30</span><span class="o">));</span>
          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">intset</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
  
  <span class="c1">//运行结果
</span><span class="c1"></span>  <span class="o">[</span><span class="n">0</span><span class="o">,</span> <span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">4</span><span class="o">,</span> <span class="n">5</span><span class="o">,</span> <span class="n">6</span><span class="o">,</span> <span class="n">7</span><span class="o">,</span> <span class="n">8</span><span class="o">,</span> <span class="n">9</span><span class="o">,</span> <span class="n">10</span><span class="o">,</span> <span class="n">11</span><span class="o">,</span> <span class="n">12</span><span class="o">,</span> <span class="n">13</span><span class="o">,</span> <span class="n">14</span><span class="o">,</span> <span class="n">15</span><span class="o">,</span> <span class="n">16</span><span class="o">,</span> <span class="n">17</span><span class="o">,</span> <span class="n">18</span><span class="o">,</span> <span class="n">19</span><span class="o">,</span> <span class="n">20</span><span class="o">,</span> <span class="n">21</span><span class="o">,</span> <span class="n">22</span><span class="o">,</span> <span class="n">23</span><span class="o">,</span> <span class="n">24</span><span class="o">,</span> <span class="n">25</span><span class="o">,</span> <span class="n">26</span><span class="o">,</span> <span class="n">27</span><span class="o">,</span> <span class="n">28</span><span class="o">,</span> <span class="n">29</span><span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><p>嗯！<strong>不重复</strong>的特点依旧吻合，但是为什么遍历输出结果却是有序的？？？</p>
<p>写一个最简单的程序再验证一下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
  
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashSetDemo</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
  
          <span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">hs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;();</span>
  
          <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
          <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">2</span><span class="o">);</span>
          <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">3</span><span class="o">);</span>
  
          <span class="c1">//增强for遍历
</span><span class="c1"></span>          <span class="k">for</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">s</span> <span class="o">:</span> <span class="n">hs</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">&#34; &#34;</span><span class="o">);</span>
          <span class="o">}</span>
      <span class="o">}</span>
  <span class="o">}</span>
  
  <span class="c1">//运行结果
</span><span class="c1"></span>  <span class="n">1</span> <span class="n">2</span> <span class="n">3</span> 
</code></pre></td></tr></table>
</div>
</div><p>我还不死心，是不是元素数据不够多，有序这只是一种巧合的存在，增加元素数量试试</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
  
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashSetDemo</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
          
          <span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">hs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;();</span>
  
          <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
              <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
          <span class="o">}</span>
  
          <span class="c1">//增强for遍历
</span><span class="c1"></span>          <span class="k">for</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">s</span> <span class="o">:</span> <span class="n">hs</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">&#34; &#34;</span><span class="o">);</span>
          <span class="o">}</span>
      <span class="o">}</span>
  <span class="o">}</span>
  
  <span class="c1">//运行结果
</span><span class="c1"></span>  <span class="n">1</span> <span class="n">2</span> <span class="n">3</span> <span class="o">...</span> <span class="n">9997</span> <span class="n">9998</span> <span class="n">9999</span> 
</code></pre></td></tr></table>
</div>
</div><p>可以看到，遍历后输出依旧是有序的</p>
<h3 id="二-过程"><strong>(二) 过程</strong></h3>
<p>通过一步一步分析源码，我们来看一看，这究竟是怎么一回事，首先我们先从程序的第一步——集合元素的存储开始看起，先看一看HashSet的add方法源码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">// HashSet 源码节选-JKD8
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="n">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">PRESENT</span><span class="o">)==</span><span class="kc">null</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>我们可以看到，HashSet直接调用HashMap的put方法，并且将元素e放到map的key位置（保证了唯一性 ）</p>
<p>顺着线索继续查看HashMap的put方法源码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">//HashMap 源码节选-JDK8
</span><span class="c1"></span>  <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">putVal</span><span class="o">(</span><span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">),</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>而我们的值在返回前需要经过HashMap中的hash方法</p>
<p>接着定位到hash方法的源码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">//HashMap 源码节选-JDK8
</span><span class="c1"></span>  <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">hash</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">h</span><span class="o">;</span>
      <span class="k">return</span> <span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="n">0</span> <span class="o">:</span> <span class="o">(</span><span class="n">h</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">^</span> <span class="o">(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">16</span><span class="o">);</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>hash方法的返回结果中是一句三目运算符，键 (key) 为null即返回 0,存在则返回后一句的内容</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="o">(</span><span class="n">h</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">^</span> <span class="o">(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">16</span><span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>JDK8中 HashMap——hash 方法中的这段代码叫做 “<strong>扰动函数</strong>”</p>
<p>我们来分析一下：</p>
<p>hashCode是Object类中的一个方法，在子类中一般都会重写，而根据我们之前自己给出的程序，暂以Integer类型为例，我们来看一下Integer中hashCode方法的源码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="cm">/**
</span><span class="cm">   * Returns a hash code for this {@code Integer}.
</span><span class="cm">   *
</span><span class="cm">   * @return  a hash code value for this object, equal to the
</span><span class="cm">   *          primitive {@code int} value represented by this
</span><span class="cm">   *          {@code Integer} object.
</span><span class="cm">   */</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
  <span class="o">}</span>
  
  <span class="cm">/**
</span><span class="cm">   * Returns a hash code for a {@code int} value; compatible with
</span><span class="cm">   * {@code Integer.hashCode()}.
</span><span class="cm">   *
</span><span class="cm">   * @param value the value to hash
</span><span class="cm">   * @since 1.8
</span><span class="cm">   *
</span><span class="cm">   * @return a hash code value for a {@code int} value.
</span><span class="cm">   */</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Integer中hashCode方法的返回值就是这个数本身</p>
<p>注：整数的值因为与整数本身一样唯一，所以它是一个足够好的散列</p>
<p>所以，下面的A、B两个式子就是等价的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">//注：key为 hash(Object key)参数
</span><span class="c1"></span>  
  <span class="n">A</span><span class="err">：</span><span class="o">(</span><span class="n">h</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">^</span> <span class="o">(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">16</span><span class="o">)</span>
  
  <span class="n">B</span><span class="err">：</span><span class="n">key</span> <span class="o">^</span> <span class="o">(</span><span class="n">key</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">16</span><span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>分析到这一步，我们的式子只剩下位运算了，先不急着算什么，我们先理清思路</p>
<p>HashSet因为底层使用<strong>哈希表</strong>（<strong>链表结合数组</strong>）实现，存储时key通过一些运算后得出自己在数组中所处的位置。</p>
<p>我们在hashCoe方法中返回到了一个等同于本身值的散列值，但是考虑到int类型数据的范围：-2147483648~2147483647 ，着很显然，这些散列值不能直接使用，因为内存是没有办法放得下，一个40亿长度的数组的。所以它使用了对数组长度进行<strong>取模运算</strong>，得余后再作为其数组下标，<strong>indexFor</strong>() ——JDK7中，就这样出现了，在JDK8中 <strong>indexFor</strong>()就消失了，而全部使用下面的语句代替，原理是一样的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">//JDK8中
</span><span class="c1"></span>  <span class="o">(</span><span class="n">tab</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="n">1</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">hash</span><span class="err">；</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">//JDK7中
</span><span class="c1"></span>  <span class="n">bucketIndex</span> <span class="o">=</span> <span class="n">indexFor</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">table</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
  
  <span class="kd">static</span> <span class="kt">int</span> <span class="nf">indexFor</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">h</span> <span class="o">&amp;</span> <span class="o">(</span><span class="n">length</span> <span class="o">-</span> <span class="n">1</span><span class="o">);</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>提一句，为什么取模运算时我们用 &amp; 而不用 % 呢，因为位运算直接对内存数据进行操作，不需要转成十进制，因此处理速度非常快，这样就导致位运算 &amp; 效率要比取模运算 % 高很多。</p>
<p>看到这里我们就知道了，存储时key需要通过<strong>hash方法</strong>和<strong>indexFor</strong>()运算，来确定自己的对应下标</p>
<p>(取模运算，应以JDK8为准，但为了称呼方便，还是按照JDK7的叫法来说，下面的例子均为此，特此提前声明)</p>
<p>但是先直接看与运算(&amp;)，好像又出现了一些问题，我们举个例子：</p>
<p>HashMap中初始长度为16，length - 1 = 15；其二进制表示为 00000000 00000000 00000000 00001111</p>
<p>而与运算计算方式为：遇0则0，我们随便举一个key值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">          <span class="n">1111</span> <span class="n">1111</span> <span class="n">1010</span> <span class="n">0101</span> <span class="n">1111</span> <span class="n">0000</span> <span class="n">0011</span> <span class="n">1100</span>
  <span class="o">&amp;</span>       <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">1111</span>
  <span class="o">----------------------------------------------------</span>
          <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">1100</span>
</code></pre></td></tr></table>
</div>
</div><p>我们将这32位从中分开，左边16位称作高位，右边16位称作低位，可以看到经过&amp;运算后 结果就是高位全部归0，剩下了低位的最后四位。但是问题就来了，我们按照当前初始长度为默认的16，HashCode值为下图两个，可以看到，在不经过扰动计算时，只进行与(&amp;)运算后 Index值均为 12 这也就导致了哈希冲突</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./18.jpg"
        data-srcset="./18.jpg, ./18.jpg 1.5x, ./18.jpg 2x"
        data-sizes="auto"
        alt="./18.jpg"
        title="18" /></p>
<blockquote>
<p>哈希冲突的简单理解：计划把一个对象插入到散列表(哈希表)中，但是发现这个位置已经被别的对象所占据了</p>
</blockquote>
<p>例子中，两个不同的HashCode值却经过运算后，得到了相同的值，也就代表，他们都需要被放在下标为2的位置</p>
<p>一般来说，如果数据分布比较广泛，而且存储数据的数组长度比较大，那么哈希冲突就会比较少，否则很高。</p>
<p>但是，如果像上例中只取最后几位的时候，这可不是什么好事，即使我的数据分布很散乱，但是哈希冲突仍然会很严重。</p>
<p>别忘了，我们的扰动函数还在前面搁着呢，这个时候它就要发挥强大的作用了,还是使用上面两个发生了哈希冲突的数据，这一次我们加入扰动函数再进行与(&amp;)运算</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./19.jpg"
        data-srcset="./19.jpg, ./19.jpg 1.5x, ./19.jpg 2x"
        data-sizes="auto"
        alt="./19.jpg"
        title="19" /></p>
<blockquote>
<p>补充 ：<code>&gt;&gt;&gt;</code> 按位右移补零操作符，左操作数的值按右操作数指定的为主右移，移动得到的空位以零填充 
​	     ^     位异或运算，相同则0，不同则1</p>
</blockquote>
<p>可以看到，本发生了哈希冲突的两组数据，经过扰动函数处理后，数值变得不再一样了，也就避免了冲突</p>
<p>其实在<strong>扰动函数</strong>中，将<strong>数据右位移16位</strong>，哈希码的<strong>高位和低位混合</strong>了起来，这也正解决了前面所讲 高位归0，计算只依赖低位最后几位的情况,  这使得高位的一些特征也<strong>对低位产生了影响</strong>，使得<strong>低位的随机性加强</strong>，能更好的<strong>避免冲突</strong></p>
<p>到这里，我们一步步研究到了这一些知识</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="n">HashSet</span> <span class="nf">add</span><span class="o">()</span> <span class="err">→</span> <span class="n">HashMap</span> <span class="nf">put</span><span class="o">()</span> <span class="err">→</span> <span class="n">HashMap</span> <span class="nf">hash</span><span class="o">()</span> <span class="err">→</span> <span class="n">HashMap</span> <span class="o">(</span><span class="n">tab</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="n">1</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">hash</span><span class="err">；</span>
</code></pre></td></tr></table>
</div>
</div><p>有了这些知识的铺垫，我对于刚开始自己举的例子又产生了一些疑惑,我使用for循环添加一些整型元素进入集合，难道就没有任何一个发生哈希冲突吗，为什么遍历结果是有序输出的，经过简单计算 2 和18这两个值就都是2</p>
<p>(这个疑惑是有问题的，后面解释了错在了哪里)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">//key = 2,(length -1) = 15
</span><span class="c1"></span>  
  <span class="n">h</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()</span>      <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0010</span> 
  <span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">16</span>                <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span>
  <span class="n">hash</span> <span class="o">=</span> <span class="n">h</span><span class="o">^(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">16</span><span class="o">)</span>     <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="nf">0010</span>
  <span class="o">(</span><span class="n">tab</span><span class="o">.</span><span class="na">length</span><span class="o">-</span><span class="n">1</span><span class="o">)&amp;</span><span class="n">hash</span>     <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">1111</span>
                          <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0010</span>  
  <span class="o">-------------------------------------------------------------</span>
                          <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0010</span>
  
  <span class="c1">//2的十进制结果：2
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">//key = 18,(length -1) = 15
</span><span class="c1"></span>  
  <span class="n">h</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()</span>      <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0001</span> <span class="n">0010</span> 
  <span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">16</span>                <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span>
  <span class="n">hash</span> <span class="o">=</span> <span class="n">h</span><span class="o">^(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">16</span><span class="o">)</span>     <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0001</span> <span class="nf">0010</span>
  <span class="o">(</span><span class="n">tab</span><span class="o">.</span><span class="na">length</span><span class="o">-</span><span class="n">1</span><span class="o">)&amp;</span><span class="n">hash</span>     <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">1111</span>
                          <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0010</span>  
  <span class="o">-------------------------------------------------------------</span>
                          <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0010</span>
  
  <span class="c1">//18的十进制结果：2
</span></code></pre></td></tr></table>
</div>
</div><p>按照我们上面的知识，按理应该输出 1 2 18 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 但却仍有序输出了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
  
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashSetDemo</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
  
          <span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">hs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;();</span>
  
          <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">19</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
              <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
          <span class="o">}</span>
  
          <span class="c1">//增强for遍历
</span><span class="c1"></span>          <span class="k">for</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">s</span> <span class="o">:</span> <span class="n">hs</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">&#34; &#34;</span><span class="o">);</span>
          <span class="o">}</span>
      <span class="o">}</span>
  <span class="o">}</span>
  
  <span class="c1">//运行结果：
</span><span class="c1"></span>  <span class="n">0</span> <span class="n">1</span> <span class="n">2</span> <span class="n">3</span> <span class="n">4</span> <span class="n">5</span> <span class="n">6</span> <span class="n">7</span> <span class="n">8</span> <span class="n">9</span> <span class="n">10</span> <span class="n">11</span> <span class="n">12</span> <span class="n">13</span> <span class="n">14</span> <span class="n">15</span> <span class="n">16</span> <span class="n">17</span> <span class="n">18</span> 
</code></pre></td></tr></table>
</div>
</div><p>再试一试</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
  
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashSetDemo</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
  
          <span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">hs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;();</span>
          
          <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">0</span><span class="o">)</span>
          <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
          <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">18</span><span class="o">);</span>
          <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">2</span><span class="o">);</span>
          <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">3</span><span class="o">);</span>
          <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">4</span><span class="o">);</span>
          <span class="o">......</span>
          <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">17</span><span class="o">)</span>
  
          <span class="c1">//增强for遍历
</span><span class="c1"></span>          <span class="k">for</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">s</span> <span class="o">:</span> <span class="n">hs</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">&#34; &#34;</span><span class="o">);</span>
          <span class="o">}</span>
      <span class="o">}</span>
  <span class="o">}</span>
  
  <span class="c1">//运行结果：
</span><span class="c1"></span>  <span class="n">0</span> <span class="n">1</span> <span class="n">2</span> <span class="n">3</span> <span class="n">4</span> <span class="n">5</span> <span class="n">6</span> <span class="n">7</span> <span class="n">8</span> <span class="n">9</span> <span class="n">10</span> <span class="n">11</span> <span class="n">12</span> <span class="n">13</span> <span class="n">14</span> <span class="n">15</span> <span class="n">16</span> <span class="n">17</span> <span class="n">18</span>
</code></pre></td></tr></table>
</div>
</div><p>真让人头大，不死心再试一试，由与偷懒，就只添加了几个，就是这个偷懒，让我发现了新大陆！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
  
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashSetDemo</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
  
          <span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">hs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;();</span>
  
          <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
          <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">18</span><span class="o">);</span>
          <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">2</span><span class="o">);</span>
          <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">3</span><span class="o">);</span>
          <span class="n">hs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">4</span><span class="o">);</span>
  
          <span class="c1">//增强for遍历
</span><span class="c1"></span>          <span class="k">for</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">s</span> <span class="o">:</span> <span class="n">hs</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">&#34; &#34;</span><span class="o">);</span>
          <span class="o">}</span>
      <span class="o">}</span>
  <span class="o">}</span>
  
  <span class="c1">//运行结果：
</span><span class="c1"></span>  <span class="n">1</span> <span class="n">18</span> <span class="n">2</span> <span class="n">3</span> <span class="n">4</span>
</code></pre></td></tr></table>
</div>
</div><p>这一段程序按照我们认为应该出现的顺序出现了！！！</p>
<p>突然恍然大悟，我忽略了最重要的一个问题，也就是数组长度问题</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">//HashMap 源码节选-JDK8
</span><span class="c1"></span>  <span class="cm">/**
</span><span class="cm">  * The default initial capacity - MUST be a power of two.
</span><span class="cm">  */</span>
  <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">DEFAULT_INITIAL_CAPACITY</span> <span class="o">=</span> <span class="n">1</span> <span class="o">&lt;&lt;</span> <span class="n">4</span><span class="o">;</span> <span class="c1">// aka 16
</span><span class="c1"></span>  
  <span class="cm">/**
</span><span class="cm">  * The load factor used when none specified in constructor.
</span><span class="cm">  */</span>
  <span class="kd">static</span> <span class="kd">final</span> <span class="kt">float</span> <span class="n">DEFAULT_LOAD_FACTOR</span> <span class="o">=</span> <span class="n">0</span><span class="o">.</span><span class="na">75f</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>&laquo; ：按位左移运算符，做操作数按位左移右错作数指定的位数，即左边最高位丢弃，右边补齐0，计算的简便方法就是：把 &laquo; 左面的数据乘以2的移动次幂 
为什么初始长度为16：1 &laquo; 4 即 1 * 2 ^4 =16;</p>
</blockquote>
<p>我们还观察到一个叫做加载因子的东西，他默认值为0.75f，这是什么意思呢，我们来补充一点它的知识：</p>
<blockquote>
<p>加载因子就是表示哈希表中元素填满的程度，当表中元素过多，超过加载因子的值时，哈希表会自动扩容，一般是一倍，这种行为可以称作rehashing(再哈希)。
加载因子的值设置的越大，添加的元素就会越多，确实空间利用率的到了很大的提升，但是毫无疑问，就面临着哈希冲突的可能性增大，反之，空间利用率造成了浪费，但哈希冲突也减少了，所以我们希望在空间利用率与哈希冲突之间找到一种我们所能接受的平衡，经过一些试验，定在了0.75f</p>
</blockquote>
<p>现在可以解决我们上面的疑惑了</p>
<p>数组初始的实际长度 = 16 * 0.75 = 12</p>
<p>这代表当我们元素数量增加到12以上时就会发生扩容，当我们上例中for循环添加0-18， 这19个元素时，先保存到前12个到第十三个元素时，超过加载因子，导致数组发生了一次扩容，而扩容以后对应与(&amp;)运算的(tab.length-1)就发生了变化,从16-1 变成了 32-1 即31</p>
<p>我们来算一下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">//key = 2,(length -1) = 31
</span><span class="c1"></span>  
  <span class="n">h</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()</span>      <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0001</span> <span class="n">0010</span> 
  <span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">16</span>                <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span>
  <span class="n">hash</span> <span class="o">=</span> <span class="n">h</span><span class="o">^(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">16</span><span class="o">)</span>     <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0001</span> <span class="nf">0010</span>
  <span class="o">(</span><span class="n">tab</span><span class="o">.</span><span class="na">length</span><span class="o">-</span><span class="n">1</span><span class="o">)&amp;</span><span class="n">hash</span>     <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0011</span> <span class="n">1111</span> 
                          <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0010</span>      
  <span class="o">-------------------------------------------------------------</span>
                          <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0010</span>
  
  <span class="c1">//十进制结果：2
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">  <span class="c1">//key = 18,(length -1) = 31
</span><span class="c1"></span>  
  <span class="n">h</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()</span>      <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0001</span> <span class="n">0010</span> 
  <span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">16</span>                <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span>
  <span class="n">hash</span> <span class="o">=</span> <span class="n">h</span><span class="o">^(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">16</span><span class="o">)</span>     <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0001</span> <span class="nf">0010</span>
  <span class="o">(</span><span class="n">tab</span><span class="o">.</span><span class="na">length</span><span class="o">-</span><span class="n">1</span><span class="o">)&amp;</span><span class="n">hash</span>     <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0011</span> <span class="n">1111</span> 
                          <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0010</span>      
  <span class="o">-------------------------------------------------------------</span>
                          <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">0001</span> <span class="n">0010</span>
  
  <span class="c1">//十进制结果：18
</span></code></pre></td></tr></table>
</div>
</div><p>当length -  1 的值发生改变的时候，18的值也变成了本身。</p>
<p>到这里，才意识到自己之前用2和18计算时 均使用了 length -1 的值为 15是错误的，当时并不清楚加载因子及它的扩容机制，这才是导致提出有问题疑惑的根本原因。</p>
<h3 id="三-总结"><strong>(三) 总结</strong></h3>
<p>JDK7到JDK8，其内部发生了一些变化，导致在不同版本JDK下运行结果不同，根据上面的分析，我们从HashSet追溯到HashMap的hash算法、加载因子和默认长度。</p>
<p>由于我们所创建的HashSet是Integer类型的，这也是最巧的一点，Integer类型hashCode()的返回值就是其int值本身，而存储的时候元素通过一些运算后会得出自己在数组中所处的位置。由于在这一步，其本身即下标(只考虑这一步)，其实已经实现了排序功能，由于int类型范围太广，内存放不下，所以对其进行取模运算，为了减少哈希冲突，又在取模前进行了，扰动函数的计算，得到的数作为元素下标，按照JDK8下的hash算法，以及load factor及扩容机制，这就导致数据在经过 HashMap.hash()运算后仍然是自己本身的值，且没有发生哈希冲突。</p>
<p><strong>补充</strong>：对于有序无序的理解</p>
<p>集合所说的序，是指元素存入集合的顺序，当元素存储顺序和取出顺序一致时就是有序，否则就是无序。</p>
<p>并不是说存储数据的时候无序，没有规则，当我们不论使用for循环随机数添加元素的时候，还是for循环有序添加元素的时候，最后遍历输出的结果均为按照值的大小排序输出，随机添加元素，但结果仍有序输出，这就对照着上面那句，存储顺序和取出顺序是不一致的，所以我们说HashSet是无序的，虽然我们按照123的顺序添加元素，结果虽然仍为123，但这只是一种巧合而已。</p>
<p>所以HashSet只是<strong>不保证有序</strong>，并<strong>不是保证无序</strong></p>
<h2 id="java中list-integer-int的相互转换">Java中List, Integer[], int[]的相互转换</h2>
<p>相信新手们在学习Java的过程中都会遇到和我一样的问题：想要把List和int[]相互转换太麻烦了。</p>
<p>List和String[]也同理。难道每次非得写一个循环<a href="https://so.csdn.net/so/search?q=%e9%81%8d%e5%8e%86&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">遍历</a>吗？其实一步就可以搞定。</p>
<p>本文涉及到一些Java8的特性。如果没有接触过就先学会怎么用，然后再细细研究。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="o">{</span><span class="n">4</span><span class="o">,</span> <span class="n">5</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">6</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">5</span><span class="o">,</span> <span class="n">1</span><span class="o">};</span>
 
        <span class="c1">// int[] 转 List&lt;Integer&gt;
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list1</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">data</span><span class="o">).</span><span class="na">boxed</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
        <span class="c1">// Arrays.stream(arr) 可以替换成IntStream.of(arr)。
</span><span class="c1"></span>        <span class="c1">// 1.使用Arrays.stream将int[]转换成IntStream。
</span><span class="c1"></span>        <span class="c1">// 2.使用IntStream中的boxed()装箱。将IntStream转换成Stream&lt;Integer&gt;。
</span><span class="c1"></span>        <span class="c1">// 3.使用Stream的collect()，将Stream&lt;T&gt;转换成List&lt;T&gt;，因此正是List&lt;Integer&gt;。
</span><span class="c1"></span> 
        <span class="c1">// int[] 转 Integer[]
</span><span class="c1"></span>        <span class="n">Integer</span><span class="o">[]</span> <span class="n">integers1</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">data</span><span class="o">).</span><span class="na">boxed</span><span class="o">().</span><span class="na">toArray</span><span class="o">(</span><span class="n">Integer</span><span class="o">[]::</span><span class="k">new</span><span class="o">);</span>
        <span class="c1">// 前两步同上，此时是Stream&lt;Integer&gt;。
</span><span class="c1"></span>        <span class="c1">// 然后使用Stream的toArray，传入IntFunction&lt;A[]&gt; generator。
</span><span class="c1"></span>        <span class="c1">// 这样就可以返回Integer数组。
</span><span class="c1"></span>        <span class="c1">// 不然默认是Object[]。
</span><span class="c1"></span> 
        <span class="c1">// List&lt;Integer&gt; 转 Integer[]
</span><span class="c1"></span>        <span class="n">Integer</span><span class="o">[]</span> <span class="n">integers2</span> <span class="o">=</span> <span class="n">list1</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="n">Integer</span><span class="o">[</span><span class="n">0</span><span class="o">]);</span>
        <span class="c1">//  调用toArray。传入参数T[] a。这种用法是目前推荐的。
</span><span class="c1"></span>        <span class="c1">// List&lt;String&gt;转String[]也同理。
</span><span class="c1"></span> 
        <span class="c1">// List&lt;Integer&gt; 转 int[]
</span><span class="c1"></span>        <span class="kt">int</span><span class="o">[]</span> <span class="n">arr1</span> <span class="o">=</span> <span class="n">list1</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">mapToInt</span><span class="o">(</span><span class="n">Integer</span><span class="o">::</span><span class="n">valueOf</span><span class="o">).</span><span class="na">toArray</span><span class="o">();</span>
        <span class="c1">// 想要转换成int[]类型，就得先转成IntStream。
</span><span class="c1"></span>        <span class="c1">// 这里就通过mapToInt()把Stream&lt;Integer&gt;调用Integer::valueOf来转成IntStream
</span><span class="c1"></span>        <span class="c1">// 而IntStream中默认toArray()转成int[]。
</span><span class="c1"></span> 
        <span class="c1">// Integer[] 转 int[]
</span><span class="c1"></span>        <span class="kt">int</span><span class="o">[]</span> <span class="n">arr2</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">integers1</span><span class="o">).</span><span class="na">mapToInt</span><span class="o">(</span><span class="n">Integer</span><span class="o">::</span><span class="n">valueOf</span><span class="o">).</span><span class="na">toArray</span><span class="o">();</span>
        <span class="c1">// 思路同上。先将Integer[]转成Stream&lt;Integer&gt;，再转成IntStream。
</span><span class="c1"></span> 
        <span class="c1">// Integer[] 转 List&lt;Integer&gt;
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list2</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">integers1</span><span class="o">);</span>
        <span class="c1">// 最简单的方式。String[]转List&lt;String&gt;也同理。
</span><span class="c1"></span> 
        <span class="c1">// 同理
</span><span class="c1"></span>        <span class="n">String</span><span class="o">[]</span> <span class="n">strings1</span> <span class="o">=</span> <span class="o">{</span><span class="s">&#34;a&#34;</span><span class="o">,</span> <span class="s">&#34;b&#34;</span><span class="o">,</span> <span class="s">&#34;c&#34;</span><span class="o">};</span>
        <span class="c1">// String[] 转 List&lt;String&gt;
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list3</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">strings1</span><span class="o">);</span>
        <span class="c1">// List&lt;String&gt; 转 String[]
</span><span class="c1"></span>        <span class="n">String</span><span class="o">[]</span> <span class="n">strings2</span> <span class="o">=</span> <span class="n">list3</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">0</span><span class="o">]);</span>
 
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>由此可见，流操作还是很方便的。我对这些知识的掌握也不深，就不误人子弟了，只是给刚接触的人提供一个思考的方向。</p>
<h2 id="数组操作">数组操作</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">说明：ArrayUtils工具类在标准的应用程序中是不可以被实例化的：
参考：<span class="o">[</span>参考地址<span class="o">](</span>http://commons.apache.org/proper/commons-lang/javadocs/api-release/<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="fill">fill</h3>
<p>数组的初始化填充</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span><span class="o">[]</span> <span class="n">iL</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">100</span><span class="o">];</span>
<span class="c1">//将数组填充为100个-1
</span><span class="c1"></span><span class="n">Arrays</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">iL</span><span class="o">,-</span><span class="n">1</span><span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="arrayutils">ArrayUtils</h3>
<p>数组工具ArrayUtils 拥有以下方法:</p>
<p><strong>toString</strong></p>
<p>将一个数组转换成String,用于打印数组</p>
<p><strong>isEquals</strong></p>
<p>判断两个数组是否相等,采用EqualsBuilder进行判断</p>
<p><strong>toMap</strong></p>
<p>将一个数组转换成Map,如果数组里是Entry则其Key与Value就是新Map的Key和Value,如果是Object[]则Object[0]为KeyObject[1]为Value</p>
<p><strong>clone</strong></p>
<p>拷贝数组</p>
<p><strong>subarray</strong></p>
<p>截取子数组</p>
<p><strong>isSameLength</strong></p>
<p>判断两个数组长度是否相等</p>
<p><strong>getLength</strong></p>
<p>获得数组的长度</p>
<p><strong>isSameType</strong></p>
<p>判段两个数组的类型是否相同</p>
<p><strong>reverse</strong></p>
<p>数组反转</p>
<p><strong>indexOf</strong></p>
<p>查询某个Object在数组中的位置,可以指定起始搜索位置</p>
<p><strong>lastIndexOf</strong></p>
<p>反向查询某个Object在数组中的位置,可以指定起始搜索位置</p>
<p><strong>contains</strong></p>
<p>查询某个Object是否在数组中</p>
<p><strong>toObject</strong></p>
<p>将基本数据类型转换成外包型数据</p>
<p><strong>isEmpty</strong></p>
<p>判断数组是否为空(null和length=0的时候都为空)</p>
<p><strong>addAll</strong></p>
<p>合并两个数组</p>
<p><strong>add</strong></p>
<p>添加一个数据到数组</p>
<p><strong>remove</strong></p>
<p>删除数组中某个位置上的数据</p>
<p><strong>removeElement</strong></p>
<p>删除数组中某个对象(从正序开始搜索,删除第一个)</p>
<p><strong>eg</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.apache.commons.lang3.ArrayUtils</span>
<span class="c1">// 1.打印数组
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">4</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span> <span class="o">});</span><span class="c1">// {1,4,2,3}
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="k">new</span> <span class="n">Integer</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">4</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span> <span class="o">});</span><span class="c1">// {1,4,2,3}
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&#34;I&#39;m nothing!&#34;</span><span class="o">);</span><span class="c1">// I&#39;m nothing!
</span><span class="c1"></span>
<span class="c1">// 2.判断两个数组是否相等,采用EqualsBuilder进行判断
</span><span class="c1">// 只有当两个数组的数据类型,长度,数值顺序都相同的时候,该方法才会返回True
</span><span class="c1">// 2.1 两个数组完全相同
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">isEquals</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span> <span class="o">},</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span> <span class="o">});</span><span class="c1">// true
</span><span class="c1">// 2.2 数据类型以及长度相同,但各个Index上的数据不是一一对应
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">isEquals</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">2</span> <span class="o">},</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span> <span class="o">});</span><span class="c1">// true
</span><span class="c1">// 2.3 数组的长度不一致
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">isEquals</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">3</span> <span class="o">},</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span> <span class="o">});</span><span class="c1">// false
</span><span class="c1">// 2.4 不同的数据类型
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">isEquals</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span> <span class="o">},</span> <span class="k">new</span> <span class="kt">long</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span> <span class="o">});</span><span class="c1">// false
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">isEquals</span><span class="o">(</span><span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span> <span class="o">},</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span> <span class="o">});</span><span class="c1">// false
</span><span class="c1">// 2.5 Null处理,如果输入的两个数组都为null时候则返回true
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">isEquals</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span> <span class="o">},</span> <span class="kc">null</span><span class="o">);</span><span class="c1">// false
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">isEquals</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span><span class="c1">// true
</span><span class="c1"></span>
<span class="c1">// 3.将一个数组转换成Map
</span><span class="c1">// 如果数组里是Entry则其Key与Value就是新Map的Key和Value,如果是Object[]则Object[0]为KeyObject[1]为Value
</span><span class="c1">// 对于Object[]数组里的元素必须是instanceof Object[]或者Entry,即不支持基本数据类型数组
</span><span class="c1">// 如:ArrayUtils.toMap(new Object[]{new int[]{1,2},new int[]{3,4}})会出异常
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">2</span> <span class="o">},</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="n">3</span><span class="o">,</span> <span class="n">4</span> <span class="o">}</span> <span class="o">});</span><span class="c1">// {1=2,
</span><span class="c1">// 3=4}
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="k">new</span> <span class="n">Integer</span><span class="o">[][]</span> <span class="o">{</span> <span class="k">new</span> <span class="n">Integer</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">2</span> <span class="o">},</span> <span class="k">new</span> <span class="n">Integer</span><span class="o">[]</span> <span class="o">{</span> <span class="n">3</span><span class="o">,</span> <span class="n">4</span> <span class="o">}</span> <span class="o">});</span><span class="c1">// {1=2,
</span><span class="c1">// 3=4}
</span><span class="c1"></span>
<span class="c1">// 4.拷贝数组
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">clone</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">3</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">4</span> <span class="o">});</span><span class="c1">// {3,2,4}
</span><span class="c1"></span>
<span class="c1">// 5.截取数组
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">subarray</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">3</span><span class="o">,</span> <span class="n">4</span><span class="o">,</span> <span class="n">1</span><span class="o">,</span> <span class="n">5</span><span class="o">,</span> <span class="n">6</span> <span class="o">},</span> <span class="n">2</span><span class="o">,</span> <span class="n">4</span><span class="o">);</span><span class="c1">// {1,5}
</span><span class="c1">// 起始index为2(即第三个数据)结束index为4的数组
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">subarray</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">3</span><span class="o">,</span> <span class="n">4</span><span class="o">,</span> <span class="n">1</span><span class="o">,</span> <span class="n">5</span><span class="o">,</span> <span class="n">6</span> <span class="o">},</span> <span class="n">2</span><span class="o">,</span> <span class="n">10</span><span class="o">);</span><span class="c1">// {1,5,6}
</span><span class="c1">// 如果endIndex大于数组的长度,则取beginIndex之后的所有数据
</span><span class="c1"></span>
<span class="c1">// 6.判断两个数组的长度是否相等
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">isSameLength</span><span class="o">(</span><span class="k">new</span> <span class="n">Integer</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">5</span> <span class="o">},</span> <span class="k">new</span> <span class="n">Long</span><span class="o">[]</span> <span class="o">{</span> <span class="n">2L</span><span class="o">,</span> <span class="n">8L</span><span class="o">,</span> <span class="n">10L</span> <span class="o">});</span><span class="c1">// true
</span><span class="c1"></span>
<span class="c1">// 7.获得数组的长度
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">getLength</span><span class="o">(</span><span class="k">new</span> <span class="kt">long</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">23</span><span class="o">,</span> <span class="n">3</span> <span class="o">});</span><span class="c1">// 3
</span><span class="c1"></span>
<span class="c1">// 8.判段两个数组的类型是否相同
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">isSameType</span><span class="o">(</span><span class="k">new</span> <span class="kt">long</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">3</span> <span class="o">},</span> <span class="k">new</span> <span class="kt">long</span><span class="o">[]</span> <span class="o">{</span> <span class="n">8</span><span class="o">,</span> <span class="n">5</span><span class="o">,</span> <span class="n">6</span> <span class="o">});</span><span class="c1">// true
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">isSameType</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">3</span> <span class="o">},</span> <span class="k">new</span> <span class="kt">long</span><span class="o">[]</span> <span class="o">{</span> <span class="n">8</span><span class="o">,</span> <span class="n">5</span><span class="o">,</span> <span class="n">6</span> <span class="o">});</span><span class="c1">// false
</span><span class="c1"></span>
<span class="c1">// 9.数组反转
</span><span class="c1"></span><span class="kt">int</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">5</span> <span class="o">};</span>
<span class="n">ArrayUtils</span><span class="o">.</span><span class="na">reverse</span><span class="o">(</span><span class="n">array</span><span class="o">);</span><span class="c1">// {5,2,1}
</span><span class="c1"></span>
<span class="c1">// 10.查询某个Object在数组中的位置,可以指定起始搜索位置,找不到返回-1
</span><span class="c1">// 10.1 从正序开始搜索,搜到就返回当前的index否则返回-1
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">6</span> <span class="o">},</span> <span class="n">6</span><span class="o">);</span><span class="c1">// 2
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">6</span> <span class="o">},</span> <span class="n">2</span><span class="o">);</span><span class="c1">// -1
</span><span class="c1">// 10.2 从逆序开始搜索,搜到就返回当前的index否则返回-1
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">lastIndexOf</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">6</span> <span class="o">},</span> <span class="n">6</span><span class="o">);</span><span class="c1">// 2
</span><span class="c1"></span>
<span class="c1">// 11.查询某个Object是否在数组中
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">3</span><span class="o">,</span> <span class="n">1</span><span class="o">,</span> <span class="n">2</span> <span class="o">},</span> <span class="n">1</span><span class="o">);</span><span class="c1">// true
</span><span class="c1">// 对于Object数据是调用该Object.equals方法进行判断
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="n">3</span><span class="o">,</span> <span class="n">1</span><span class="o">,</span> <span class="n">2</span> <span class="o">},</span> <span class="n">1L</span><span class="o">);</span><span class="c1">// false
</span><span class="c1"></span>
<span class="c1">// 12.基本数据类型数组与外包型数据类型数组互转
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">toObject</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">2</span> <span class="o">});</span><span class="c1">// new Integer[]{Integer,Integer}
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">toPrimitive</span><span class="o">(</span><span class="k">new</span> <span class="n">Integer</span><span class="o">[]</span> <span class="o">{</span> <span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="n">1</span><span class="o">),</span> <span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="n">2</span><span class="o">)</span> <span class="o">});</span><span class="c1">// new int[]{1,2}
</span><span class="c1"></span>
<span class="c1">// 13.判断数组是否为空(null和length=0的时候都为空)
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">0</span><span class="o">]);</span><span class="c1">// true
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="kc">null</span> <span class="o">});</span><span class="c1">// false
</span><span class="c1"></span>
<span class="c1">// 14.合并两个数组
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">5</span> <span class="o">},</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">2</span><span class="o">,</span> <span class="n">4</span> <span class="o">});</span><span class="c1">// {1,3,5,2,4}
</span><span class="c1"></span>
<span class="c1">// 15.添加一个数据到数组
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="sc">&#39;0&#39;</span><span class="o">)</span>       <span class="c1">//= [&#39;0&#39;]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">([</span><span class="sc">&#39;1&#39;</span><span class="o">],</span> <span class="sc">&#39;0&#39;</span><span class="o">)</span>      <span class="c1">//= [&#39;1&#39;, &#39;0&#39;]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">([</span><span class="sc">&#39;1&#39;</span><span class="o">,</span> <span class="sc">&#39;0&#39;</span><span class="o">],</span> <span class="sc">&#39;1&#39;</span><span class="o">)</span> <span class="c1">//= [&#39;1&#39;, &#39;0&#39;, &#39;1&#39;]
</span><span class="c1">//说明：在给定的数组副本中加入传入的数组和给定的元素，如果给定的数组是null，那么会返回一个包含给定元素的数组；
</span><span class="c1">//参数：array-要被复制的数组；element-在新数组中的最后一个索引处添加的元素；
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">char</span><span class="o">[]</span> <span class="nf">add</span><span class="o">(</span><span class="kt">char</span><span class="o">[]</span> <span class="n">array</span><span class="o">,</span> <span class="kt">char</span> <span class="n">element</span><span class="o">)</span>

<span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">0</span><span class="o">)</span>   <span class="c1">//= [0]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">([</span><span class="n">1</span><span class="o">],</span> <span class="n">0</span><span class="o">)</span>    <span class="c1">//= [1, 0]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">([</span><span class="n">1</span><span class="o">,</span> <span class="n">0</span><span class="o">],</span> <span class="n">1</span><span class="o">)</span> <span class="c1">//= [1, 0, 1]
</span><span class="c1">//说明：在给定的数组副本中加入传入的数组和给定的元素，如果给定的数组是null，那么会返回一个包含给定元素的数组；
</span><span class="c1">//参数：array-要被复制的数组；element-在新数组中的最后一个索引处添加的元素；
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">double</span><span class="o">[]</span> <span class="nf">add</span><span class="o">(</span><span class="kt">double</span><span class="o">[]</span> <span class="n">array</span><span class="o">,</span> <span class="kt">double</span> <span class="n">element</span><span class="o">)</span>

<span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">0</span><span class="o">)</span>   <span class="c1">//= [0]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">([</span><span class="n">1</span><span class="o">],</span> <span class="n">0</span><span class="o">)</span>    <span class="c1">//= [1, 0]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">([</span><span class="n">1</span><span class="o">,</span> <span class="n">0</span><span class="o">],</span> <span class="n">1</span><span class="o">)</span> <span class="c1">//= [1, 0, 1]
</span><span class="c1">//说明：在给定的数组副本中加入传入的数组和给定的元素，如果给定的数组是null，那么会返回一个包含给定元素的数组；
</span><span class="c1">//参数：array-要被复制的数组；element-在新数组中的最后一个索引处添加的元素；
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">float</span><span class="o">[]</span> <span class="nf">add</span><span class="o">(</span><span class="kt">float</span><span class="o">[]</span> <span class="n">array</span><span class="o">,</span> <span class="kt">float</span> <span class="n">element</span><span class="o">)</span>

<span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">5</span> <span class="o">},</span> <span class="n">4</span><span class="o">);</span><span class="c1">// {1,3,5,4}
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">0</span><span class="o">)</span>                  <span class="c1">//= [0]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">([</span><span class="n">1</span><span class="o">],</span> <span class="n">0</span><span class="o">)</span>                   <span class="c1">//= [1, 0]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">([</span><span class="n">1</span><span class="o">,</span> <span class="n">0</span><span class="o">],</span> <span class="n">1</span><span class="o">)</span>                <span class="c1">//= [1, 0, 1]
</span><span class="c1">//说明：在给定的数组副本中加入传入的数组和给定的元素，如果给定的数组是null，那么会返回一个包含给定元素的数组；
</span><span class="c1">//参数：array-要被复制的数组；element-在新数组中的最后一个索引处添加的元素；
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span><span class="o">[]</span> <span class="nf">add</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">array</span><span class="o">,</span> <span class="kt">int</span> <span class="n">element</span><span class="o">)</span>

<span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">0</span><span class="o">)</span>   <span class="c1">//= [0]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">([</span><span class="n">1</span><span class="o">],</span> <span class="n">0</span><span class="o">)</span>    <span class="c1">//= [1, 0]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">([</span><span class="n">1</span><span class="o">,</span> <span class="n">0</span><span class="o">],</span> <span class="n">1</span><span class="o">)</span> <span class="c1">//= [1, 0, 1] 
</span><span class="c1">//说明：在给定的数组副本中加入传入的数组和给定的元素，如果给定的数组是null，那么会返回一个包含给定元素的数组；
</span><span class="c1">//参数：array-要被复制的数组；element-在新数组中的最后一个索引处添加的元素；
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span><span class="o">[]</span> <span class="nf">add</span><span class="o">(</span><span class="kt">long</span><span class="o">[]</span> <span class="n">array</span><span class="o">,</span> <span class="kt">long</span> <span class="n">element</span><span class="o">)</span>

<span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">0</span><span class="o">)</span>   <span class="c1">//= [0]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">([</span><span class="n">1</span><span class="o">],</span> <span class="n">0</span><span class="o">)</span>    <span class="c1">//= [1, 0]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">([</span><span class="n">1</span><span class="o">,</span> <span class="n">0</span><span class="o">],</span> <span class="n">1</span><span class="o">)</span> <span class="c1">//= [1, 0, 1]
</span><span class="c1">//说明：在给定的数组副本中加入传入的数组和给定的元素，如果给定的数组是null，那么会返回一个包含给定元素的数组；
</span><span class="c1">//参数：array-要被复制的数组；element-在新数组中的最后一个索引处添加的元素；
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">short</span><span class="o">[]</span> <span class="nf">add</span><span class="o">(</span><span class="kt">short</span><span class="o">[]</span> <span class="n">array</span><span class="o">,</span> <span class="kt">short</span> <span class="n">element</span><span class="o">)</span>

<span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">0</span><span class="o">)</span>   <span class="c1">//= [0]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">([</span><span class="n">1</span><span class="o">],</span> <span class="n">0</span><span class="o">)</span>    <span class="c1">//= [1, 0]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">([</span><span class="n">1</span><span class="o">,</span> <span class="n">0</span><span class="o">],</span> <span class="n">1</span><span class="o">)</span> <span class="c1">//= [1, 0, 1]
</span><span class="c1">//说明：java的基本数据类型中有byte这种，byte存储整型数据，占据1个字节(8 bits)，能够存储的数据范围是-128～+127;在给定的数组副本中加入传入的数组和给定的元素，如果给定的数组是null，那么会返回一个包含给定元素的数组；
</span><span class="c1">//参数：array-要被复制的数组；element-在新数组中的最后一个索引处添加的元素；
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">add</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">array</span><span class="o">,</span> <span class="kt">byte</span> <span class="n">element</span><span class="o">)</span>
    
<span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>          <span class="c1">//= [true]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">([</span><span class="kc">true</span><span class="o">],</span> <span class="kc">false</span><span class="o">)</span>       <span class="c1">//= [true, false]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">add</span><span class="o">([</span><span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">],</span> <span class="kc">true</span><span class="o">)</span> <span class="c1">//= [true, false, true]
</span><span class="c1">//说明：在给定的数组副本中加入传入的数组和给定的元素，如果给定的数组是null，那么会返回一个包含给定元素的数组；
</span><span class="c1">//参数：array-要被复制的数组；element-在新数组中的最后一个索引处添加的元素；
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span><span class="o">[]</span> <span class="nf">add</span><span class="o">(</span><span class="kt">boolean</span><span class="o">[]</span> <span class="n">array</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">element</span><span class="o">)</span>


<span class="c1">// 16.删除数组中某个位置上的数据
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">5</span> <span class="o">},</span> <span class="n">1</span><span class="o">);</span><span class="c1">// {1,5}
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">remove</span><span class="o">([</span><span class="n">1</span><span class="o">],</span> <span class="n">0</span><span class="o">)</span>                   <span class="c1">//= []
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">remove</span><span class="o">([</span><span class="n">2</span><span class="o">,</span> <span class="n">6</span><span class="o">],</span> <span class="n">0</span><span class="o">)</span>                <span class="c1">//= [6]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">remove</span><span class="o">([</span><span class="n">2</span><span class="o">,</span> <span class="n">6</span><span class="o">],</span> <span class="n">1</span><span class="o">)</span>                <span class="c1">//= [2]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">remove</span><span class="o">([</span><span class="n">2</span><span class="o">,</span> <span class="n">6</span><span class="o">,</span> <span class="n">3</span><span class="o">],</span> <span class="n">1</span><span class="o">)</span>             <span class="c1">//= [2, 3]
</span><span class="c1"></span><span class="n">说明</span><span class="err">：</span><span class="n">删除数组中指定索引的值</span><span class="err">，</span><span class="n">所有后续元素左移</span><span class="err">（</span><span class="n">下标减一</span><span class="err">），</span><span class="n">此方法返回一个新数组</span><span class="err">，</span><span class="n">该数组与新输入数组元素相同</span><span class="err">，</span><span class="n">但是在指定位置上的元素除外</span><span class="err">。</span><span class="n">返回数组的数据类型总是与输入数组的数据类型相同</span><span class="err">，</span><span class="n">如果输入的数组是null</span><span class="o">,</span><span class="n">将会抛出IndexOutOfBoundsException</span> <span class="n">异常</span><span class="err">，</span><span class="n">因为在这种情况下不能指定有效的索引</span><span class="err">。</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span><span class="o">[]</span> <span class="nf">remove</span><span class="o">(</span><span class="kt">long</span><span class="o">[]</span> <span class="n">array</span><span class="o">,</span> <span class="kt">int</span> <span class="n">index</span><span class="o">)</span>

<span class="c1">// 17.删除数组中某个对象(从正序开始搜索,删除第一个)
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">removeElement</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">1</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">5</span> <span class="o">},</span> <span class="n">3</span><span class="o">);</span><span class="c1">// {1,5} 
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">removeElement</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">1</span><span class="o">)</span>                  <span class="c1">//= null
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">removeElement</span><span class="o">([],</span> <span class="n">1</span><span class="o">)</span>                    <span class="c1">//= []
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">removeElement</span><span class="o">([</span><span class="n">1</span><span class="o">],</span> <span class="n">2</span><span class="o">)</span>                   <span class="c1">//= [1]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">removeElement</span><span class="o">([</span><span class="n">1</span><span class="o">,</span> <span class="n">3</span><span class="o">],</span> <span class="n">1</span><span class="o">)</span>                <span class="c1">//= [3]
</span><span class="c1"></span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">removeElement</span><span class="o">([</span><span class="n">1</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">1</span><span class="o">],</span> <span class="n">1</span><span class="o">)</span>             <span class="c1">//= [3, 1]
</span><span class="c1">//说明：从指定的数组中移除指定的第一个元素，所有的后续元素左移（下标减一），如果数组中不包含这样的元素，不会从数组中移除元素，此方法返回输入数组中的所有元素移除掉指定元素，返回数组的数据类型总是与输入数组相同；
</span><span class="c1">//返回值是一个新数组包含了现有数组的所有元素去除掉指定元素的第一次出现；
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span><span class="o">[]</span> <span class="nf">removeElement</span><span class="o">(</span><span class="kt">long</span><span class="o">[]</span> <span class="n">array</span><span class="o">,</span> <span class="kt">long</span> <span class="n">element</span><span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="字符串操作">字符串操作</h2>
<p>String根据下标访问</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="s">&#34;abcd&#34;</span>
<span class="n">Char</span> <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">0</span><span class="o">)</span><span class="c1">//c结果为a
</span></code></pre></td></tr></table>
</div>
</div><h2 id="stringformat的详细用法">String.format()的详细用法</h2>
<h3 id="问题">问题</h3>
<p>在开发的时候一段<a href="https://so.csdn.net/so/search?q=%e5%ad%97%e7%ac%a6%e4%b8%b2&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">字符串</a>的中间某一部分是需要可变的 比如一个Textview需要显示”XXX用户来自 上海 年龄 21 性别 男” 
其中的 XXX 是用户名 每个用户也是不一样的 
地区 上海 为可变的string数据 
年龄 21 为可变的int数据 
性别 男 为可变的string数据 
遇到这种情况你们是怎么样解决的呢?把这段字符串保存在常量类里吗?不!我们应该遵循Google的开发模式</p>
<p>XML</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">&#34;user_info&#39;&gt; %1$s&lt;/span&gt; 用户来自 &lt;span class=&#34;</span><span class="err">hljs-variable&#34;</span><span class="nt">&gt;</span>%2<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&#34;hljs-variable&#34;</span><span class="nt">&gt;</span>$s  年龄 %3$d<span class="nt">&lt;/span&gt;</span>  性别 <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&#34;hljs-variable&#34;</span><span class="nt">&gt;</span>%4<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&#34;hljs-variable&#34;</span><span class="nt">&gt;</span>$s<span class="nt">&lt;/string&gt;</span>  
</code></pre></td></tr></table>
</div>
</div><p>JAVA</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">String</span> <span class="n">userName</span><span class="o">=</span><span class="s">&#34;XXX&#34;</span><span class="o">;</span>
<span class="n">String</span> <span class="n">userProvince</span><span class="o">=</span><span class="s">&#34;上海&#34;</span><span class="o">;</span> 
<span class="kt">int</span> <span class="n">userAge</span><span class="o">=</span><span class="n">21</span><span class="o">;</span>
<span class="n">String</span> <span class="n">userSex</span><span class="o">=</span><span class="s">&#34;男&#34;</span><span class="o">;</span>
<span class="n">String</span> <span class="n">string</span><span class="o">=</span><span class="n">getResources</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">user_info</span><span class="o">);</span>
<span class="n">String</span> <span class="n">userInfo</span><span class="o">=</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">string</span><span class="o">,</span><span class="n">userName</span><span class="o">,</span><span class="n">userProvince</span><span class="o">,</span><span class="n">userAge</span><span class="o">,</span><span class="n">userSex</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>是不是觉得很方便 
本来是打算当笔记记录下来备忘的,但是有朋友有朋友问到的一些相关的东西,我就完善一下吧</p>
<h3 id="stringformat字符串常规类型格式化的两种重载方式">String.format()字符串常规类型格式化的两种重载方式</h3>
<ul>
<li>format(String format, Object… args) 新字符串使用本地语言环境，制定字符串格式和参数生成格式化的新字符串。</li>
<li>format(Locale locale, String format, Object… args) 使用指定的语言环境，制定字符串格式和参数生成格式化的字符串。</li>
</ul>
<h3 id="上个栗子有用到了字符类型和整数类型的格式化-下面我把常用的类型例举出来">上个栗子有用到了字符类型和整数类型的格式化 下面我把常用的类型例举出来</h3>
<table>
<thead>
<tr>
<th>转换符</th>
<th>详细说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>%s</td>
<td>字符串类型</td>
<td>“喜欢请收藏”</td>
</tr>
<tr>
<td>%c</td>
<td>字符类型</td>
<td>‘m’</td>
</tr>
<tr>
<td>%b</td>
<td>布尔类型</td>
<td>true</td>
</tr>
<tr>
<td>%d</td>
<td>整数类型（十进制）</td>
<td>88</td>
</tr>
<tr>
<td>%x</td>
<td>整数类型（十六进制）</td>
<td>FF</td>
</tr>
<tr>
<td>%o</td>
<td>整数类型（八进制）</td>
<td>77</td>
</tr>
<tr>
<td>%f</td>
<td>浮点类型</td>
<td>8.888</td>
</tr>
<tr>
<td>%a</td>
<td>十六进制浮点类型</td>
<td>FF.35AE</td>
</tr>
<tr>
<td>%e</td>
<td>指数类型</td>
<td>9.38e+5</td>
</tr>
<tr>
<td>%g</td>
<td>通用浮点类型（f和e类型中较短的）</td>
<td>不举例(基本用不到)</td>
</tr>
<tr>
<td>%h</td>
<td>散列码</td>
<td>不举例(基本用不到)</td>
</tr>
<tr>
<td>%%</td>
<td>百分比类型</td>
<td>％(%特殊字符%%才能显示%)</td>
</tr>
<tr>
<td>%n</td>
<td>换行符</td>
<td>不举例(基本用不到)</td>
</tr>
<tr>
<td>%tx</td>
<td>日期与时间类型（x代表不同的日期与时间转换符)</td>
<td>不举例(基本用不到)</td>
</tr>
</tbody>
</table>
<h3 id="为了方便理解还是举个例子">为了方便理解还是举个例子</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="n">String</span> <span class="n">str</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>  
    <span class="n">str</span><span class="o">=</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;Hi,%s&#34;</span><span class="o">,</span> <span class="s">&#34;小超&#34;</span><span class="o">);</span>  
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>  
    <span class="n">str</span><span class="o">=</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;Hi,%s %s %s&#34;</span><span class="o">,</span> <span class="s">&#34;小超&#34;</span><span class="o">,</span><span class="s">&#34;是个&#34;</span><span class="o">,</span><span class="s">&#34;大帅哥&#34;</span><span class="o">);</span>            
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>                           
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;字母c的大写是：%c %n&#34;</span><span class="o">,</span> <span class="sc">&#39;C&#39;</span><span class="o">);</span>  
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;布尔结果是：%b %n&#34;</span><span class="o">,</span> <span class="s">&#34;小超&#34;</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="s">&#34;帅哥&#34;</span><span class="o">));</span>  
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;100的一半是：%d %n&#34;</span><span class="o">,</span> <span class="n">100</span><span class="o">/</span><span class="n">2</span><span class="o">);</span>  
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;100的16进制数是：%x %n&#34;</span><span class="o">,</span> <span class="n">100</span><span class="o">);</span>  
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;100的8进制数是：%o %n&#34;</span><span class="o">,</span> <span class="n">100</span><span class="o">);</span>  
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;50元的书打8.5折扣是：%f 元%n&#34;</span><span class="o">,</span> <span class="n">50</span><span class="o">*</span><span class="n">0</span><span class="o">.</span><span class="na">85</span><span class="o">);</span>  
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;上面价格的16进制数是：%a %n&#34;</span><span class="o">,</span> <span class="n">50</span><span class="o">*</span><span class="n">0</span><span class="o">.</span><span class="na">85</span><span class="o">);</span>  
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;上面价格的指数表示：%e %n&#34;</span><span class="o">,</span> <span class="n">50</span><span class="o">*</span><span class="n">0</span><span class="o">.</span><span class="na">85</span><span class="o">);</span>  
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;上面价格的指数和浮点数结果的长度较短的是：%g %n&#34;</span><span class="o">,</span> <span class="n">50</span><span class="o">*</span><span class="n">0</span><span class="o">.</span><span class="na">85</span><span class="o">);</span>  
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;上面的折扣是%d%% %n&#34;</span><span class="o">,</span> <span class="n">85</span><span class="o">);</span>  
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;字母A的散列码是：%h %n&#34;</span><span class="o">,</span> <span class="sc">&#39;A&#39;</span><span class="o">);</span>  
</code></pre></td></tr></table>
</div>
</div><p>输出结果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">Hi,小超 
Hi,小超 是个 大帅哥  
字母c的大写是：C   
布尔的结果是：false   
100的一半是：50   
100的16进制数是：64   
100的8进制数是：144   
50元的书打8.5折扣是：42.500000 元  
上面价格的16进制数是：0x1.54p5   
上面价格的指数表示：4.250000e+01   
上面价格的指数和浮点数结果的长度较短的是：42.5000   
上面的折扣是85%   
字母A的散列码是：41   
</code></pre></td></tr></table>
</div>
</div><p>###搭配转换符还有实现高级功能 第一个例子中有用到 $</p>
<table>
<thead>
<tr>
<th>标志</th>
<th>说明</th>
<th>示例</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>+</td>
<td>为正数或者负数添加符号</td>
<td>(“%+d”,15)</td>
<td>+15</td>
</tr>
<tr>
<td>0</td>
<td>数字前面补0(加密常用)</td>
<td>(“%04d”, 99)</td>
<td>0099</td>
</tr>
<tr>
<td>空格</td>
<td>在整数之前添加指定数量的空格</td>
<td>(“% 4d”, 99)</td>
<td>99</td>
</tr>
<tr>
<td>,</td>
<td>以“,”对数字分组(常用显示金额)</td>
<td>(“%,f”, 9999.99)</td>
<td>9,999.990000</td>
</tr>
<tr>
<td>(</td>
<td>使用括号包含负数</td>
<td>(“%(f”, -99.99)</td>
<td>(99.990000)</td>
</tr>
<tr>
<td>#</td>
<td>如果是浮点数则包含小数点，如果是16进制或8进制则添加0x或0</td>
<td>(“%#x”, 99)(“%#o”, 99)</td>
<td>0x63 0143</td>
</tr>
<tr>
<td>&lt;</td>
<td>格式化前一个转换符所描述的参数</td>
<td>(“%f和%&lt;3.2f”, 99.45)</td>
<td>99.450000和99.45</td>
</tr>
<tr>
<td>d,%2$s”, 99,”abc”)</td>
<td>99,abc</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>第一个例子中有说到 %tx x代表日期转换符 我也顺便列举下日期转换符</p>
<table>
<thead>
<tr>
<th>标志</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>c</td>
<td>包括全部日期和时间信息</td>
<td>星期六 十月 27 14:21:20 CST 2007</td>
</tr>
<tr>
<td>F</td>
<td>“年-月-日”格式</td>
<td>2007-10-27</td>
</tr>
<tr>
<td>D</td>
<td>“月/日/年”格式</td>
<td>10/27/07</td>
</tr>
<tr>
<td>r</td>
<td>“HH:MM:SS PM”格式（12时制）</td>
<td>02:25:51 下午</td>
</tr>
<tr>
<td>T</td>
<td>“HH:MM:SS”格式（24时制）</td>
<td>14:28:16</td>
</tr>
<tr>
<td>R</td>
<td>“HH:MM”格式（24时制）</td>
<td>14:28</td>
</tr>
</tbody>
</table>
<p>来个例子方便理解</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">	<span class="n">Date</span> <span class="n">date</span><span class="o">=</span><span class="k">new</span> <span class="n">Date</span><span class="o">();</span>                                  
    <span class="c1">//c的使用  
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;全部日期和时间信息：%tc%n&#34;</span><span class="o">,</span><span class="n">date</span><span class="o">);</span>          
    <span class="c1">//f的使用  
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;年-月-日格式：%tF%n&#34;</span><span class="o">,</span><span class="n">date</span><span class="o">);</span>  
    <span class="c1">//d的使用  
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;月/日/年格式：%tD%n&#34;</span><span class="o">,</span><span class="n">date</span><span class="o">);</span>  
    <span class="c1">//r的使用  
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;HH:MM:SS PM格式（12时制）：%tr%n&#34;</span><span class="o">,</span><span class="n">date</span><span class="o">);</span>  
    <span class="c1">//t的使用  
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;HH:MM:SS格式（24时制）：%tT%n&#34;</span><span class="o">,</span><span class="n">date</span><span class="o">);</span>  
    <span class="c1">//R的使用  
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;HH:MM格式（24时制）：%tR&#34;</span><span class="o">,</span><span class="n">date</span><span class="o">);</span>  
</code></pre></td></tr></table>
</div>
</div><p>输出结果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">全部日期和时间信息：星期三 九月 <span class="m">21</span> 22:43:36 CST <span class="m">2016</span>  
年-月-日格式：2016-09-21
月/日/年格式：16/10/21  
HH:MM:SS PM格式（12时制）：10:43:36 下午  
HH:MM:SS格式（24时制）：22:43:36  
HH:MM格式（24时制）：22:43  
</code></pre></td></tr></table>
</div>
</div><p>其实还有很多其他有趣的玩法 我这边只列举一些常用的 有兴趣的朋友可以自己再去多了解了解</p>
<h3 id="特殊情况">特殊情况</h3>
<h4 id="格式化变长度">格式化变长度</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">5</span><span class="o">;</span>
<span class="n">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
<span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;第%d行：\n&#34;</span><span class="o">,</span> <span class="n">n</span><span class="o">));</span>
<span class="n">StringBuilder</span> <span class="n">sb1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">(</span><span class="s">&#34;%&#34;</span><span class="o">);</span>
<span class="n">sb1</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">12</span> <span class="o">+</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">n</span><span class="o">).</span><span class="na">length</span><span class="o">()</span> <span class="o">*</span> <span class="n">2</span><span class="o">);</span>
<span class="n">sb1</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;s&#34;</span><span class="o">);</span>
<span class="n">sb1</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;1111&#34;</span><span class="o">);</span>
<span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">sb1</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="s">&#34; &#34;</span><span class="o">));</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sb</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="关于foreach循环不能修改变量的值问题">关于foreach循环不能修改变量的值问题</h2>
<h3 id="一发现问题">一、发现问题</h3>
<p>直接上代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;[]</span>  <span class="n">lists</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">[</span><span class="n">5</span><span class="o">];</span>
<span class="k">for</span> <span class="o">(</span><span class="n">List</span> <span class="n">list</span> <span class="o">:</span> <span class="n">lists</span><span class="o">){</span>
	<span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>
<span class="o">}</span>

<span class="k">for</span> <span class="o">(</span><span class="n">List</span> <span class="n">list</span> <span class="o">:</span> <span class="n">lists</span><span class="o">){</span>
	<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>观察这段简单的代码，首先创建了一个ArrayList的数组，然后通过foreach循环对该数组进行赋值，随后打印该数组。</p>
<p>预期将会打印出 5 行list的toString()信息，但是，实际情况却有所不一样。</p>
<p>运行结果：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">null
null
null
null
null

Process finished with <span class="nb">exit</span> code <span class="m">0</span>
</code></pre></td></tr></table>
</div>
</div><p>为什么会出现这样的情况？不是赋值了嘛？</p>
<p>既然这样，难道是我赋值的姿势不正确？要不我换一种方式，直接用for进行赋值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;[]</span>  <span class="n">lists</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">[</span><span class="n">5</span><span class="o">];</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">5</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
	<span class="n">lists</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>
<span class="o">}</span>

<span class="k">for</span> <span class="o">(</span><span class="n">List</span> <span class="n">list</span> <span class="o">:</span> <span class="n">lists</span><span class="o">){</span>
	<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>运行结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[]</span>
<span class="o">[]</span>
<span class="o">[]</span>
<span class="o">[]</span>
<span class="o">[]</span>

Process finished with <span class="nb">exit</span> code <span class="m">0</span>
</code></pre></td></tr></table>
</div>
</div><p>这次成功赋值了，对比之下，我们大概可以猜到是因为使用了foreach而导致赋值失败的。</p>
<h3 id="二探究原因">二、探究原因</h3>
<p>首先得分析JDK源码，foreach基于容器或者数组的迭代器，也就是Iterator实现的，在翻阅源码的过程中，发现迭代器有一个方法forEach.</p>
<p>public void forEach(Consumer&lt;? super E&gt; action) {
Objects.requireNonNull(action);
int expectedModCount = this.modCount;
Object[] es = this.elementData;
int size = this.size;</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="k">this</span><span class="o">.</span><span class="na">modCount</span> <span class="o">==</span> <span class="n">expectedModCount</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
    	<span class="n">action</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">elementAt</span><span class="o">(</span><span class="n">es</span><span class="o">,</span> <span class="n">i</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">modCount</span> <span class="o">!=</span> <span class="n">expectedModCount</span><span class="o">)</span> <span class="o">{</span>
    	<span class="k">throw</span> <span class="k">new</span> <span class="n">ConcurrentModificationException</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>该方法正是实现foreach的关键，可以看出，增强型循环将数组或者容器传入方法体，方法体再执行操作，而这个过程就涉及到了 JAVA参数是值传递 的问题，如果不理解，可以参考这篇文章，有比较详细的介绍。</p>
<p>链接: <a href="https://blog.csdn.net/weixin_44308662/article/details/108593631" target="_blank" rel="noopener noreferrer">如何理解Java是值传递？</a>.</p>
<p>也就是说，对foreach的操作其实是对数组或者容器的拷贝的操作。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./36.png"
        data-srcset="./36.png, ./36.png 1.5x, ./36.png 2x"
        data-sizes="auto"
        alt="./36.png"
        title="36" /></p>
<p>在这里插入图片描述
所以对原来数据的值(基本数据类型、引用)将不会发生改变，但可以修改引用的属性。</p>
<h3 id="三验证">三、验证</h3>
<p>下面将进行对foreach修改引用的属性的测试：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;[]</span>  <span class="n">lists</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">[</span><span class="n">5</span><span class="o">];</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">5</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
    <span class="n">lists</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>
<span class="o">}</span>

<span class="k">for</span> <span class="o">(</span><span class="n">List</span> <span class="n">list</span> <span class="o">:</span> <span class="n">lists</span><span class="o">){</span>
    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
<span class="o">}</span>

<span class="k">for</span> <span class="o">(</span><span class="n">List</span> <span class="n">list</span> <span class="o">:</span> <span class="n">lists</span><span class="o">){</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>首先创建数组，并且赋值，然后通过foreach修改数组的内容，最后打印</p>
<p>运行结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>1<span class="o">]</span>
<span class="o">[</span>1<span class="o">]</span>
<span class="o">[</span>1<span class="o">]</span>
<span class="o">[</span>1<span class="o">]</span>
<span class="o">[</span>1<span class="o">]</span>

Process finished with <span class="nb">exit</span> code <span class="m">0</span>
</code></pre></td></tr></table>
</div>
</div><p>验证成功！</p>
<h3 id="四总结">四、总结</h3>
<p>1.foreach的实现基于Iterator；
2.不能使用foreach对数组或容器进行赋值；
3.可以使用foreach修改数组或容器的对象的属性；
4.赋值行为尽量使用for循环。</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2022-10-03</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/java-collection-note/index.md" target="_blank" rel="noopener noreferrer">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://kkkpjskey.github.io/java-collection-note/" data-title="Java-Collection笔记" data-hashtags="Java,Collection,JavaNote"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://kkkpjskey.github.io/java-collection-note/" data-hashtag="Java"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://kkkpjskey.github.io/java-collection-note/" data-title="Java-Collection笔记" data-ralateuid="3960792616"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="分享到 百度" data-sharer="baidu" data-url="https://kkkpjskey.github.io/java-collection-note/" data-title="Java-Collection笔记"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/baidu.svg"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/java/">Java</a>,&nbsp;<a href="/tags/collection/">Collection</a>,&nbsp;<a href="/tags/javanote/">JavaNote</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/java-integer-equal-note/" class="prev" rel="prev" title="Java不同数字对比不同笔记"><i class="fas fa-angle-left fa-fw"></i>Java不同数字对比不同笔记</a>
            <a href="/docker-edit-start-error/" class="next" rel="next" title="Docker修改容器中的配置文件启动报错">Docker修改容器中的配置文件启动报错<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.92.1">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/sunt-programator/CodeIT" target="_blank" rel="noopener noreferrer" title="CodeIT 0.2.10"><i class="fas fa-laptop-code fa-fw"></i> CodeIT</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/KKKPJSKEY" target="_blank" rel="noopener noreferrer">KKKPJSKEY</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{"valine":{"appId":"QGzwQXOqs5JOhN4RGPOkR2mR-MdYXbMMI","appKey":"WBmoGyJtbqUswvfLh6L8iEBr","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"zh-cn","pageSize":10,"placeholder":"你的评论 ...","recordIP":true,"serverURLs":"https://leancloud.hugoCodeIT.com","visitor":true}},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"data":{"id-1":"KKKPJSKEY's-Case-Archives","id-2":"KKKPJSKEY's-Case-Archives"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"HQXVPXR7JG","algoliaIndex":"KKKPJSKEY's-Case-Archives","algoliaSearchKey":"19b354f5c6a10bcec6a1c920d95cda23","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.e7a5845171e7810e33987fe5e0126480d67b52c04d579f93f48f97aae1932644ec5f7fa8c1f3377a0613c9a2fcf86bd1.js" integrity="sha384-56WEUXHngQ4zmH/l4BJkgNZ7UsBNV5&#43;T9I&#43;XquGTJkTsX3&#43;owfM3egYTyaL8&#43;GvR"></script></body>
</html>
